<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leadfinder - AI-Powered Lead Discovery</title>
    <link rel="icon" type="image/png" href="LinkedIn_Image_Template__15_-removebg-preview.png">
    <script src="https://cdn.tailwindcss.com"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="https://app.midtrans.com/snap/snap.js" data-client-key="Mid-client-CNEBcdeUWpDvMVXD"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-primary': '#1a1a2e',
                        'dark-secondary': '#16213e',
                        'dark-tertiary': '#0f3460',
                        'accent-cyan': '#00d4aa',
                        'accent-teal': '#4ecdc4',
                    }
                }
            }
        }
    </script>
	
    <style>
        .score-circle {
            background: conic-gradient(from 0deg, #00d4aa 0deg, #00d4aa var(--score-deg), #374151 var(--score-deg), #374151 360deg);
        }
        .step-item {
            transition: all 0.3s ease-in-out;
        }
        
        .step-item:hover {
            background-color: rgba(15, 52, 96, 0.3);
            border-radius: 8px;
            padding: 8px;
            margin: -8px;
        }
        
        #loadingTip {
            transition: opacity 0.3s ease-in-out;
        }
        
        #progressBar {
            transition: all 0.5s ease-out;
            position: relative;
        }

        .company-context {
            line-height: 1.6;
            margin-top: 0.75rem;
        }
        
        .verification-badge {
            background: linear-gradient(135deg, #00d4aa, #4ecdc4);
            box-shadow: 0 2px 4px rgba(0, 212, 170, 0.3);
        }
        
        .verification-badge svg {
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
        }

		.enhanced-score-circle {
		    background: conic-gradient(
		        from 0deg, 
		        var(--score-color) 0deg, 
		        var(--score-color) var(--score-deg), 
		        #374151 var(--score-deg), 
		        #374151 360deg
		    );
		    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
		    position: relative;
		}
		
		.enhanced-score-circle::before {
		    content: '';
		    position: absolute;
		    inset: 2px;
		    border-radius: 50%;
		    background: conic-gradient(
		        from 0deg,
		        rgba(255, 255, 255, 0.1) 0deg,
		        rgba(255, 255, 255, 0.1) var(--score-deg),
		        transparent var(--score-deg),
		        transparent 360deg
		    );
		}

		.candidate-card {
		    transition: all 0.3s ease-in-out;
		    border: 1px solid transparent;
		    position: relative;
		}
		
		/* Premium Priority Borders */
		.candidate-card[data-priority="high"] {
		    border-left: 4px solid #10b981;
		    box-shadow: 0 0 0 1px rgba(16, 185, 129, 0.1);
		}
		
		.candidate-card[data-priority="medium"] {
		    border-left: 4px solid #f59e0b;
		    box-shadow: 0 0 0 1px rgba(245, 158, 11, 0.1);
		}
		
		.candidate-card[data-priority="low"] {
		    border-left: 4px solid #6b7280;
		    box-shadow: 0 0 0 1px rgba(107, 114, 128, 0.1);
		}
		
		.candidate-card:hover {
		    transform: translateY(-3px);
		    box-shadow: 0 12px 32px rgba(0, 212, 170, 0.15);
		    border-color: rgba(0, 212, 170, 0.3);
		    background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
		}

		.candidate-card[data-priority="high"]:hover {
		    box-shadow: 0 12px 32px rgba(16, 185, 129, 0.2);
		    border-left-color: #34d399;
		}
		
		.candidate-card[data-priority="medium"]:hover {
		    box-shadow: 0 12px 32px rgba(245, 158, 11, 0.2);
		    border-left-color: #fbbf24;
		}
		
		.candidate-card[data-priority="low"]:hover {
		    box-shadow: 0 12px 32px rgba(107, 114, 128, 0.2);
		    border-left-color: #9ca3af;
		}
		
		.candidate-card:hover .enhanced-score-circle {
		    transform: scale(1.08);
		    filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.4));
		}
		
		.candidate-card[data-priority="high"]:hover .enhanced-score-circle {
		    filter: drop-shadow(0 6px 12px rgba(16, 185, 129, 0.4));
		}
		
		.candidate-card[data-priority="medium"]:hover .enhanced-score-circle {
		    filter: drop-shadow(0 6px 12px rgba(245, 158, 11, 0.4));
		}
		
		.candidate-card[data-priority="low"]:hover .enhanced-score-circle {
		    filter: drop-shadow(0 6px 12px rgba(107, 114, 128, 0.4));
		}
		
		.candidate-card:hover .verification-badge,
		.candidate-card:hover [class*="priority-badge"] {
			transform: scale(1.02);
			transition: transform 0.3s ease;
		}

		.source-badge {
			backdrop-filter: blur(8px);
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			transition: all 0.3s ease;
		}
		
		.source-badge:hover {
			transform: translateY(-1px);
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
		}

	    	.salary-badge {
		    background: linear-gradient(135deg, #059669, #10b981);
		    box-shadow: 0 2px 4px rgba(5, 150, 105, 0.3);
		}
		
		.difficulty-easy { @apply bg-green-500/20 text-green-400 border-green-500/30; }
		.difficulty-medium { @apply bg-yellow-500/20 text-yellow-400 border-yellow-500/30; }
		.difficulty-hard { @apply bg-red-500/20 text-red-400 border-red-500/30; }

		.history-tab {
		    color: #9ca3af;
		    background: transparent;
		}
		
		.history-tab.active {
		    color: #00d4aa;
		    background: #16213e;
		}
		
		.history-tab:hover:not(.active) {
		    color: #d1d5db;
		    background: #0f3460;
		}
		
		.history-content {
		    display: block;
		}
		
		.history-content.hidden {
		    display: none;
		}

		.w-18 { width: 4.5rem; }
		.h-18 { height: 4.5rem; }

		/* Remove any existing flash animations */
		.candidate-card * {
		    animation: none !important;
		}

		/* Filter Active States */
		.filter-active {
		    background-color: rgba(0, 212, 170, 0.2) !important;
		    border-color: rgba(0, 212, 170, 0.5) !important;
		    color: #00d4aa !important;
		}
		
		.filter-button {
		    transition: all 0.3s ease;
		    position: relative;
		}
		
		.filter-button.has-active::after {
		    content: '';
		    position: absolute;
		    top: -2px;
		    right: -2px;
		    width: 8px;
		    height: 8px;
		    background-color: #00d4aa;
		    border-radius: 50%;
		    border: 2px solid #1a1a2e;
		}
		
		/* Active Filter Chips */
		.filter-chip {
		    background: linear-gradient(135deg, #00d4aa, #4ecdc4);
		    color: #1a1a2e;
		    border: none;
		    transition: all 0.2s ease;
		}
		
		.filter-chip:hover {
		    transform: translateY(-1px);
		    box-shadow: 0 4px 8px rgba(0, 212, 170, 0.3);
		}
		
		/* Filter Count Badges */
		.filter-count {
		    background: linear-gradient(135deg, #00d4aa, #4ecdc4);
		    color: #1a1a2e;
		    min-width: 20px;
		    height: 20px;
		    border-radius: 10px;
		    font-size: 11px;
		    font-weight: bold;
		}

	    	.bookmark-ribbon {
		    position: absolute;
		    top: 8px;
		    right: 8px;
		    z-index: 10;
		}

	    	.bookmark-icon.bookmarked {
		    color: #fbbf24; /* Gold color */
		    transform: scale(1.1);
		}
		
		.bookmark-icon.not-bookmarked {
		    color: #6b7280; /* Gray color */
		}

	    	.bookmark-icon {
		    cursor: pointer;
		    padding: 4px;
		    border-radius: 4px;
		    transition: all 0.2s ease;
		    position: relative;
		    z-index: 15; /* Higher than card */
		}
		
		.bookmark-icon:hover {
		    background-color: rgba(0, 0, 0, 0.3);
		    transform: scale(1.2);
		}
		
		.candidate-card .bookmark-ribbon {
		    pointer-events: auto; /* Ensure it can receive clicks */
		}

	    	/* AI Outreach Popup Styles */
		#aiOutreachPopup {
		    backdrop-filter: blur(2px);
		}
		
		#aiOutreachPopup .absolute.bottom-4 {
		    animation: slideUpIn 0.3s ease-out;
		}
		
		@keyframes slideUpIn {
		    from {
		        opacity: 0;
		        transform: translateY(20px) scale(0.95);
		    }
		    to {
		        opacity: 1;
		        transform: translateY(0) scale(1);
		    }
		}
		
		/* Platform Tab Styles */
		.platform-tab {
		    color: #9ca3af;
		    background: transparent;
		}
		
		.platform-tab.active {
		    color: #00d4aa;
		    background: #16213e;
		}
		
		.platform-tab:hover:not(.active) {
		    color: #d1d5db;
		    background: #0f3460;
		}
		
		/* Message Content Visibility */
		.message-content {
		    display: none;
		}
		
		.message-content.active {
		    display: block;
		}
		
		/* Message Box Styling */
		.message-box {
		    transition: all 0.2s ease;
		}
		
		.message-box:hover {
		    transform: translateY(-1px);
		}
		
		.message-box .bg-dark-primary {
		    border: 1px solid rgba(107, 114, 128, 0.2);
		    transition: border-color 0.2s ease;
		}
		
		.message-box:hover .bg-dark-primary {
		    border-color: rgba(0, 212, 170, 0.3);
		}
		
		/* Copy Button Enhanced Styling */
		.copy-message-btn {
		    transition: all 0.2s ease;
		    font-weight: 500;
		}
		
		.copy-message-btn:hover {
		    transform: scale(1.05);
		    box-shadow: 0 2px 8px rgba(0, 212, 170, 0.3);
		}
		
		/* Scrollbar Styling for Message Areas */
		.message-box .overflow-y-auto::-webkit-scrollbar {
		    width: 4px;
		}
		
		.message-box .overflow-y-auto::-webkit-scrollbar-track {
		    background: rgba(107, 114, 128, 0.1);
		    border-radius: 2px;
		}
		
		.message-box .overflow-y-auto::-webkit-scrollbar-thumb {
		    background: rgba(0, 212, 170, 0.3);
		    border-radius: 2px;
		}
		
		.message-box .overflow-y-auto::-webkit-scrollbar-thumb:hover {
		    background: rgba(0, 212, 170, 0.5);
		}
		
		/* Loading State for Messages */
		.message-loading {
		    animation: messageLoadingPulse 1.5s ease-in-out infinite;
		}
		
		@keyframes messageLoadingPulse {
		    0%, 100% {
		        opacity: 0.5;
		    }
		    50% {
		        opacity: 0.8;
		    }
		}
		
		/* Popup Close Animation */
		#aiOutreachPopup.closing .absolute.bottom-4 {
		    animation: slideDownOut 0.3s ease-in forwards;
		}
		
		@keyframes slideDownOut {
		    from {
		        opacity: 1;
		        transform: translateY(0) scale(1);
		    }
		    to {
		        opacity: 0;
		        transform: translateY(20px) scale(0.95);
		    }
		}
		
		/* Responsive adjustments for smaller screens */
		@media (max-width: 640px) {
		    #aiOutreachPopup .absolute.bottom-4 {
		        bottom: 1rem;
		        right: 1rem;
		        left: 1rem;
		        width: auto;
		        max-width: none;
		    }
		}

	    	/* Fix button text alignment */
		.flex.items-center span {
		    line-height: 1;
		}

	    .cursor-pointer {
		    cursor: pointer !important;
		}
		
		/* Prevent text selection on logo */
		.select-none {
		    user-select: none;
		}	

    </style>

<!-- Enhanced Payment Loading Modal -->
<div id="paymentLoadingModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[60] hidden">
    <div class="bg-dark-primary rounded-xl p-8 max-w-md w-full mx-4 border border-gray-600">
        <div class="text-center">
            <!-- Loading Animation -->
            <div class="relative mb-6">
			    <div class="w-16 h-16 mx-auto bg-accent-cyan/20 rounded-full flex items-center justify-center">
			        <svg class="w-8 h-8 text-accent-cyan animate-pulse" fill="currentColor" viewBox="0 0 20 20">
			            <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"/>
			        </svg>
			    </div>
			</div>
            
            <h3 class="text-xl font-bold text-white mb-2">Processing Payment</h3>
            <p id="paymentLoadingText" class="text-gray-300">Preparing secure payment gateway...</p>
            
            <!-- Payment Security Badges -->
            <div class="mt-6 flex items-center justify-center space-x-4 text-xs text-gray-400">
                <div class="flex items-center space-x-1">
                    <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                    </svg>
                    <span>SSL Secured</span>
                </div>
                <div class="flex items-center space-x-1">
                    <svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span>Midtrans Verified</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Payment Success Modal -->
<div id="paymentSuccessModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[60] hidden">
    <div class="bg-dark-primary rounded-xl p-8 max-w-md w-full mx-4 border border-green-500/30">
        <div class="text-center">
            <!-- Success Animation -->
            <div class="w-16 h-16 mx-auto mb-6 bg-green-500/20 rounded-full flex items-center justify-center">
                <svg class="w-8 h-8 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
            </div>
            
            <h3 class="text-xl font-bold text-white mb-2">Payment Successful! 🎉</h3>
            <p class="text-gray-300 mb-6">Your credits have been added to your account</p>
            
            <!-- Credits Added Display -->
            <div class="bg-gradient-to-r from-green-500/10 to-emerald-500/10 border border-green-500/30 rounded-lg p-4 mb-6">
                <div class="flex items-center justify-center space-x-3">
                    <svg class="w-6 h-6 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V4z"/>
                    </svg>
                    <span class="text-2xl font-bold text-green-400">+30</span>
                    <span class="text-green-400 font-medium">Credits Added</span>
                </div>
            </div>
            
            <button id="closeSuccessModal" class="w-full bg-accent-cyan hover:bg-accent-teal text-dark-primary font-bold py-3 px-6 rounded-lg transition-colors">
                Start Searching!
            </button>
        </div>
    </div>
</div>
	
</head>
<body class="bg-gray-900 text-white min-h-screen">
    	<!-- Improved Header with Psychology-Driven Copy -->
		<header class="bg-dark-primary border-b border-gray-700 px-6 py-4">
	    <div class="max-w-7xl mx-auto flex items-center justify-between">
	        <div class="flex items-center space-x-3 cursor-pointer select-none">
	            <div class="w-8 h-8 bg-accent-cyan rounded-lg flex items-center justify-center">
	                <svg class="w-5 h-5 text-dark-primary" fill="currentColor" viewBox="0 0 20 20">
	                    <path d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"/>
	                </svg>
	            </div>
	            <div>
	                <h1 class="text-xl font-bold text-white">Leadfinder</h1>
	                <p class="text-xs text-gray-400">Find qualified candidates in seconds</p>
	            </div>
	        </div>
	        
	        <div class="flex items-center space-x-4">
	            <button id="searchHistoryBtn" class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-dark-secondary hover:bg-dark-tertiary transition-colors">
	                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
	                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
	                </svg>
	                <span>Search History</span>
	                <span class="bg-accent-cyan text-dark-primary px-2 py-1 rounded-full text-xs font-medium">3</span>
	            </button>
	
	            <button id="savedCandidatesBtn" class="bookmarks-tab flex items-center space-x-2 px-3 py-2 rounded-lg bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-700 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg hover:shadow-xl">
	                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
	                    <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/>
	                </svg>
	                <span>My Shortlist</span>
	                <span id="savedCount" class="text-white font-medium">0 saved</span>
	            </button>
	            
	            <div class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-dark-secondary">
	                <svg class="w-4 h-4 text-accent-cyan" fill="currentColor" viewBox="0 0 20 20">
	                    <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V4z"/>
	                </svg>
	                <span id="creditsDisplay" class="text-accent-cyan font-medium">0 credits</span>
	                <button id="refreshCreditsBtn" class="text-gray-400 hover:text-accent-cyan ml-2" title="Refresh credits">
	                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
	                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
	                    </svg>
	                </button>
	                <!-- Low Credit Warning Button -->
	                <button id="lowCreditWarning" class="hidden px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs rounded-full font-medium transition-colors" title="Get more credits">
	                    <svg class="w-3 h-3 mr-1 inline" fill="currentColor" viewBox="0 0 20 20">
	                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
	                    </svg>
	                    Low Credits
	                </button>
	            </div>
	
	            <!-- Logout button moved inside the flex container -->
	            <button id="logoutBtn" class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-red-600/20 hover:bg-red-600/30 text-red-400 hover:text-red-300 transition-colors border border-red-600/30">
	                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
	                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
	                </svg>
	                <span>Logout</span>
	            </button>
	        </div>
	    </div>
	</header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Search Form -->
			<div class="lg:col-span-1">
			    <div class="bg-dark-secondary rounded-xl p-6 border border-gray-600/50 shadow-lg">
			        <!-- Header with micro-copy -->
			        <div class="mb-5">
			            <h2 class="text-xl font-bold text-white mb-2">Find Your Next Hire</h2>
			            <p class="text-gray-300 text-sm">Skip the endless scrolling. Get AI-ranked candidates.</p>
			        </div>
			        
			        <form id="searchForm" class="space-y-4">
			            <!-- Job Title - Primary Field -->
			            <div>
			                <label class="block text-sm font-medium text-gray-300 mb-2">
			                    What role are you hiring for? <span class="text-red-400">*</span>
			                </label>
			                <input type="text" 
			                       id="jobTitle" 
			                       placeholder="e.g. Marketing Manager, Software Engineer" 
			                       class="w-full px-4 py-3 bg-dark-primary border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-accent-cyan focus:outline-none focus:ring-2 focus:ring-accent-cyan/20 transition-all"
			                       required>
			                <div class="text-xs text-gray-500 mt-1">Be specific for better results</div>
			            </div>
			
			            <!-- Industry -->
			            <div>
			                <label class="block text-sm font-medium text-gray-300 mb-2">Industry (Optional)</label>
			                <select id="industry" class="w-full px-4 py-3 bg-dark-primary border border-gray-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none focus:ring-2 focus:ring-accent-cyan/20 transition-all">
			                    <option value="">All Industries</option>
			                    <option value="technology">Technology</option>
			                    <option value="finance">Finance</option>
			                    <option value="healthcare">Healthcare</option>
			                    <option value="education">Education</option>
			                    <option value="retail">Retail</option>
			                    <option value="manufacturing">Manufacturing</option>
			                    <option value="hospitality">Hospitality</option>
			                    <option value="marketing">Marketing</option>
			                    <option value="consulting">Consulting</option>
			                    <option value="real-estate">Real Estate</option>
			                    <option value="media">Media & Entertainment</option>
			                    <option value="logistics">Logistics</option>
			                    <option value="energy">Energy</option>
			                    <option value="nonprofit">Non-profit</option>
			                    <option value="custom">Other Industry</option>
			                </select>
			                <!-- Custom Industry Input (hidden by default) -->
			                <input type="text" 
			                       id="customIndustry" 
			                       placeholder="Enter specific industry (e.g., Fintech, Agritech, Gaming)" 
			                       class="w-full px-4 py-3 bg-dark-primary border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-accent-cyan focus:outline-none hidden mt-3">
			            </div>
			
			            <!-- Location -->
			            <div>
			                <label class="block text-sm font-medium text-gray-300 mb-2">Preferred Location</label>
			                <select id="location" class="w-full px-4 py-3 bg-dark-primary border border-gray-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none focus:ring-2 focus:ring-accent-cyan/20 transition-all">
			                    <option value="">Any Location</option>
			                    <option value="jakarta">Jakarta</option>
			                    <option value="bandung">Bandung</option>
			                    <option value="surabaya">Surabaya</option>
			                    <option value="medan">Medan</option>
			                    <option value="semarang">Semarang</option>
			                    <option value="solo">Solo</option>
			                    <option value="yogyakarta">Yogyakarta</option>
			                    <option value="bali">Bali</option>
			                    <option value="makassar">Makassar</option>
			                    <option value="manado">Manado</option>
			                    <option value="palembang">Palembang</option>
			                    <option value="tangerang">Tangerang</option>
			                    <option value="depok">Depok</option>
			                    <option value="bekasi">Bekasi</option>
			                    <option value="other">Other Location</option>
			                </select>
			                <!-- Custom Location Input (hidden by default) -->
			                <input type="text" 
			                       id="customLocation" 
			                       placeholder="Enter city or region (e.g., Lampung, Malang, Remote)" 
			                       class="w-full px-4 py-3 bg-dark-primary border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-accent-cyan focus:outline-none hidden mt-3">
			            </div>
			            
			            <!-- Experience Level -->
			            <div>
			                <label class="block text-sm font-medium text-gray-300 mb-2">Experience Level</label>
			                <select id="experience" class="w-full px-4 py-3 bg-dark-primary border border-gray-600 rounded-lg text-white focus:border-accent-cyan focus:outline-none focus:ring-2 focus:ring-accent-cyan/20 transition-all">
			                    <option value="">Any Experience Level</option>
			                    <option value="entry">Entry Level (0-2 years)</option>
			                    <option value="mid">Mid Level (3-5 years)</option>
			                    <option value="senior">Senior Level (6+ years)</option>
			                    <option value="leader">Management/Leadership</option>
			                </select>
			            </div>
			
			            <!-- Search Button with Enhanced CTAp -->
			            <div class="pt-4">
			                <button type="submit" 
			                        id="searchBtn" 
			                        class="w-full bg-gradient-to-r from-accent-cyan to-accent-teal hover:from-accent-teal hover:to-accent-cyan text-dark-primary font-bold py-4 px-6 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl transform hover:scale-[1.02] active:scale-[0.98]">
			                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
			                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 1114 0z"/>
			                    </svg>
			                    <span>Find Candidates (1 Credit)</span>
			                </button>
			            </div>
			        </form>
			    </div>
			</div>
            
            <!-- Results Area -->
            <div class="lg:col-span-2">
                <!-- Initial State -->
                <div id="initialState" class="bg-dark-secondary rounded-xl p-8 text-center">
                    <div class="w-16 h-16 bg-accent-cyan/20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-accent-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-white mb-2">Ready to Find Talent</h3>
                    <p class="text-gray-400 mb-6">Fill in the search criteria and AI will find the best matching candidates</p>
                    <div class="flex justify-center">
                        <button id="sampleSearchBtn" class="px-6 py-2 bg-dark-primary hover:bg-dark-tertiary rounded-lg text-accent-cyan border border-accent-cyan transition-colors">
                            Try Sample Search
                        </button>
                    </div>
                </div>
                
                <!-- Loading State -->
                <div id="loadingState" class="bg-dark-secondary rounded-xl p-8 text-center hidden">
                    <div class="animate-spin w-12 h-12 border-4 border-accent-cyan border-t-transparent rounded-full mx-auto mb-4"></div>
                    <h3 class="text-xl font-semibold text-white mb-2">AI-Powered Talent Discovery</h3>
                    <p class="text-gray-400 mb-6">Searching LinkedIn and analyzing candidates with artificial intelligence</p>
                    
                    <!-- Progress Bar -->
                    <div class="mb-6">
                        <div class="flex justify-between text-sm text-gray-300 mb-2">
                            <span>Progress</span>
                            <span id="progressPercentage">0%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-3">
                            <div id="progressBar" class="bg-gradient-to-r from-accent-cyan to-accent-teal h-3 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- Detailed Steps -->
                    <div class="bg-dark-primary rounded-lg p-4">
                        <div class="text-sm text-gray-300 space-y-3" id="loadingSteps">
                            <div class="flex items-center justify-between step-item" data-step="1">
                                <div class="flex items-center space-x-3">
                                    <div class="w-6 h-6 rounded-full bg-gray-600 flex items-center justify-center text-xs text-white">1</div>
                                    <span>Initializing LinkedIn search parameters</span>
                                </div>
                                <span class="text-gray-500">⏸ Pending</span>
                            </div>
                            <div class="flex items-center justify-between step-item" data-step="2">
                                <div class="flex items-center space-x-3">
                                    <div class="w-6 h-6 rounded-full bg-gray-600 flex items-center justify-center text-xs text-white">2</div>
                                    <span>Searching LinkedIn professional profiles</span>
                                </div>
                                <span class="text-gray-500">⏸ Pending</span>
                            </div>
                            <div class="flex items-center justify-between step-item" data-step="3">
                                <div class="flex items-center space-x-3">
                                    <div class="w-6 h-6 rounded-full bg-gray-600 flex items-center justify-center text-xs text-white">3</div>
                                    <span>Extracting candidate information</span>
                                </div>
                                <span class="text-gray-500">⏸ Pending</span>
                            </div>
                            <div class="flex items-center justify-between step-item" data-step="4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-6 h-6 rounded-full bg-gray-600 flex items-center justify-center text-xs text-white">4</div>
                                    <span>Running AI analysis and scoring</span>
                                </div>
                                <span class="text-gray-500">⏸ Pending</span>
                            </div>
                            <div class="flex items-center justify-between step-item" data-step="5">
                                <div class="flex items-center space-x-3">
                                    <div class="w-6 h-6 rounded-full bg-gray-600 flex items-center justify-center text-xs text-white">5</div>
                                    <span>Evaluating role and experience match</span>
                                </div>
                                <span class="text-gray-500">⏸ Pending</span>
                            </div>
                            <div class="flex items-center justify-between step-item" data-step="6">
                                <div class="flex items-center space-x-3">
                                    <div class="w-6 h-6 rounded-full bg-gray-600 flex items-center justify-center text-xs text-white">6</div>
                                    <span>Ranking candidates by compatibility</span>
                                </div>
                                <span class="text-gray-500">⏸ Pending</span>
                            </div>
                            <div class="flex items-center justify-between step-item" data-step="7">
                                <div class="flex items-center space-x-3">
                                    <div class="w-6 h-6 rounded-full bg-gray-600 flex items-center justify-center text-xs text-white">7</div>
                                    <span>Finalizing results and recommendations</span>
                                </div>
                                <span class="text-gray-500">⏸ Pending</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fun Facts -->
                    <div class="mt-4 text-xs text-gray-400" id="loadingTip">
                        💡 Tip: Higher AI scores indicate better search compatibility
                    </div>
                </div>
                
                <!-- Results State -->
                <div id="resultsState" class="hidden">
				    <!-- AI Insights Box -->
					<div id="aiInsightsBox" class="bg-gradient-to-r from-accent-cyan/10 to-accent-teal/10 border border-accent-cyan/30 rounded-xl p-6 mb-6">
					    <div class="flex items-start space-x-3">
					        <div class="w-10 h-10 bg-accent-cyan/20 rounded-lg flex items-center justify-center flex-shrink-0">
					            <svg class="w-5 h-5 text-dark-primary" fill="currentColor" viewBox="0 0 20 20">
									<path d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"/>
								</svg>
					        </div>
					        <div class="flex-1">
					            <h3 class="text-lg font-semibold text-accent-cyan mb-3 flex items-center">
					                AI Search Intelligence
					                <span class="ml-2 px-2 py-1 bg-accent-cyan/20 text-accent-cyan text-xs rounded-full font-medium">Live Analysis</span>
					            </h3>
					            <div id="aiInsightsText" class="text-gray-300 leading-relaxed">
					                Analyzing candidates and generating insights...
					            </div>
					            
					            <!-- Enhanced Stats Grid -->
					            <div id="statsGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 pt-4 border-t border-accent-cyan/20">
					                <!-- Stats will be populated by JavaScript -->
					            </div>
					        </div>
					    </div>
					</div>
				
				    <!-- Filter and Controls Section -->
				    <div class="bg-dark-secondary rounded-xl p-6 mb-6">
				        <!-- Enhanced Filter Bar -->
				        <div class="space-y-4 p-4 bg-dark-primary rounded-lg mb-4">
				            <!-- First Row: Text Search and Score Filter -->
				            <div class="flex flex-col md:flex-row md:items-center space-y-3 md:space-y-0 md:space-x-6">
				                <div class="flex-1">
				                    <input type="text" id="nameFilter" placeholder="Filter by name, title, skills..." class="w-full px-3 py-2 bg-dark-secondary border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-accent-cyan focus:outline-none">
				                </div>
				                
				                <div class="flex items-center space-x-3">
				                    <span class="text-sm text-gray-400 whitespace-nowrap">Min Score:</span>
				                    <input type="range" id="scoreFilter" min="0" max="100" value="0" class="w-20 accent-accent-cyan">
				                    <span id="scoreValue" class="text-sm text-accent-cyan font-medium w-8">0</span>
				                </div>
				            </div>
				            
				            <!-- Second Row: Other Filters -->
				            <div class="flex flex-wrap items-center gap-4">
				                <!-- Experience Filter -->
				                <div class="flex items-center space-x-3">
				                    <span class="text-sm text-gray-400">Experience:</span>
				                    <div class="flex items-center space-x-2">
				                        <span class="text-xs text-gray-500">0y</span>
				                        <input type="range" id="experienceFilter" min="0" max="15" value="0" class="w-24 accent-accent-cyan">
				                        <span class="text-xs text-gray-500">15y+</span>
				                    </div>
				                    <span id="experienceValue" class="text-sm text-accent-cyan font-medium">0+</span>
				                </div>
				                
				                <!-- Verification Filter -->
				                <div class="flex items-center space-x-3">
				                    <span class="text-sm text-gray-400">Verified:</span>
				                    <label class="flex items-center space-x-2 cursor-pointer">
				                        <input type="checkbox" id="verifiedFilter" class="w-4 h-4 text-accent-cyan bg-dark-secondary border-gray-600 rounded focus:ring-accent-cyan focus:ring-2">
				                        <span class="text-sm text-gray-300">Only verified</span>
				                    </label>
				                </div>
				                
				                <!-- Location Filter -->
				                <div class="relative">
				                    <button id="locationFilterBtn" class="flex items-center space-x-2 px-3 py-2 bg-dark-secondary border border-gray-600 rounded-lg text-white hover:border-accent-cyan transition-colors">
				                        <span class="text-sm">All Locations</span>
				                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
				                        </svg>
				                    </button>
				                    
				                    <!-- Location Dropdown -->
				                    <div id="locationDropdown" class="hidden absolute top-full left-0 mt-1 w-48 bg-dark-secondary border border-gray-600 rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto">
									    <div class="p-2 space-y-1">
									        <label class="flex items-center space-x-2 p-2 hover:bg-dark-tertiary rounded cursor-pointer">
									            <input type="checkbox" class="location-checkbox w-4 h-4 text-accent-cyan" value="jakarta" checked>
									            <span class="text-sm text-gray-300">Jakarta</span>
									        </label>
									        <label class="flex items-center space-x-2 p-2 hover:bg-dark-tertiary rounded cursor-pointer">
									            <input type="checkbox" class="location-checkbox w-4 h-4 text-accent-cyan" value="surabaya" checked>
									            <span class="text-sm text-gray-300">Surabaya</span>
									        </label>
									        <label class="flex items-center space-x-2 p-2 hover:bg-dark-tertiary rounded cursor-pointer">
									            <input type="checkbox" class="location-checkbox w-4 h-4 text-accent-cyan" value="bandung" checked>
									            <span class="text-sm text-gray-300">Bandung</span>
									        </label>
									        <label class="flex items-center space-x-2 p-2 hover:bg-dark-tertiary rounded cursor-pointer">
									            <input type="checkbox" class="location-checkbox w-4 h-4 text-accent-cyan" value="medan" checked>
									            <span class="text-sm text-gray-300">Medan</span>
									        </label>
									        <label class="flex items-center space-x-2 p-2 hover:bg-dark-tertiary rounded cursor-pointer">
									            <input type="checkbox" class="location-checkbox w-4 h-4 text-accent-cyan" value="semarang" checked>
									            <span class="text-sm text-gray-300">Semarang</span>
									        </label>
									        <label class="flex items-center space-x-2 p-2 hover:bg-dark-tertiary rounded cursor-pointer">
									            <input type="checkbox" class="location-checkbox w-4 h-4 text-accent-cyan" value="makassar" checked>
									            <span class="text-sm text-gray-300">Makassar</span>
									        </label>
									        <label class="flex items-center space-x-2 p-2 hover:bg-dark-tertiary rounded cursor-pointer">
									            <input type="checkbox" class="location-checkbox w-4 h-4 text-accent-cyan" value="palembang" checked>
									            <span class="text-sm text-gray-300">Palembang</span>
									        </label>
									        <label class="flex items-center space-x-2 p-2 hover:bg-dark-tertiary rounded cursor-pointer">
									            <input type="checkbox" class="location-checkbox w-4 h-4 text-accent-cyan" value="tangerang" checked>
									            <span class="text-sm text-gray-300">Tangerang</span>
									        </label>
									        <label class="flex items-center space-x-2 p-2 hover:bg-dark-tertiary rounded cursor-pointer">
									            <input type="checkbox" class="location-checkbox w-4 h-4 text-accent-cyan" value="depok" checked>
									            <span class="text-sm text-gray-300">Depok</span>
									        </label>
									        <label class="flex items-center space-x-2 p-2 hover:bg-dark-tertiary rounded cursor-pointer">
									            <input type="checkbox" class="location-checkbox w-4 h-4 text-accent-cyan" value="bekasi" checked>
									            <span class="text-sm text-gray-300">Bekasi</span>
									        </label>
									        <label class="flex items-center space-x-2 p-2 hover:bg-dark-tertiary rounded cursor-pointer">
									            <input type="checkbox" class="location-checkbox w-4 h-4 text-accent-cyan" value="other" checked>
									            <span class="text-sm text-gray-300">Other Locations</span>
									        </label>
									    </div>
									</div>
				                </div>
				                
				                <!-- Clear Filters -->
				                <button id="clearFilters" class="px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm rounded-lg transition-colors">
				                    Clear All
				                </button>
				            </div>
				        </div>
				
					<div class="flex flex-col space-y-4">
					    <!-- Selection Status Row -->
					    <div class="flex items-center justify-between bg-dark-primary rounded-lg p-3">
					        <div class="text-sm text-gray-400">
					            <span id="selectionCount">0 candidates selected</span>
					        </div>
					        <div class="text-xs text-gray-500">
					            Use filters above to narrow down candidates
					        </div>
					    </div>
					    
					    <!-- Action Buttons Row -->
					    <div class="flex flex-row items-center justify-between">
					        <select class="px-3 py-2 bg-dark-primary border border-gray-600 rounded-lg text-white text-sm" id="sortSelect">
					            <option value="Sort by Score">Sort by Score</option>
					            <option value="Sort by Experience">Sort by Experience</option>
					            <option value="Sort by Location">Sort by Location</option>
					        </select>
					        
					        <div class="flex flex-row items-center gap-2">
					            <!-- Bulk Analytics Button -->
								<button id="bulkAnalyticsBtn" class="hidden flex items-center justify-center px-6 py-2 min-w-48 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-medium text-sm rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
								    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
									</svg>
								    <span id="bulkAnalyticsBtnText">Analyze (0)</span>
								</button>
					            
					            <button id="compareBtn" class="hidden flex items-center justify-center px-3 py-2 w-32 bg-dark-primary border border-purple-500 text-purple-400 hover:bg-purple-500 hover:text-white font-medium text-sm rounded-lg transition-colors">
					                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
					                </svg>
					                <span id="compareBtnText">Compare</span>
					            </button>
					            
					            <button id="exportBtn" class="flex items-center justify-center px-3 py-2 w-32 bg-accent-cyan hover:bg-accent-teal text-dark-primary font-medium text-sm rounded-lg transition-colors">
					                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M8 17l4 4 4-4m-4-5v9"/>
					                </svg>
					                <span class="text-xs">Export CSV</span>
					            </button>
					
					            <button id="clearAllBtn" class="hidden flex items-center justify-center px-3 py-2 w-28 bg-gray-600 hover:bg-gray-700 text-white font-medium text-sm rounded-lg transition-colors">
					                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
					                </svg>
					                <span class="text-xs">Clear All</span>
					            </button>
					        </div>
					    </div>
					</div>
				    </div>

					<!-- Active Filters Display -->
					<div id="activeFiltersContainer" class="mb-6 hidden">
					    <div class="flex items-center justify-between mb-4">
					        <div class="flex items-center space-x-3">
					            <h4 class="text-sm font-semibold text-gray-300">Active Filters:</h4>
					            <div id="activeFiltersChips" class="flex flex-wrap gap-2">
					                <!-- Filter chips will be populated here -->
					            </div>
					        </div>
					        <button id="clearAllFiltersBtn" class="px-3 py-1.5 bg-red-600/20 hover:bg-red-600/30 text-red-400 hover:text-red-300 text-sm rounded-lg transition-colors border border-red-600/30">
					            Clear All Filters
					        </button>
					    </div>
					</div>
				    
				    <!-- Candidate Cards -->
					<div id="candidateCardsContainer" class="space-y-4">
                        <!-- Sample Candidate 1 -->
                        <div class="bg-dark-secondary rounded-xl p-6 hover:bg-dark-tertiary transition-colors cursor-pointer candidate-card" style="display: none;">
                            <div class="flex items-start justify-between">
                                <div class="flex items-start space-x-4 flex-1">
                                    <div class="w-12 h-12 bg-gray-600 rounded-full flex items-center justify-center">
                                        <span class="text-white font-semibold">AS</span>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-2 mb-1">
                                            <h4 class="text-lg font-semibold text-white">Ahmad Suharto</h4>
                                            <span class="px-2 py-1 bg-accent-cyan/20 text-accent-cyan text-xs rounded">JobStreet</span>
                                        </div>
                                        <p class="text-gray-300 mb-2">Restaurant Manager • 8 years experience</p>
                                        <p class="text-gray-400 text-sm mb-3">Jakarta Selatan • Hospitality & Tourism</p>
                                        <p class="text-gray-300 text-sm">Experienced restaurant manager with strong leadership in fine dining establishments. Proven track record in team management, cost control, and customer satisfaction...</p>
                                        <div class="flex items-center space-x-4 mt-3">
                                            <span class="text-xs text-gray-400">LinkedIn Profile Available</span>
                                            <span class="text-xs text-gray-400">Last Updated: 2 days ago</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-col items-center ml-4">
                                    <div class="relative w-16 h-16 mb-2">
                                        <div class="w-16 h-16 rounded-full score-circle flex items-center justify-center" style="--score-deg: 306deg">
                                            <div class="w-12 h-12 bg-dark-secondary rounded-full flex items-center justify-center">
                                                <span class="text-accent-cyan font-bold text-sm">85</span>
                                            </div>
                                        </div>
                                    </div>
                                    <span class="text-xs text-gray-400">AI Score</span>
                                </div>
                            </div>
                        </div>
                    <!-- Sample Candidate 2 -->
                        <div class="bg-dark-secondary rounded-xl p-6 hover:bg-dark-tertiary transition-colors cursor-pointer candidate-card" style="display: none;">
                            <div class="flex items-start justify-between">
                                <div class="flex items-start space-x-4 flex-1">
                                    <div class="w-12 h-12 bg-gray-600 rounded-full flex items-center justify-center">
                                        <span class="text-white font-semibold">SP</span>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-2 mb-1">
                                            <h4 class="text-lg font-semibold text-white">Sari Permata</h4>
                                            <span class="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded">LinkedIn</span>
                                        </div>
                                        <p class="text-gray-300 mb-2">Operations Manager • 6 years experience</p>
                                        <p class="text-gray-400 text-sm mb-3">Jakarta Pusat • Food & Beverage</p>
                                        <p class="text-gray-300 text-sm">Dynamic operations manager specializing in restaurant chains and franchise management. Expert in process optimization, staff training, and quality control...</p>
                                        <div class="flex items-center space-x-4 mt-3">
                                            <span class="text-xs text-gray-400">Full Profile Available</span>
                                            <span class="text-xs text-gray-400">Last Updated: 1 week ago</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-col items-center ml-4">
                                    <div class="relative w-16 h-16 mb-2">
                                        <div class="w-16 h-16 rounded-full score-circle flex items-center justify-center" style="--score-deg: 280deg">
                                            <div class="w-12 h-12 bg-dark-secondary rounded-full flex items-center justify-center">
                                                <span class="text-accent-cyan font-bold text-sm">78</span>
                                            </div>
                                        </div>
                                    </div>
                                    <span class="text-xs text-gray-400">AI Score</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sample Candidate 3 -->
                        <div class="bg-dark-secondary rounded-xl p-6 hover:bg-dark-tertiary transition-colors cursor-pointer candidate-card" style="display: none;">
                            <div class="flex items-start justify-between">
                                <div class="flex items-start space-x-4 flex-1">
                                    <div class="w-12 h-12 bg-gray-600 rounded-full flex items-center justify-center">
                                        <span class="text-white font-semibold">BD</span>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-2 mb-1">
                                            <h4 class="text-lg font-semibold text-white">Budi Darma</h4>
                                            <span class="px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded">Karir.com</span>
                                        </div>
                                        <p class="text-gray-300 mb-2">F&B Supervisor • 5 years experience</p>
                                        <p class="text-gray-400 text-sm mb-3">Jakarta Barat • Food & Beverage</p>
                                        <p class="text-gray-300 text-sm">Dedicated food service supervisor with experience in hotel restaurants and catering. Strong background in inventory management and team coordination...</p>
                                        <div class="flex items-center space-x-4 mt-3">
                                            <span class="text-xs text-gray-400">Contact Info Available</span>
                                            <span class="text-xs text-gray-400">Last Updated: 3 days ago</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-col items-center ml-4">
                                    <div class="relative w-16 h-16 mb-2">
                                        <div class="w-16 h-16 rounded-full score-circle flex items-center justify-center" style="--score-deg: 252deg">
                                            <div class="w-12 h-12 bg-dark-secondary rounded-full flex items-center justify-center">
                                                <span class="text-accent-cyan font-bold text-sm">70</span>
                                            </div>
                                        </div>
                                    </div>
                                    <span class="text-xs text-gray-400">AI Score</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

<!-- Footer -->
    <footer class="bg-dark-primary border-t border-gray-700 mt-12">
        <div class="max-w-7xl mx-auto px-6 py-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- Company Info -->
                <div>
                    <div class="flex items-center space-x-3 mb-4">
					    <div class="w-10 h-10 bg-accent-cyan rounded-xl flex items-center justify-center">
					        <svg class="w-6 h-6 text-dark-primary" fill="currentColor" viewBox="0 0 20 20">
					            <path d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"/>
					        </svg>
					    </div>
					    <div>
					        <h3 class="text-lg font-bold text-white">Leadfinder</h3>
					        <p class="text-xs text-gray-400">by MontPro</p>
					    </div>
					</div>
					<p class="text-gray-400 text-sm leading-relaxed">
					    AI-powered platform that finds and ranks the best candidates in seconds.
					</p>
                </div>

                <!-- Quick Links -->
                <div>
                    <h4 class="font-semibold text-white mb-4">Quick Links</h4>
                    <ul class="space-y-2">
                        <li><button onclick="showPricingPage()" class="text-gray-400 hover:text-accent-cyan text-sm transition-colors">Pricing</button></li>
                        <li><button onclick="showHowItWorks()" class="text-gray-400 hover:text-accent-cyan text-sm transition-colors">How it Works</button></li>
                        <li><button onclick="showFeatures()" class="text-gray-400 hover:text-accent-cyan text-sm transition-colors">Features</button></li>
                    </ul>
                </div>

                <!-- Legal -->
                <div>
                    <h4 class="font-semibold text-white mb-4">Legal</h4>
                    <ul class="space-y-2">
                        <li><button onclick="showPrivacyPolicy()" class="text-gray-400 hover:text-accent-cyan text-sm transition-colors">Privacy Policy</button></li>
                        <li><button onclick="showTermsOfService()" class="text-gray-400 hover:text-accent-cyan text-sm transition-colors">Terms of Service</button></li>
                        <li><button onclick="showFAQ()" class="text-gray-400 hover:text-accent-cyan text-sm transition-colors">FAQ</button></li>
                    </ul>
                </div>

                <!-- Contact -->
                <div>
		    <h4 class="font-semibold text-white mb-4">Contact & Support</h4>
		    <div class="space-y-2">
		        <div class="flex items-center space-x-2">
		            <svg class="w-4 h-4 text-accent-cyan" fill="currentColor" viewBox="0 0 20 20">
		                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
		                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
		            </svg>
		            <span class="text-gray-400">support@aapgrp.com</span>
		        </div>
		        <div class="flex items-center space-x-2">
		            <svg class="w-4 h-4 text-accent-cyan" fill="currentColor" viewBox="0 0 20 20">
		                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"/>
		            </svg>
		            <span class="text-gray-400">Jakarta, Indonesia</span>
		        </div>
		        <div class="text-gray-400 text-sm">ID | VN</div>
		    </div>
		</div>
            </div>

            <!-- Copyright -->
            <div class="border-t border-gray-700 mt-8 pt-6 text-center">
                <p class="text-gray-400 text-sm">&copy; 2025 MontPro. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Candidate Detail Modal -->
    <div id="candidateModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-dark-secondary rounded-xl max-w-4xl w-full max-h-[calc(100vh-2rem)] overflow-y-auto my-4">
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-gray-600 rounded-full flex items-center justify-center">
                            <span class="text-white font-bold text-lg">AS</span>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-white">Ahmad Suharto</h2>
                            <p class="text-gray-300">Restaurant Manager • 8 years experience</p>
                            <p class="text-gray-400">Jakarta Selatan • Available for Contact</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-center">
                            <div class="relative w-20 h-20 mb-2">
                                <div class="w-20 h-20 rounded-full score-circle flex items-center justify-center" style="--score-deg: 306deg">
                                    <div class="w-16 h-16 bg-dark-secondary rounded-full flex items-center justify-center">
                                        <span class="text-accent-cyan font-bold text-lg">85</span>
                                    </div>
                                </div>
                            </div>
                            <span class="text-sm text-gray-400">AI Match Score</span>
                        </div>
                        <button id="closeModal" class="text-gray-400 hover:text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="p-6 space-y-6">
                <!-- AI Analysis Summary -->
                <div class="bg-dark-primary rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-white mb-2 flex items-center">
					    <svg class="w-5 h-5 text-accent-cyan mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
					    </svg>
					    AI Analysis Summary
					</h3>
                    <p class="text-gray-300 mb-4">Strong match for Restaurant Manager position with excellent leadership experience and location compatibility. Recommended for immediate contact.</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <span class="text-sm text-gray-400">Role Relevance</span>
                            <div class="flex items-center space-x-2 mt-1">
                                <div class="flex-1 bg-gray-600 rounded-full h-2">
                                    <div class="bg-accent-cyan h-2 rounded-full" style="width: 90%"></div>
                                </div>
                                <span class="text-sm text-accent-cyan">90%</span>
                            </div>
                        </div>
                        <div>
                            <span class="text-sm text-gray-400">Experience Match</span>
                            <div class="flex items-center space-x-2 mt-1">
                                <div class="flex-1 bg-gray-600 rounded-full h-2">
                                    <div class="bg-accent-cyan h-2 rounded-full" style="width: 85%"></div>
                                </div>
                                <span class="text-sm text-accent-cyan">85%</span>
                            </div>
                        </div>
                        <div>
                            <span class="text-sm text-gray-400">Location Fit</span>
                            <div class="flex items-center space-x-2 mt-1">
                                <div class="flex-1 bg-gray-600 rounded-full h-2">
                                    <div class="bg-accent-cyan h-2 rounded-full" style="width: 95%"></div>
                                </div>
                                <span class="text-sm text-accent-cyan">95%</span>
                            </div>
                        </div>
                        <div>
                            <span class="text-sm text-gray-400">Profile Quality</span>
                            <div class="flex items-center space-x-2 mt-1">
                                <div class="flex-1 bg-gray-600 rounded-full h-2">
                                    <div class="bg-accent-cyan h-2 rounded-full" style="width: 70%"></div>
                                </div>
                                <span class="text-sm text-accent-cyan">70%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Details -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-lg font-semibold text-white mb-3">Profile Summary</h4>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Experience:</span>
                                <span class="text-white">8 years in hospitality</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Current Role:</span>
                                <span class="text-white">Restaurant Manager</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Location:</span>
                                <span class="text-white">Jakarta Selatan</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Source:</span>
                                <span class="text-accent-cyan">JobStreet Indonesia</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Profile Updated:</span>
                                <span class="text-white">2 days ago</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-semibold text-white mb-3">Key Strengths</h4>
                        <div class="space-y-2">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-accent-cyan rounded-full"></div>
                                <span class="text-gray-300 text-sm">Team Leadership & Management</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-accent-cyan rounded-full"></div>
                                <span class="text-gray-300 text-sm">Fine Dining Experience</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-accent-cyan rounded-full"></div>
                                <span class="text-gray-300 text-sm">Cost Control & Budget Management</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                                            <div class="w-2 h-2 bg-accent-cyan rounded-full"></div>
                                <span class="text-gray-300 text-sm">Customer Service Excellence</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-accent-cyan rounded-full"></div>
                                <span class="text-gray-300 text-sm">Multi-location Experience</span>
                            </div>
                        </div>
			<!-- Current Skills Section -->
			<div class="mt-6">
			    <h4 class="text-lg font-semibold text-white mb-3">Current Skills</h4>
			    <div id="currentSkillsContainer" class="flex flex-wrap gap-2">
				<!-- Skills will be populated by JavaScript -->
			    </div>
			</div>
			
			<!-- Growth Opportunities Section -->
			<div class="mt-6">
			    <h4 class="text-lg font-semibold text-white mb-3">Growth Opportunities</h4>
			    <div id="growthOpportunitiesContainer" class="space-y-2">
				<!-- Growth opportunities will be populated by JavaScript -->
			    </div>
			</div>
                    </div>
                </div>
                
                <!-- Potential Concerns -->
                <div class="bg-yellow-900/20 border border-yellow-600/30 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-yellow-400 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                        Potential Considerations
                    </h4>
                    <div class="space-y-2 text-sm text-yellow-100">
                        <div class="flex items-start space-x-2">
                            <span class="text-yellow-400">•</span>
                            <span>Profile hasn't been updated in 2 weeks - may indicate job satisfaction</span>
                        </div>
                        <div class="flex items-start space-x-2">
                            <span class="text-yellow-400">•</span>
                            <span>Current employment status unclear - may require verification</span>
                        </div>
                        <div class="flex items-start space-x-2">
                            <span class="text-yellow-400">•</span>
                            <span>Limited contact information available on public profile</span>
                        </div>
                    </div>
                </div>
                
                <!-- Recommendation -->
                <div class="bg-accent-cyan/10 border border-accent-cyan/30 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-accent-cyan mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        AI Recommendation
                    </h4>
                    <p class="text-gray-300 text-sm">
                        <strong>Priority Level:</strong> Ahmad shows excellent alignment with restaurant management requirements. 
                        Recommend reaching out with a personalized message highlighting career growth opportunities and competitive compensation. 
                        Best contact approach: LinkedIn message or professional email during business hours.
                    </p>
                </div>

	    		<!-- Career Predictive Analytics Section -->
			<div class="mt-6">
			    <h4 class="text-lg font-semibold text-purple-400 mb-4 flex items-center">
			        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
					</svg>
			        Career Predictive Analytics
			    </h4>
			    <div id="careerAnalyticsContent">
			        <!-- Analytics content will be populated by JavaScript -->
			    </div>
			</div>
                
                <!-- Contact Actions -->
                <div class="flex items-center space-x-3">
				    <button id="viewLinkedInBtn" class="ml-1 flex items-center justify-center px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors shadow-lg hover:shadow-xl">
				        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
				            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
				        </svg>
				        <span class="text-sm">View LinkedIn Profile</span>
				    </button>
				    <button class="flex items-center justify-center px-3 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors shadow-lg hover:shadow-xl export-modal-btn" data-type="pdf">
				        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
				        </svg>
				        <span class="text-sm">Export PDF</span>
				    </button>
				    <button class="flex items-center justify-center px-3 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors shadow-lg hover:shadow-xl export-modal-btn" data-type="csv">
				        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
				        </svg>
				        <span class="text-sm">Export CSV</span>
				    </button>
				    <button class="flex items-center justify-center px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-lg transition-colors shadow-lg hover:shadow-xl export-modal-btn" data-type="clipboard">
				        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
				        </svg>
				        <span class="text-sm">Copy to Clipboard</span>
				    </button>
					<button id="generateOutreachBtn" class="flex items-center justify-center px-3 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-medium rounded-lg transition-colors shadow-lg hover:shadow-xl">
					    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
					        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
					        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
					    </svg>
					    <span class="text-sm">Generate Message</span>
					</button>
				</div>

				<!-- AI Outreach Message Popup -->
				<div id="aiOutreachPopup" class="absolute top-0 left-0 w-full h-full z-10 hidden">
				    <!-- Backdrop -->
				    <div class="absolute inset-0 bg-black bg-opacity-30"></div>
				    
				    <!-- Popup Container -->
				    <div class="absolute bottom-8 right-8 w-[800px] max-h-[650px] bg-dark-secondary rounded-xl border border-accent-cyan/30 shadow-2xl flex flex-col z-10 overflow-hidden">
					<!-- Header -->
					<div class="flex items-center justify-between p-4 border-b border-gray-700">
					    <h3 class="text-lg font-semibold text-white flex items-center">
						<svg class="w-5 h-5 text-accent-cyan mr-2" fill="currentColor" viewBox="0 0 20 20">
						    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
						    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
						</svg>
						AI Outreach Messages
					    </h3>
					    <button id="closeOutreachPopup" class="text-gray-400 hover:text-white transition-colors">
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
						</svg>
					    </button>
					</div>
					
					<!-- Platform Tabs -->
					<div class="flex bg-dark-primary m-4 mb-0 rounded-lg p-1">
					    <button id="linkedinTab" class="flex-1 py-2 px-3 text-sm font-medium rounded-md transition-colors platform-tab active">
						<div class="flex items-center justify-center space-x-2">
						    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
							<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
						    </svg>
						    <span>LinkedIn</span>
						</div>
					    </button>
					    <button id="emailTab" class="flex-1 py-2 px-3 text-sm font-medium rounded-md transition-colors platform-tab">
						<div class="flex items-center justify-center space-x-2">
						    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
							<path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
							<path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
						    </svg>
						    <span>Email</span>
						</div>
					    </button>
					</div>

					<!-- Purpose Selection -->
					<div class="p-4 pb-2 border-b border-gray-700/50">
					    <label class="block text-sm font-medium text-gray-300 mb-2">Outreach Purpose:</label>
					    <select id="outreachPurpose" class="w-full px-3 py-2 bg-dark-primary border border-gray-600 rounded-lg text-white text-sm focus:border-accent-cyan focus:outline-none">
					        <option value="opportunity">Present job opportunity</option>
					        <option value="connect">Connect on LinkedIn</option>
					        <option value="consultation">Schedule consultation call</option>
					        <option value="custom">Custom purpose...</option>
					    </select>
					    <input type="text" id="customPurpose" placeholder="Enter your custom purpose..." 
					           class="w-full px-3 py-2 bg-dark-primary border border-gray-600 rounded-lg text-white text-sm placeholder-gray-400 focus:border-accent-cyan focus:outline-none mt-2 hidden">
					</div>

					<!-- User Company Input -->
					<div class="px-4 pb-4">
					    <label class="block text-sm font-medium text-gray-300 mb-2">Your Company:</label>
					    <input type="text" id="userCompany" placeholder="Enter your company name or leave blank for confidential" 
					           class="w-full px-3 py-2 bg-dark-primary border border-gray-600 rounded-lg text-white text-sm placeholder-gray-400 focus:border-accent-cyan focus:outline-none">
					    <p class="text-xs text-gray-400 mt-1">Leave blank to keep your company confidential in outreach</p>
					</div>

				    <!-- Language Selection -->
					<div class="px-4 pb-4">
					    <label class="block text-sm font-medium text-gray-300 mb-2">Message Language:</label>
					    <select id="messageLanguage" class="w-full px-3 py-2 bg-dark-primary border border-gray-600 rounded-lg text-white text-sm focus:border-accent-cyan focus:outline-none">
					        <option value="english">English</option>
					        <option value="indonesian">Bahasa Indonesia</option>
					    </select>
					</div>
					
					<!-- Messages Content Area -->
					<div class="flex-1 p-4 pt-2 overflow-y-auto">
					    <!-- LinkedIn Messages -->
					    <div id="linkedinMessages" class="message-content h-full space-y-3">
						<!-- Short Message -->
						<div class="message-box">
						    <div class="flex items-center justify-between mb-2">
							<span class="text-sm font-medium text-accent-cyan">Short & Direct</span>
							<button class="copy-message-btn px-2 py-1 bg-accent-cyan/20 hover:bg-accent-cyan text-accent-cyan hover:text-dark-primary rounded text-xs transition-colors" data-message-type="linkedin-short">
							    Copy
							</button>
						    </div>
						    <div class="bg-dark-primary rounded-lg p-3 text-sm text-gray-300 leading-relaxed max-h-24 overflow-y-auto">
							<div id="linkedinShortMessage">Generating message...</div>
						    </div>
						</div>
						
						<!-- Elaborate Message -->
						<div class="message-box">
						    <div class="flex items-center justify-between mb-2">
							<span class="text-sm font-medium text-accent-cyan">Detailed & Personal</span>
							<button class="copy-message-btn px-2 py-1 bg-accent-cyan/20 hover:bg-accent-cyan text-accent-cyan hover:text-dark-primary rounded text-xs transition-colors" data-message-type="linkedin-elaborate">
							    Copy
							</button>
						    </div>
						    <div class="bg-dark-primary rounded-lg p-3 text-sm text-gray-300 leading-relaxed max-h-32 overflow-y-auto">
							<div id="linkedinElaborateMessage">Generating message...</div>
						    </div>
						</div>
					    </div>
					    
					    <!-- Email Messages -->
					    <div id="emailMessages" class="message-content h-full space-y-3 hidden">
						<!-- Short Email -->
						<div class="message-box">
						    <div class="flex items-center justify-between mb-2">
							<span class="text-sm font-medium text-accent-cyan">Concise Email</span>
							<button class="copy-message-btn px-2 py-1 bg-accent-cyan/20 hover:bg-accent-cyan text-accent-cyan hover:text-dark-primary rounded text-xs transition-colors" data-message-type="email-short">
							    Copy
							</button>
						    </div>
						    <div class="bg-dark-primary rounded-lg p-3 text-sm text-gray-300 leading-relaxed max-h-24 overflow-y-auto">
							<div id="emailShortMessage">Generating message...</div>
						    </div>
						</div>
						
						<!-- Elaborate Email -->
						<div class="message-box">
						    <div class="flex items-center justify-between mb-2">
							<span class="text-sm font-medium text-accent-cyan">Professional Email</span>
							<button class="copy-message-btn px-2 py-1 bg-accent-cyan/20 hover:bg-accent-cyan text-accent-cyan hover:text-dark-primary rounded text-xs transition-colors" data-message-type="email-elaborate">
							    Copy
							</button>
						    </div>
						    <div class="bg-dark-primary rounded-lg p-3 text-sm text-gray-300 leading-relaxed max-h-32 overflow-y-auto">
							<div id="emailElaborateMessage">Generating message...</div>
						    </div>
						</div>
					    </div>
					</div>
					
					<!-- Footer Actions -->
					<div class="p-4 border-t border-gray-700 flex justify-between">
					    <button id="generateNewMessages" class="px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded-lg transition-colors flex items-center">
						    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
							    <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.847a4.5 4.5 0 003.09 3.09L15.75 12l-2.847.813a4.5 4.5 0 00-3.09 3.091zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423L16.5 15.75l.394 1.183a2.25 2.25 0 001.423 1.423L19.5 18.75l-1.183.394a2.25 2.25 0 00-1.423 1.423z"/>
							</svg>
						    Generate Messages (2 credits)
						</button>
					    <button id="closeOutreachPopupBtn" class="px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white text-sm rounded-lg transition-colors">
						Close
					    </button>
					</div>
				    </div>
				</div>	
            </div>
        </div>
    </div>

	<!-- Candidate Comparison Modal -->
	<div id="comparisonModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
	    <div class="bg-dark-secondary rounded-xl max-w-6xl w-full max-h-screen overflow-y-auto">
	        <div class="p-6 border-b border-gray-700">
	            <div class="flex items-center justify-between">
	                <h2 class="text-2xl font-bold text-white">Candidate Comparison</h2>
	                <button id="closeComparisonModal" class="text-gray-400 hover:text-white">
	                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
	                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
	                    </svg>
	                </button>
	            </div>
	        </div>
	        
	        <div class="p-6">
	            <div id="comparisonContent" class="grid gap-6">
	                <!-- Comparison content will be dynamically generated -->
	            </div>
	        </div>
	    </div>
	</div>

    <!-- Search History Modal -->
	<div id="historyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
	    <div class="bg-dark-secondary rounded-xl max-w-4xl w-full max-h-screen overflow-y-auto">
	        <div class="p-6 border-b border-gray-700">
	            <div class="flex items-center justify-between">
	                <h2 class="text-xl font-bold text-white">Search History</h2>
	                <button id="closeHistoryModal" class="text-gray-400 hover:text-white">
	                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
	                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
	                    </svg>
	                </button>
	            </div>
	            
	            <!-- History Tabs -->
	            <div class="flex space-x-1 mt-4 bg-dark-primary rounded-lg p-1">
	                <button id="basicSearchTab" class="flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors history-tab active">
	                    <div class="flex items-center justify-center space-x-2">
	                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
	                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
	                        </svg>
	                        <span>Basic Searches</span>
	                        <span id="basicSearchCount" class="bg-accent-cyan text-dark-primary px-2 py-1 rounded-full text-xs font-bold">0</span>
	                    </div>
	                </button>
	                <button id="analyticsHistoryTab" class="flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors history-tab">
	                    <div class="flex items-center justify-center space-x-2">
	                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
	                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
	                        </svg>
	                        <span>Analytics History</span>
	                        <span id="analyticsHistoryCount" class="bg-purple-500 text-white px-2 py-1 rounded-full text-xs font-bold">0</span>
	                    </div>
	                </button>
	            </div>
	        </div>
	        
	        <!-- Tab Content -->
	        <div class="p-6">
	            <!-- Basic Searches Tab Content -->
	            <div id="basicSearchContent" class="history-content">
	                <div id="basicSearchList" class="space-y-4">
	                    <!-- Basic search history will be populated here -->
	                </div>
	            </div>
	            
	            <!-- Analytics History Tab Content -->
	            <div id="analyticsHistoryContent" class="history-content hidden">
	                <div id="analyticsHistoryList" class="space-y-4">
	                    <!-- Analytics history will be populated here -->
	                </div>
	            </div>
				<!-- Saved Candidates Tab Content -->
				<div id="savedCandidatesContent" class="history-content hidden">
				    <div id="savedCandidatesList" class="space-y-4">
				        <!-- Saved candidates will be populated here -->
				    </div>
				</div>
	        </div>
	    </div>
	</div>

    <!-- Export Modal -->
    <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-dark-secondary rounded-xl max-w-md w-full">
            <div class="p-6 border-b border-gray-700">
                <h2 class="text-xl font-bold text-white">Export Results</h2>
                <p class="text-gray-400 text-sm mt-1">Choose export format for your search results</p>
            </div>
            <div class="p-6 space-y-4">
                <button class="w-full p-4 bg-dark-primary hover:bg-dark-tertiary rounded-lg transition-colors flex items-center space-x-3">
                    <svg class="w-8 h-8 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"/>
                    </svg>
                    <div class="text-left">
                        <div class="font-medium text-white">PDF Report</div>
                        <div class="text-sm text-gray-400">Detailed profiles with AI analysis</div>
                    </div>
                </button>
                
                <button class="w-full p-4 bg-dark-primary hover:bg-dark-tertiary rounded-lg transition-colors flex items-center space-x-3">
                    <svg class="w-8 h-8 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                    <div class="text-left">
                        <div class="font-medium text-white">CSV Spreadsheet</div>
                        <div class="text-sm text-gray-400">Contact info and basic details</div>
                    </div>
                </button>
                
                <button class="w-full p-4 bg-dark-primary hover:bg-dark-tertiary rounded-lg transition-colors flex items-center space-x-3">
                    <svg class="w-8 h-8 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M8 2a1 1 0 000 2h2a1 1 0 100-2H8z"/>
                        <path d="M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 10-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z"/>
                    </svg>
                    <div class="text-left">
                        <div class="font-medium text-white">Copy to Clipboard</div>
                        <div class="text-sm text-gray-400">Quick paste into other tools</div>
                    </div>
                </button>
            </div>
            <div class="p-6 border-t border-gray-700 flex justify-end">
                <button id="closeExportModal" class="px-4 py-2 text-gray-400 hover:text-white">Cancel</button>
            </div>
        </div>
    </div>

<div id="exportToast" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-dark-secondary text-accent-cyan px-6 py-3 rounded-xl shadow-lg z-50 hidden flex items-center space-x-3">
    <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
    </svg>
    <span id="exportToastText">Exporting...</span>
</div>
<!-- Auth Modal -->
<div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-dark-secondary rounded-xl max-w-md w-full">
        <div class="p-6 border-b border-gray-700">
            <h2 class="text-xl font-bold text-white">Login to Continue</h2>
            <p class="text-gray-400 text-sm mt-1">Access your credits and search history</p>
        </div>
        <div class="p-6 space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                <input type="email" id="authEmail" placeholder="Enter your email" 
                       class="w-full px-4 py-3 bg-dark-primary border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-accent-cyan focus:outline-none">
            </div>
            
            <button id="magicLinkBtn" class="w-full bg-accent-cyan hover:bg-accent-teal text-dark-primary font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl">
			    <span class="button-text flex items-center justify-center space-x-2">
			        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
			            <path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.477.859h4z"/>
			        </svg>
			        <span>Get Instant Access</span>
			    </span>
			    <span class="button-loading hidden flex items-center justify-center">
			        <svg class="animate-spin -ml-1 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24">
			            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
			            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
			        </svg>
			        Getting access...
			    </span>
			</button>
            
            <div class="relative">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-600"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                    <span class="px-2 bg-dark-secondary text-gray-400">or</span>
                </div>
            </div>
            
            <button id="googleAuthBtn" class="w-full bg-white hover:bg-gray-100 text-gray-900 font-semibold py-3 px-6 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 transform hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl">
			    <span class="button-content flex items-center space-x-2">
			        <svg class="w-5 h-5" viewBox="0 0 24 24">
			            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
			            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
			            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
			            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
			        </svg>
			        <span>Continue with Google</span>
			    </span>
			    <span class="button-loading hidden flex items-center">
			        <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
			            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
			            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
			        </svg>
			    </span>
			</button>
            
            <div id="authMessage" class="text-sm text-center hidden"></div>
        </div>
        <div class="p-6 border-t border-gray-700 flex justify-end">
            <button id="closeAuthModal" class="px-4 py-2 text-gray-400 hover:text-white">Cancel</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
	console.log('JavaScript is running!');
	console.log('Step 1: Starting initialization...');

const SUPABASE_URL = 'https://brawqzylfyuotgxqmtox.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJyYXdxenlsZnl1b3RneHFtdG94Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1MTU0NTUsImV4cCI6MjA2NDA5MTQ1NX0.P4qazlzBHk66eItqBRK-6k2ll2I1d754ke5_r_hNxos';
const WEBHOOK_SECRET = 'leadfinder_secretkey123';
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
    auth: {
        autoRefreshToken: true,
        persistSession: true,
        detectSessionInUrl: true
    }
});



let currentUser = null;
let userCredits = 0;
	console.log('Step 3: Variables declared');
let currentSearchResults = [];
let currentCandidates = [];
let progressInterval = null;
let activeCandidate = null;
let currentHistoryData = [];
let isSearching = false;
let isAnalyzing = false;
let loadingCancelled = false;
window.showPricingPage = showPricingPage;
window.showPrivacyPolicy = showPrivacyPolicy;
window.showHowItWorks = showHowItWorks;
window.showFAQ = showFAQ;
window.showFeatures = showFeatures;
window.showTermsOfService = showTermsOfService;
window.hideTermsOfService = hideTermsOfService;
	
// Authentication functions
function showAuthModal() {
    document.getElementById('authModal').classList.remove('hidden');
}

function hideAuthModal() {
    document.getElementById('authModal').classList.add('hidden');
}

function updateCreditsDisplay() {
    const creditsElement = document.getElementById('creditsDisplay');
    const refreshBtn = document.getElementById('refreshCreditsBtn');
    
    if (!creditsElement) return;
    
    // Update main credits display with enhanced styling
    if (userCredits <= 0) {
        creditsElement.innerHTML = `
            <span class="text-red-400 font-bold">0 credits</span>
            <span class="text-red-300 text-xs ml-1">- Buy more!</span>
        `;
        creditsElement.className = creditsElement.className.replace('text-accent-cyan', 'text-red-400');
        
        // Show pulsing animation for empty credits
        creditsElement.parentElement.classList.add('animate-pulse');
        
    } else if (userCredits <= 3) {
        creditsElement.innerHTML = `
            <span class="text-yellow-400 font-bold">${userCredits} credits</span>
            <span class="text-yellow-300 text-xs ml-1">- Running low</span>
        `;
        creditsElement.className = creditsElement.className.replace('text-accent-cyan', 'text-yellow-400');
        creditsElement.parentElement.classList.remove('animate-pulse');
        
    } else {
        creditsElement.innerHTML = `
            <span class="text-accent-cyan font-bold">${userCredits} credits</span>
        `;
        creditsElement.className = creditsElement.className.replace(/text-(red|yellow)-400/, 'text-accent-cyan');
        creditsElement.parentElement.classList.remove('animate-pulse');
    }
    
    // Add buy credits button when low
    if (userCredits <= 2) {
        showLowCreditsBanner();
    } else {
        hideLowCreditsBanner();
    }
    
    console.log('Credits display updated:', userCredits);
}

// Enhanced low credits banner
function showLowCreditsBanner() {
    // Check if banner already exists
    let banner = document.getElementById('lowCreditsBanner');
    
    if (!banner) {
        // Create the banner
        banner = document.createElement('div');
        banner.id = 'lowCreditsBanner';
        banner.className = 'fixed top-20 left-1/2 transform -translate-x-1/2 z-50 transition-all duration-500';
        
        banner.innerHTML = `
            <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 rounded-lg shadow-xl border border-orange-400 max-w-md">
                <div class="flex items-center space-x-3">
                    <svg class="w-5 h-5 text-yellow-200 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    <div class="flex-1">
                        <div class="font-semibold text-sm">Credits Running Low!</div>
                        <div class="text-xs opacity-90">Buy more to continue searching</div>
                    </div>
                    <button onclick="showPricingPage()" class="bg-white text-orange-600 px-3 py-1 rounded text-sm font-semibold hover:bg-gray-100 transition-colors">
                        Buy Now
                    </button>
                    <button onclick="hideLowCreditsBanner()" class="text-white hover:text-gray-200 ml-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(banner);
    }
    
    // Show banner with animation
    banner.style.transform = 'translateX(-50%) translateY(-20px)';
    banner.style.opacity = '1';
}

function hideLowCreditsBanner() {
    const banner = document.getElementById('lowCreditsBanner');
    if (banner) {
        banner.style.transform = 'translateX(-50%) translateY(-100px)';
        banner.style.opacity = '0';
        setTimeout(() => {
            if (banner.parentNode) {
                banner.parentNode.removeChild(banner);
            }
        }, 500);
    }
}

// Enhanced search validation with payment prompts
function validateSearchCredits() {
    if (userCredits <= 0) {
        // Show attractive payment prompt instead of just error
        showCreditPurchasePrompt();
        return false;
    }
    return true;
}

function showCreditPurchasePrompt() {
    // Create overlay
    const overlay = document.createElement('div');
    overlay.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[60]';
    overlay.id = 'creditPromptOverlay';
    
    overlay.innerHTML = `
        <div class="bg-dark-primary rounded-xl p-8 max-w-md w-full mx-4 border border-gray-600 transform scale-95 transition-transform duration-300">
            <div class="text-center">
                <!-- Icon -->
                <div class="w-16 h-16 mx-auto mb-6 bg-gradient-to-r from-orange-500/20 to-red-500/20 rounded-full flex items-center justify-center">
                    <svg class="w-8 h-8 text-orange-400" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V4z"/>
                    </svg>
                </div>
                
                <h3 class="text-xl font-bold text-white mb-2">No Credits Remaining</h3>
                <p class="text-gray-300 mb-6">You need credits to search for candidates. Each search costs 1 credit.</p>
                
                <!-- Quick stats -->
                <div class="bg-dark-secondary rounded-lg p-4 mb-6">
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-accent-cyan">30</div>
                            <div class="text-gray-400">Credits</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-400">~20k</div>
                            <div class="text-gray-400">per search</div>
                        </div>
                    </div>
                </div>
                
                <!-- Action buttons -->
                <div class="space-y-3">
                    <button onclick="showPricingPage(); closeCreditPrompt();" class="w-full bg-gradient-to-r from-accent-cyan to-accent-teal hover:from-accent-teal hover:to-accent-cyan text-dark-primary font-bold py-3 px-6 rounded-lg transition-all duration-300">
                        Buy 30 Credits - Rp 599.000
                    </button>
                    <button onclick="closeCreditPrompt();" class="w-full bg-dark-secondary hover:bg-dark-tertiary text-gray-300 font-medium py-2 px-6 rounded-lg transition-colors">
                        Maybe Later
                    </button>
                </div>
                
                <!-- Trust indicators -->
                <div class="mt-4 flex items-center justify-center space-x-4 text-xs text-gray-400">
                    <span>🔒 Secure Payment</span>
                    <span>⚡ Instant Activation</span>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(overlay);
    
    // Animate in
    setTimeout(() => {
        overlay.querySelector('div').style.transform = 'scale(1)';
    }, 100);
    
    // Close on overlay click
    overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
            closeCreditPrompt();
        }
    });
}

function closeCreditPrompt() {
    const overlay = document.getElementById('creditPromptOverlay');
    if (overlay) {
        overlay.querySelector('div').style.transform = 'scale(0.95)';
        overlay.style.opacity = '0';
        setTimeout(() => {
            if (overlay.parentNode) {
                overlay.parentNode.removeChild(overlay);
            }
        }, 300);
    }
}

// Enhanced pricing page function with psychological triggers
function updatePricingPageInfo() {
    const freeRemaining = Math.max(0, 5 - userCredits);
    const freeCreditsDisplay = document.getElementById('freeCreditsRemaining');
    
    if (freeCreditsDisplay) {
        if (freeRemaining > 0) {
            freeCreditsDisplay.innerHTML = `
                <span class="text-green-400">${freeRemaining} free searches remaining this month</span>
            `;
        } else {
            freeCreditsDisplay.innerHTML = `
                <span class="text-red-400">No free searches remaining</span>
                <div class="text-xs text-gray-400 mt-1">Free credits reset on the 1st of each month</div>
            `;
        }
    }
    
    // Add urgency indicators
    addUrgencyIndicators();
}

function addUrgencyIndicators() {
    // Add time-based urgency (example: discount ending soon)
    const urgencyContainer = document.getElementById('urgencyIndicator');
    if (urgencyContainer) {
        const now = new Date();
        const dayOfMonth = now.getDate();
        
        if (dayOfMonth > 25) {
            urgencyContainer.innerHTML = `
                <div class="bg-red-500/10 border border-red-500/30 rounded-lg p-3 text-center">
                    <div class="text-red-400 font-semibold text-sm">⏰ Month ending soon!</div>
                    <div class="text-xs text-gray-300">Your free credits reset in ${31 - dayOfMonth} days</div>
                </div>
            `;
        } else {
            urgencyContainer.innerHTML = '';
        }
    }
}
	
function showAuthMessage(message, type) {
	const messageEl = document.getElementById('authMessage');
	messageEl.textContent = message;
	messageEl.className = `text-sm text-center ${type === 'error' ? 'text-red-400' : 'text-accent-cyan'}`;
	messageEl.classList.remove('hidden');
	setTimeout(() => { messageEl.classList.add('hidden'); }, 5000);
}

let isCheckingCredits = false;

async function checkAuthAndCredits() {
    if (isCheckingCredits) {
        console.log('checkAuthAndCredits already running, skipping...');
        return false;
    }
    
    isCheckingCredits = true;
    console.log('=== checkAuthAndCredits() called ===');
    console.trace('Called from:');
    
    try {
        console.log('currentUser at start:', currentUser);
        
        if (!currentUser) {
            console.log('No currentUser, getting from auth...');
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (!user) {
                console.log('No user found, showing auth modal');
                showAuthModal();
                return false;
            }
            currentUser = user;
            console.log('Got user from auth:', currentUser.id);
        }

        console.log('Fetching profile for user:', currentUser.id);
        console.log('About to run Supabase query...');

        const { data: profile, error } = await supabaseClient
            .from('leadfinder_users')
            .select('credits')
            .eq('id', currentUser.id)
            .single();
            
        console.log('Supabase query completed');
        console.log('Profile fetch result:', { profile, error });

        if (error) {
            console.log('Error fetching profile:', error);
            if (error.code === 'PGRST116') {
                console.log('Profile not found, creating new profile...');
                await new Promise(resolve => setTimeout(resolve, 200));
                console.log('User data for creation:', {
                    id: currentUser.id,
                    email: currentUser.email,
                    full_name: currentUser.user_metadata?.full_name || currentUser.email
                });
                
                const { data: newProfile, error: insertError } = await supabaseClient
                    .from('leadfinder_users')
                    .insert({
                        id: currentUser.id,
                        email: currentUser.email,
                        full_name: currentUser.user_metadata?.full_name || currentUser.email,
                        credits: 5
                    })
                    .select()
                    .single();
                    
                console.log('Insert result:', { newProfile, insertError });
                
                if (insertError) {
                    console.error('Insert error details:', insertError);
                    showCustomToast('Account Error', 'User creation failed: ' + insertError.message, 'error');
                    return false;
                } else {
                    userCredits = newProfile.credits || 5;  // ← Changed from 3 to 5
                    updateCreditsDisplay();
                    console.log('New profile created with credits:', userCredits);
                    return true;
                }
            } else {
                console.error('Profile fetch error:', error);
                showCustomToast('Profile Error', 'Error fetching profile: ' + error.message, 'error');
                return false;
            }
        }

        if (profile) {
            console.log('Profile found! Credits from DB:', profile.credits);
            userCredits = profile.credits || 0;
            console.log('userCredits set to:', userCredits);
            updateCreditsDisplay();
            console.log('Credits display updated');
            return true;  // ← Changed: return true if user has profile (even with 0 credits)
        }

        console.log('No profile data returned');
        return false;

    } catch (timeoutError) {
        console.error('Query failed or timed out:', timeoutError);
        showCustomToast('Profile Error', 'Failed to load profile: ' + timeoutError.message, 'error');
        return false;  // ← Changed: don't fallback to manual credits, return false
    } finally {
        isCheckingCredits = false;
    }
}

// Event-driven credit sync - only check when needed
async function syncCreditsAfterEvent(eventType = 'manual') {
    if (!currentUser) return;
    
    console.log(`=== SYNCING CREDITS AFTER: ${eventType} ===`);
    
    try {
        const { data: profile } = await supabaseClient
            .from('leadfinder_users')
            .select('credits')
            .eq('id', currentUser.id)
            .single();
        
        if (profile && profile.credits !== userCredits) {
            const oldCredits = userCredits;
            userCredits = profile.credits;
            updateCreditsDisplay();
            
            console.log(`Credits updated: ${oldCredits} → ${userCredits} (${eventType})`);
            
            // Show toast for external changes (not from our own actions)
            if (eventType === 'manual' || eventType === 'payment') {
                showCustomToast('Credits Updated', 
                    `Your credits have been updated to ${userCredits}`, 
                    'info', 3000);
            }
        }
    } catch (error) {
        console.log('Credit sync failed:', error);
    }
}

function showPrivacyPolicy() {
    document.getElementById('privacyPolicyPage').classList.remove('hidden');
}

function hidePrivacyPolicy() {
    document.getElementById('privacyPolicyPage').classList.add('hidden');
}

function showHowItWorks() {
    document.getElementById('howItWorksPage').classList.remove('hidden');
}

function hideHowItWorks() {
    document.getElementById('howItWorksPage').classList.add('hidden');
}

function showFAQ() {
    document.getElementById('faqPage').classList.remove('hidden');
}

function hideFAQ() {
    document.getElementById('faqPage').classList.add('hidden');
}

function showTermsOfService() {
    document.getElementById('termsOfServicePage').classList.remove('hidden');
}

function hideTermsOfService() {
    document.getElementById('termsOfServicePage').classList.add('hidden');
}

// FAQ Accordion functionality
document.addEventListener('click', (e) => {
    // FAQ question click
    if (e.target.closest('.faq-question')) {
        const question = e.target.closest('.faq-question');
        const answer = question.nextElementSibling;
        const arrow = question.querySelector('.faq-arrow');
        
        // Toggle answer visibility
        answer.classList.toggle('hidden');
        
        // Rotate arrow
        if (answer.classList.contains('hidden')) {
            arrow.style.transform = 'rotate(0deg)';
        } else {
            arrow.style.transform = 'rotate(180deg)';
        }
    }
    
    // Category filter buttons
    if (e.target.closest('.faq-category-btn')) {
        const category = e.target.closest('.faq-category-btn').dataset.category;
        
        // Remove active class from all category buttons
        document.querySelectorAll('.faq-category-btn').forEach(btn => {
            btn.classList.remove('ring-2', 'ring-accent-cyan');
        });
        
        // Add active class to clicked button
        e.target.closest('.faq-category-btn').classList.add('ring-2', 'ring-accent-cyan');
        
        // Hide all sections
        document.querySelectorAll('.faq-section').forEach(section => {
            section.style.display = 'none';
        });
        
        // Show target section
        const targetSection = document.querySelector(`[data-category="${category}"]`);
        if (targetSection) {
            targetSection.style.display = 'block';
        }
    }

	// Features modal handlers
    const closeFeaturesBtn = document.getElementById('closeFeatures');
    if (closeFeaturesBtn) {
        closeFeaturesBtn.addEventListener('click', function() {
            document.getElementById('featuresPage').classList.add('hidden');
        });
    }

    // Close when clicking outside
    const featuresModal = document.getElementById('featuresPage');
    if (featuresModal) {
        featuresModal.addEventListener('click', function(e) {
            if (e.target === this) {
                document.getElementById('featuresPage').classList.add('hidden');
            }
        });
    }
});

function showFeatures() {
    document.getElementById('featuresPage').classList.remove('hidden');
}

function hideFeatures() {
    document.getElementById('featuresPage').classList.add('hidden');
}
	
// Pricing page management
function showPricingPage() {
    document.getElementById('pricingPage').classList.remove('hidden');
    updatePricingPageInfo();
}

function hidePricingPage() {
    document.getElementById('pricingPage').classList.add('hidden');
}

function updatePricingPageInfo() {
    // Update free credits remaining display
    const freeRemaining = getFreeCreditsRemaining();
    const freeCreditsDisplay = document.getElementById('freeCreditsRemaining');
    if (freeCreditsDisplay) {
        freeCreditsDisplay.textContent = `${freeRemaining} searches remaining this month`;
    }
}

function getFreeCreditsRemaining() {
    // This is a simplified version - you'll need to implement monthly reset logic
    // For now, assume user has their current credits or 5, whichever is less
    return Math.min(userCredits, 5);
}

function shouldShowLowCreditWarning() {
    return userCredits <= 1;
}

// Replace the old subscribeToCredits function
function subscribeToCredits() {
    console.log('=== CREDIT SYNC: Event-driven mode enabled ===');
    // No polling - credits will sync after specific events
}
	
async function deductCredit(amount = 1) {
	console.log('=== DEDUCT CREDIT DEBUG ===');
	console.log('Amount to deduct:', amount);
	console.log('Current userCredits before:', userCredits);
	
	if (userCredits < amount) {
		console.log('Not enough credits!');
		return false;
	}
	
	const newCredits = userCredits - amount;
	console.log('Calculated newCredits:', newCredits);
	
	const { error } = await supabaseClient
		.from('leadfinder_users')
		.update({ credits: newCredits, updated_at: new Date().toISOString() })
		.eq('id', currentUser.id);
		
	if (!error) {
		console.log('Database update successful');
		userCredits = newCredits;
		console.log('Frontend userCredits after:', userCredits);
		updateCreditsDisplay();
		return true;
	} else {
		console.log('Database error:', error);
		return false;
	}
}
	
async function signInWithMagicLink() {
    const email = document.getElementById('authEmail').value;
    if (!email) {
        showAuthMessage('Please enter your email', 'error');
        return;
    }
    
    // Show loading state
    const button = document.getElementById('magicLinkBtn');
    button.disabled = true;
    button.querySelector('.button-text').classList.add('hidden');
    button.querySelector('.button-loading').classList.remove('hidden');
    
    const { error } = await supabaseClient.auth.signInWithOtp({
        email: email,
        options: { emailRedirectTo: window.location.origin }
    });
    
    if (error) {
        showAuthMessage(error.message, 'error');
        // Reset button state
        button.disabled = false;
        button.querySelector('.button-text').classList.remove('hidden');
        button.querySelector('.button-loading').classList.add('hidden');
    } else {
        showAuthMessage('Check your email for instant access!', 'success');
        // Keep button in success state
    }
}

async function signInWithGoogle() {
    // Show loading state
    const button = document.getElementById('googleAuthBtn');
    button.disabled = true;
    button.querySelector('.button-content').classList.add('hidden');
    button.querySelector('.button-loading').classList.remove('hidden');
    
    const { error } = await supabaseClient.auth.signInWithOAuth({
        provider: 'google',
        options: { redirectTo: window.location.origin }
    });
    
    if (error) {
        showAuthMessage(error.message, 'error');
        // Reset button state
        button.disabled = false;
        button.querySelector('.button-content').classList.remove('hidden');
        button.querySelector('.button-loading').classList.add('hidden');
    }
    // If successful, page will redirect so no need to reset button
}

let authInitialized = false;
let authTimeout = null;

let profileCreationInProgress = false;
let lastProcessedSession = null; // Track processed sessions
let authProcessingTimeout = null; // Debounce auth processing

supabaseClient.auth.onAuthStateChange(async (event, session) => {
    console.log('Auth state change:', event, 'authInitialized:', authInitialized);
    console.log('Session exists:', !!session, 'User ID:', session?.user?.id);
    
    // Prevent processing the same session multiple times
    const sessionId = session?.access_token?.substring(0, 10) || 'no-session';
    if (sessionId === lastProcessedSession && sessionId !== 'no-session') {
        console.log('Same session already processed, skipping');
        return;
    }
    
    if ((event === 'SIGNED_IN' || event === 'INITIAL_SESSION') && session) {
        console.log('Inside auth handler - about to set currentUser');
        currentUser = session.user;
        hideAuthModal();
        
        // Only run once per session AND prevent overlapping calls
        if (!authInitialized && !profileCreationInProgress) {
            console.log('About to call checkAuthAndCredits');
            authInitialized = true;
            profileCreationInProgress = true;
            lastProcessedSession = sessionId; // Mark this session as processed
            
            // Clear any existing timeout
            clearTimeout(authTimeout);
            clearTimeout(authProcessingTimeout);
            
            // Debounce: wait a bit in case more auth events come rapidly
            authProcessingTimeout = setTimeout(async () => {
                try {
                    await checkAuthAndCredits();
                    subscribeToCredits();
                } finally {
                    profileCreationInProgress = false;
                }
            }, 200); // Slightly longer delay to let auth settle
        } else {
            console.log('Skipped checkAuthAndCredits - authInitialized:', authInitialized, 'profileCreationInProgress:', profileCreationInProgress);
        }
    } else if (event === 'SIGNED_OUT') {
        clearTimeout(authTimeout);
        clearTimeout(authProcessingTimeout);
        authInitialized = false;
        profileCreationInProgress = false;
        lastProcessedSession = null; // Reset on sign out
        currentUser = null;
        userCredits = 0;
        updateCreditsDisplay();
		hideLowCreditsBanner();
        showAuthModal();
    }
});

// --- 4. Main session check on page load ---
console.log('Step 4: Initializing auth system...');
try {
    const { data: { session } } = await supabaseClient.auth.getSession();
    console.log('Initial session check:', !!session);
    if (session) {
        console.log('Found existing session, user:', session.user.id);
        // Don't do anything here, let the auth state change handler deal with it
    } else {
        console.log('No existing session found');
    }
} catch (error) {
    console.log('Auth check failed:', error);
}
console.log('Step 6: Auth handling completed');

console.log('Step 7: Moving to DOM elements...');

// --- 5. Event listeners ---
document.getElementById('magicLinkBtn').addEventListener('click', signInWithMagicLink);
document.getElementById('googleAuthBtn').addEventListener('click', signInWithGoogle);
document.getElementById('closeAuthModal').addEventListener('click', hideAuthModal);
       
let searchHistory = JSON.parse(localStorage.getItem('leadfinder_history') || '[]');
		        
// DOM elements
console.log('Step 4: Looking for DOM elements...');
const searchForm = document.getElementById('searchForm');
console.log('searchForm element:', searchForm);
const initialState = document.getElementById('initialState');
console.log('initialState found:', initialState);
const loadingState = document.getElementById('loadingState');
const resultsState = document.getElementById('resultsState');
const candidateModal = document.getElementById('candidateModal');
const historyModal = document.getElementById('historyModal');
const exportModal = document.getElementById('exportModal');

// Form submission
if (searchForm) {
    console.log('Adding submit listener to form');
    searchForm.addEventListener('submit', function(e) {
        console.log('Form submitted! Preventing default...');
        e.preventDefault();
        console.log('About to call handleSearch');
        handleSearch(e);
    });
} else {
    console.log('ERROR: searchForm not found!');
}

// Handle custom location input
document.getElementById('location').addEventListener('change', function() {
    const locationSelect = this;
    const customLocationInput = document.getElementById('customLocation');
    
    if (locationSelect.value === 'other') {
        // Show custom input with smooth animation
        customLocationInput.classList.remove('hidden');
        customLocationInput.focus();
    } else {
        // Hide custom input
        customLocationInput.classList.add('hidden');
        customLocationInput.value = ''; // Clear the custom input when hidden
    }
});

// Handle custom industry input
document.getElementById('industry').addEventListener('change', function() {
    const industrySelect = this;
    const customIndustryInput = document.getElementById('customIndustry');
    
    if (industrySelect.value === 'custom') {
        // Show custom input with smooth animation
        customIndustryInput.classList.remove('hidden');
        customIndustryInput.focus();
    } else {
        // Hide custom input
        customIndustryInput.classList.add('hidden');
        customIndustryInput.value = ''; // Clear the custom input when hidden
    }
});

// ADD THESE DEBUG LINES:
console.log('Search form found:', document.getElementById('searchForm'));
console.log('Sample search button found:', document.getElementById('sampleSearchBtn'));

// Sample search (fills the form with a demo search)
document.getElementById('sampleSearchBtn').addEventListener('click', () => {
    document.getElementById('jobTitle').value = 'Restaurant Manager';
    document.getElementById('industry').value = 'hospitality';
    document.getElementById('location').value = 'jakarta';
    document.getElementById('experience').value = 'mid';
});

// Sample search (fills the form with a demo search)
const sampleBtn = document.getElementById('sampleSearchBtn');
if (sampleBtn) {
    console.log('Attaching click listener to sample button');
    sampleBtn.addEventListener('click', (e) => {
        console.log('Sample button clicked!');
        e.preventDefault();
        e.stopPropagation();
        
        document.getElementById('jobTitle').value = 'Restaurant Manager';
        document.getElementById('industry').value = 'hospitality';
        document.getElementById('location').value = 'jakarta';
        document.getElementById('experience').value = 'mid';
        console.log('Form values set');
    });
    console.log('Sample button listener attached');
} else {
    console.log('Sample button not found!');
}

// Candidate card modal opening by card click (delegated)
document.addEventListener('click', (e) => {
    // Don't open modal if we're upgrading a candidate
    if (window.upgradingCandidate) return;
    
    if (e.target.closest('.candidate-card') && 
        !e.target.closest('.bookmark-icon') && 
        !e.target.closest('.bookmark-ribbon') &&
        !e.target.closest('.upgrade-analytics-btn') &&
        !e.target.closest('.candidate-checkbox')) {
        const candidateId = e.target.closest('.candidate-card').getAttribute('data-candidate-id');
        const candidate = currentCandidates.find(c => c.id === candidateId);
        if (candidate) {
            showCandidateModal(candidate);
        }
    }
});
	
// Export button for main list
document.getElementById('exportBtn').addEventListener('click', async () => {
    showExportToast("Exporting CSV...");
    // Wait for effect
    await new Promise(r => setTimeout(r, 1000));
    downloadCSV();
    hideExportToast();
});

// --- Main Search Handler and Helpers ---

// Get location value (either from dropdown or custom input)
function getLocationValue() {
    const locationSelect = document.getElementById('location');
    const customLocation = document.getElementById('customLocation');
    
    if (locationSelect.value === 'other' && customLocation.value.trim()) {
        return customLocation.value.trim();
    } else if (locationSelect.value && locationSelect.value !== 'other') {
        return locationSelect.value;
    } else {
        return '';
    }
}

// Get industry value (either from dropdown or custom input)
function getIndustryValue() {
    const industrySelect = document.getElementById('industry');
    const customIndustry = document.getElementById('customIndustry');
    
    if (industrySelect.value === 'custom' && customIndustry.value.trim()) {
        return customIndustry.value.trim();
    } else if (industrySelect.value && industrySelect.value !== 'custom') {
        return industrySelect.value;
    } else {
        return '';
    }
}
	
// Handle search form submission
async function handleSearch(e) {
    e.preventDefault();
    
    // Check if another operation is in progress
    if (isSearching || isAnalyzing) {
        showCustomToast('Please Wait', 'Another operation is in progress', 'info');
        return;
    }
    isSearching = true;
    
    // Check auth first, then credits
    const hasValidAuth = await checkAuthAndCredits();
    if (!hasValidAuth) {
        isSearching = false;
        return; // Auth modal will be shown by checkAuthAndCredits()
    }

    // Check if user has credits
    if (userCredits <= 0) {
        showPricingPage();
        isSearching = false;
        return;
    }
    
    const creditsRequired = 1;
    if (userCredits < creditsRequired) {
        showCustomToast('Insufficient Credits', `You need ${creditsRequired} credits for this search type.`, 'error');
        isSearching = false;
        return;
    }

    const formData = new FormData(searchForm);
    const searchParams = {
        jobTitle: formData.get('jobTitle') || document.getElementById('jobTitle').value,
        industry: getIndustryValue(), 
        location: getLocationValue(), 
        experience: formData.get('experience') || document.getElementById('experience').value
    };

    // Validate required fields
    if (!searchParams.jobTitle) {
        console.log('FAILED: No job title');
        showCustomToast('Missing Information', 'Please enter a job title or role', 'error');
        isSearching = false;
        return;
    }

    // Show loading state
    initialState.classList.add('hidden');
    resultsState.classList.add('hidden');
    loadingState.classList.remove('hidden');
    console.log('Loading state shown');

    const loadingPromise = showEnhancedLoading();
    let timeoutId;

    try {
        console.log('About to make API call...');
        const controller = new AbortController();
        timeoutId = setTimeout(() => controller.abort(), 300000);
        
        const response = await fetch('https://montpro.app.n8n.cloud/webhook/leadfinder-tool', {
            method: 'POST',
            signal: controller.signal,
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': `Bearer leadfinder_secretkey123`,
                'X-User-ID': currentUser?.id || 'test-user-123'
            },
            body: JSON.stringify({
                ...searchParams,
                userId: currentUser?.id || 'test-user-123',
                timestamp: new Date().toISOString()
            })
        });

        console.log('Response received:', response.status, response.statusText);
        console.log('Response headers:', Object.fromEntries(response.headers.entries()));

        if (!response.ok) {
            const errorText = await response.text();
            console.log('Error response body:', errorText);
            throw new Error(`HTTP error! status: ${response.status}, body: ${errorText}`);
        }

        const data = await response.json();
        console.log('JSON parsed successfully:', data);
        
        // Handle array response from backend
        const responseData = Array.isArray(data) ? data[0] : data;
        console.log('Processed response data:', responseData);
        await loadingPromise;

        if (responseData.success) {
            console.log('Data has success=true, processing results...');
            cancelLoadingAnimation();
            
            // DEDUCT CREDIT AND LOG TRANSACTION (with error handling)
            try {
                const creditDeducted = await deductCredit(1);
                if (creditDeducted) {
                    await logCreditTransaction(-1, 'search', `Search: ${searchParams.jobTitle} in ${searchParams.location}`);
                    await syncCreditsAfterEvent('search_completed');
                    console.log('Credit deducted successfully');
                }
            } catch (creditError) {
                console.log('Credit deduction failed, continuing with search:', creditError);
            }
            
            // Use new structure - topCandidatesCount instead of results.totalFound
            saveToSearchHistory(searchParams, responseData.topCandidatesCount, responseData.candidates);
            processSearchResults(responseData, searchParams); // Pass searchParams for query reconstruction
            loadingState.classList.add('hidden');
            resultsState.classList.remove('hidden');
        } else {
            throw new Error(responseData.error || 'Search failed - no success flag');
        }
        
        clearTimeout(timeoutId);
        isSearching = false;
        
    } catch (error) {
        console.error('Detailed error information:');
        console.error('Error name:', error.name);
        console.error('Error message:', error.message);
        console.error('Error stack:', error.stack);
        
        if (timeoutId) clearTimeout(timeoutId);
        cancelLoadingAnimation();
        isSearching = false;
        
        if (error.name === 'AbortError') {
            showCustomToast('Search Timeout', 'Search is taking longer than expected. Please try again.', 'error');
        } else {
            // Handle other types of errors
            console.error('Search failed:', error);
            showCustomToast('Search Failed', error.message || 'An unexpected error occurred. Please try again.', 'error');
        }
        
        // Show initial state again on error
        loadingState.classList.add('hidden');
        initialState.classList.remove('hidden');
    }
}

// Log credit transaction
async function logCreditTransaction(amount, type, description) {
    if (!currentUser) return;
    
    try {
        const { error } = await supabaseClient
            .from('credit_transactions')
            .insert({
                user_id: currentUser.id,
                amount: amount,
                transaction_type: type,
                description: description,
                created_at: new Date().toISOString()
            });
            
        if (error) {
            console.error('Failed to log transaction:', error);
        } else {
            console.log('Transaction logged:', type, amount, 'credits');
        }
    } catch (error) {
        console.error('Transaction logging error:', error);
    }
}
	
// --- Results Processing & Candidate Rendering ---

// Process backend results and update UI
function processSearchResults(data, searchParams) {
    // Handle array response from backend
    const responseData = Array.isArray(data) ? data[0] : data;
    
    // Reconstruct the query object from frontend search parameters
    const reconstructedQuery = {
        jobTitle: searchParams.jobTitle || "Unknown",
        industry: searchParams.industry || "General", 
        location: searchParams.location || "Indonesia",
        experience: searchParams.experience || "Unknown"
    };
    
    // Create analytics object from the new structure
    const analytics = {
        averageScore: Math.round(responseData.candidates.reduce((sum, c) => sum + c.aiScore, 0) / responseData.candidates.length),
        highScoreCandidates: responseData.candidates.filter(c => c.aiScore >= 80).length,
        mediumScoreCandidates: responseData.candidates.filter(c => c.aiScore >= 60 && c.aiScore < 80).length,
        lowScoreCandidates: responseData.candidates.filter(c => c.aiScore < 60).length,
        searchQuality: "Good",
        recommendedAction: "Contact top candidates and review medium-priority options"
    };

    // Make candidate IDs unique by adding timestamp
    const searchTimestamp = Date.now();
    responseData.candidates = responseData.candidates.map((candidate, index) => ({
        ...candidate,
        id: `${candidate.id}_${searchTimestamp}`,
        originalId: candidate.id // Keep original for reference
    }));
    
    // Store candidates globally for modal access
    currentCandidates = responseData.candidates;
    
    // Update results description
    const resultsTitle = document.querySelector('#resultsState h3');
    const resultsDesc = document.querySelector('#resultsState p');
    
    if (resultsTitle && resultsDesc) {
        resultsTitle.textContent = 'Search Results';
        resultsDesc.textContent = `Found ${responseData.topCandidatesCount} candidates matching "${reconstructedQuery.jobTitle}" in ${reconstructedQuery.location}`;
    }
    
    // Update candidate cards with real data
    updateCandidateCards(responseData.candidates);
    
    // Update analytics
    if (analytics) updateAnalytics(analytics);

    // Update AI Insights with reconstructed query
    const aiInsights = generateAIInsights(responseData.candidates, reconstructedQuery);
    const formattedInsights = aiInsights.replace(/\*\*(.*?)\*\*/g, '<strong class="text-accent-cyan">$1</strong>');
    document.getElementById('aiInsightsText').innerHTML = formattedInsights;
    
    // Generate and populate stats grid
    const statsGrid = generateStatsGrid(responseData.candidates);
    document.getElementById('statsGrid').innerHTML = statsGrid;
    
    // Setup result filters
    setTimeout(() => {
        setupResultFilters();
    }, 100);
}

function showHistorySearchResult(searchData) {
    console.log('Showing history search result for:', searchData);

	// Use existing IDs from history - don't regenerate them
	const candidatesWithUniqueIds = (searchData.candidates || []).map((candidate, index) => ({
	    ...candidate,
	    // Keep the original ID structure from when it was first saved
	    id: candidate.id,
	    originalId: candidate.originalId || candidate.id
	}));
    
    // Update results description with correct search data
    const resultsTitle = document.querySelector('#resultsState h3');
    const resultsDesc = document.querySelector('#resultsState p');
    if (resultsTitle && resultsDesc) {
        resultsTitle.textContent = 'Search Results';
        resultsDesc.textContent = `Found ${searchData.resultCount} candidates matching "${searchData.jobTitle}" in ${searchData.location}`;
    }
	// Update candidate cards with saved data - preserve analytics if they exist
	const candidatesWithAnalytics = (searchData.candidates || []).map(candidate => ({
		...candidate,
		// Ensure analytics data is preserved from history
		careerAnalytics: candidate.careerAnalytics || null
	}));
    
    // Update candidate cards with saved data
	updateCandidateCards(candidatesWithUniqueIds);
    updateCandidateCards(searchData.candidates || []);
    
    // Update the global candidate state for filtering
	currentCandidates = candidatesWithUniqueIds;
    currentCandidates = searchData.candidates || [];
    attachCandidateCardHandlers(currentCandidates);
    
    // Update AI Insights for this search
	const aiInsights = generateAIInsights(searchData.candidates || [], searchData);
	const formattedInsights = aiInsights.replace(/\*\*(.*?)\*\*/g, '<strong class="text-accent-cyan">$1</strong>');
	document.getElementById('aiInsightsText').innerHTML = formattedInsights;
	
	// Generate and populate stats grid for history
	const statsGrid = generateStatsGrid(searchData.candidates || []);
	document.getElementById('statsGrid').innerHTML = statsGrid;
    
    // Setup result filters
    setTimeout(() => {
        setupResultFilters();
    }, 100);
}

function updateResultsDescription(params) {
    const resultsTitle = document.querySelector('#resultsState h3');
    const resultsDesc = document.querySelector('#resultsState p');
    if (resultsTitle && resultsDesc) {
        resultsDesc.textContent = `Found 8 candidates matching "${params.jobTitle}" in ${params.location || 'Indonesia'}`;
    }
}

// Update the candidate cards in the UI
function updateCandidateCards(candidates) {
	console.log('=== UPDATE CANDIDATE CARDS DEBUG ===');
    console.log('Total candidates to render:', candidates.length);

	// Debug: Check which candidates have analytics
    candidates.forEach((candidate, index) => {
        if (candidate.careerAnalytics) {
            console.log(`Candidate ${index} (${candidate.name}) HAS analytics`);
        } else {
            console.log(`Candidate ${index} (${candidate.name}) NO analytics`);
        }
    });
	
    const cardsContainer = document.getElementById('candidateCardsContainer');
    if (!cardsContainer) {
        console.error('Cards container not found');
        return;
    }
    
    // Clear old cards
    cardsContainer.innerHTML = '';
    
    // Render real cards
    candidates.forEach(candidate => {
        const cardHTML = createCandidateCardHTML(candidate);
        cardsContainer.innerHTML += cardHTML;
    });
    
    // Re-attach click handlers
    attachCandidateCardHandlers(candidates);

	// Update bookmark icons to show correct state
	updateBookmarkIcons();
}

// Generate priority badge based on AI score
// Generate enhanced priority badge based on AI score
function getPriorityBadge(score) {
    if (score >= 80) {
        return `<span class="px-3 py-1.5 bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xs rounded-full font-bold shadow-lg flex items-center space-x-1">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
            <span>High Priority</span>
        </span>`;
    } else if (score >= 60) {
        return `<span class="px-3 py-1.5 bg-gradient-to-r from-yellow-500 to-orange-500 text-white text-xs rounded-full font-bold shadow-lg flex items-center space-x-1">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
            </svg>
            <span>Medium Priority</span>
        </span>`;
    } else {
        return `<span class="px-3 py-1.5 bg-gradient-to-r from-gray-500 to-gray-600 text-white text-xs rounded-full font-bold shadow-lg flex items-center space-x-1">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
            </svg>
            <span>Low Priority</span>
        </span>`;
    }
}

// Generate verification badge with better styling
function getVerificationBadge(status) {
    if (status === 'Verified') {
        return `<span class="text-xs text-accent-cyan px-2 py-1 bg-accent-cyan/20 rounded-full flex items-center font-medium border border-accent-cyan/30">
            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.238.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            Verified
        </span>`;
    } else {
        return `<span class="text-xs text-gray-400 px-2 py-1 bg-gray-600/20 rounded-full border border-gray-600/30">
            ${status || 'Unverified'}
        </span>`;
    }
}

// Get color based on AI score
function getScoreColor(score) {
    if (score >= 80) return '#10b981'; // Green
    if (score >= 60) return '#f59e0b'; // Yellow/Orange  
    return '#6b7280'; // Gray
}

// Generate source badge with platform-specific styling
function getSourceBadge(source) {
    const sourceStyles = {
        'LinkedIn': {
            bg: 'bg-blue-600/20',
            text: 'text-blue-400',
            border: 'border-blue-600/40',
            icon: `<svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>`
        },
        'JobStreet': {
            bg: 'bg-green-600/20',
            text: 'text-green-400',
            border: 'border-green-600/40',
            icon: `<svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2L2 7V10C2 16 6 20.5 12 22C18 20.5 22 16 22 10V7L12 2Z"/>
            </svg>`
        },
        'Karir.com': {
            bg: 'bg-orange-600/20',
            text: 'text-orange-400',
            border: 'border-orange-600/40',
            icon: `<svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12S6.48 22 12 22 22 17.52 22 12 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z"/>
            </svg>`
        }
    };

    const style = sourceStyles[source] || {
        bg: 'bg-gray-600/20',
        text: 'text-gray-400',
        border: 'border-gray-600/40',
        icon: `<svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2L2 7V10C2 16 6 20.5 12 22C18 20.5 22 16 22 10V7L12 2Z"/>
        </svg>`
    };

    return `<span class="source-badge px-2 py-1 ${style.bg} ${style.text} border ${style.border} text-xs rounded-full font-medium flex items-center">
        ${style.icon}
        ${source}
    </span>`;
}

// Render 1 candidate card as HTML
function createCandidateCardHTML(candidate) {
	console.log(`=== RENDERING CARD FOR: ${candidate.name} ===`);
	    console.log('Has analytics:', !!candidate.careerAnalytics);
	    if (candidate.careerAnalytics) {
	        console.log('Analytics preview:', candidate.careerAnalytics.substring(0, 100) + '...');
	    }
    const scorePercentage = (candidate.aiScore * 3.6); // For speedometer UI
    
    // Extract hiring difficulty level for CSS class
    const difficultyLevel = candidate.hiringDifficulty?.toLowerCase().includes('easy') ? 'easy' :
                           candidate.hiringDifficulty?.toLowerCase().includes('hard') ? 'hard' : 'medium';
    
    // Get top 2-3 current skills for display
    const displaySkills = (candidate.currentSkills || []).slice(0, 3);

    const hasAnalytics = candidate.careerAnalytics && candidate.careerAnalytics !== null;
    
    // Determine priority based on AI score for consistent color coding
	const priority = candidate.aiScore >= 80 ? 'high' : 
	                candidate.aiScore >= 60 ? 'medium' : 'low';
    
    return `
        <div class="bg-dark-secondary rounded-xl p-6 cursor-pointer candidate-card" 
             data-candidate-id="${candidate.id}" 
             data-priority="${priority}">

			<!-- Bookmark Ribbon -->
	        <div class="bookmark-ribbon">
	            <button class="bookmark-icon ${isBookmarked(candidate.id) ? 'bookmarked' : 'not-bookmarked'}" 
	                    data-candidate-id="${candidate.id}"
	                    title="${isBookmarked(candidate.id) ? 'Remove from saved candidates' : 'Save candidate'}">
	                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
	                    <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/>
	                </svg>
	            </button>
	        </div>
 
            <div class="flex items-start justify-between">
                <div class="flex items-start space-x-4 flex-1">
                    <div class="pt-1">
                        <input type="checkbox" 
                            class="candidate-checkbox w-4 h-4 text-accent-cyan bg-dark-primary border-gray-600 rounded focus:ring-accent-cyan focus:ring-2" 
                            data-candidate-id="${candidate.id}">
                    </div>
                    <div class="w-14 h-14 bg-gradient-to-br from-gray-600 to-gray-700 rounded-xl flex items-center justify-center shadow-lg">
                        <span class="text-white font-bold text-lg">${candidate.name.split(' ').map(n => n[0]).join('').substring(0, 2)}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h4 class="text-xl font-bold text-white truncate">${candidate.name}</h4>
                                    ${getSourceBadge(candidate.source)}
                                    ${hasAnalytics ? '<span class="px-2 py-1 bg-purple-500/20 text-purple-400 border border-purple-500/30 text-xs rounded-full font-medium">Analytics</span>' : '<!-- No Analytics -->'}
                                </div>
                                
                                <p class="text-lg font-semibold text-gray-200 mb-1">${candidate.title}</p>
                                <p class="text-sm text-gray-400 mb-3">${candidate.location} • ${candidate.experience || 'Experienced professional'}</p>
                            </div>
                        </div>
                        
                        <!-- Skills Section -->
                        <div class="mb-4">
                            <div class="flex flex-wrap gap-2 mb-3">
                                ${displaySkills.map(skill => `<span class="px-3 py-1 bg-blue-500/20 text-blue-400 border border-blue-500/30 text-xs rounded-full font-medium">${skill}</span>`).join('')}
                            </div>
                        </div>
                        
                        <!-- Compensation & Difficulty Row -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                ${candidate.salaryRange ? `<span class="salary-badge px-3 py-1 text-white text-sm rounded-full font-medium">${candidate.salaryRange}</span>` : ''}
                                ${candidate.hiringDifficulty ? `<span class="difficulty-${difficultyLevel} px-3 py-1 text-sm rounded-full font-medium border">${candidate.hiringDifficulty.split(' - ')[0]}</span>` : ''}
                            </div>
                            
                            <!-- Priority Badge -->
                            ${getPriorityBadge(candidate.aiScore)}
                        </div>
                        
                        <!-- Description -->
                        <p class="text-gray-300 text-sm leading-relaxed mb-4">${candidate.snippet}</p>
                        
                        <!-- Footer Info -->
                        <div class="flex items-center justify-between pt-3 border-t border-gray-700/50">
                            <div class="flex items-center space-x-4">
                                <span class="text-xs text-gray-500">Profile Available</span>
                                <span class="text-xs text-gray-500">${candidate.lastUpdated}</span>
                                ${getVerificationBadge(candidate.verificationStatus)}
                            </div>
                            
                            <!-- Upgrade Analytics Button -->
                            ${!hasAnalytics ? `
                                <button class="upgrade-analytics-btn group relative px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white text-xs rounded-lg font-medium transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl" data-candidate-id="${candidate.id}">
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
										</svg>
                                        <span>Upgrade Analytics</span>
                                        <span class="text-xs opacity-80">(5 credits)</span>
                                    </div>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
                
                <!-- AI Score Circle -->
                <div class="flex flex-col items-center ml-4">
                    <div class="relative w-18 h-18 mb-2">
                        <div class="w-18 h-18 rounded-full enhanced-score-circle flex items-center justify-center" style="--score-deg: ${scorePercentage}deg; --score-color: ${getScoreColor(candidate.aiScore)}">
                            <div class="w-14 h-14 bg-dark-secondary rounded-full flex items-center justify-center shadow-inner">
                                <span class="font-bold text-lg" style="color: ${getScoreColor(candidate.aiScore)}">${candidate.aiScore}</span>
                            </div>
                        </div>
                    </div>
                    <span class="text-xs text-gray-400 font-medium">AI Score</span>
                </div>
            </div>
        </div>
    `;
}
// --- Candidate Modal Logic ---

// Attach click handlers to each candidate card (for details modal)
function attachCandidateCardHandlers(candidates) {
    document.querySelectorAll('.candidate-card').forEach((card, index) => {
        card.addEventListener('click', (e) => {
            // Don't open modal if we're upgrading a candidate
            if (window.upgradingCandidate) return;
            
            // Don't open modal if clicking bookmark elements or upgrade button
            if (e.target.closest('.bookmark-icon') || 
                e.target.closest('.bookmark-ribbon') ||
                e.target.closest('.upgrade-analytics-btn') ||
                e.target.closest('.candidate-checkbox')) {
                return;
            }
            
            const candidateId = card.getAttribute('data-candidate-id');
            const candidate = candidates.find(c => c.id === candidateId);
            if (candidate) {
                showCandidateModal(candidate);
            }
        });
    });
	
	// ADD THIS: Attach checkbox event listeners
    document.querySelectorAll('.candidate-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function(e) {
            e.stopPropagation();
			e.preventDefault();
            console.log('Checkbox clicked:', this.checked);
            updateCompareButton();
        });
		// Also prevent clicks from bubbling
	    checkbox.addEventListener('click', function(e) {
	        e.stopPropagation();
	    });
    });
}

// Show modal with candidate data
function showCandidateModal(candidate) {
    activeCandidate = candidate;
    if (!candidate) return;

    // Update modal sections
    updateModalHeader(candidate);
    updateModalAnalysis(candidate);
    updateModalProfile(candidate);
    updateModalStrengths(candidate);
	updateModalCurrentSkills(candidate);
	updateModalGrowthOpportunities(candidate);
    updateModalConcerns(candidate);
    updateModalRecommendation(candidate);
	updateModalCareerAnalytics(candidate);

    // Show modal
    candidateModal.classList.remove('hidden');
}

// Modal section updaters:
function updateModalHeader(candidate) {
    const nameElement = candidateModal.querySelector('h2');
    const titleElement = candidateModal.querySelector('p.text-gray-300');
    const locationElement = candidateModal.querySelector('p.text-gray-400');

    if (nameElement) nameElement.textContent = candidate.name;
    if (titleElement) titleElement.textContent = `${candidate.title} • ${candidate.experience || 'Experienced professional'}`;
    if (locationElement) {
        const contactStatus = candidate.verificationStatus === 'Verified' ? 'Verified Profile' : 'Profile Available';
        locationElement.textContent = `${candidate.location} • ${contactStatus}`;
    }

    // Update score circle
    const scoreElement = candidateModal.querySelector('.text-accent-cyan.font-bold.text-lg');
    const scoreCircle = candidateModal.querySelector('.score-circle');
    if (scoreElement) scoreElement.textContent = candidate.aiScore;
    if (scoreCircle) {
        const scoreDegrees = candidate.aiScore * 3.6;
        scoreCircle.style.setProperty('--score-deg', `${scoreDegrees}deg`);
    }

    // Update initials
    const initialsElement = candidateModal.querySelector('.w-16.h-16 span');
    if (initialsElement) {
        const initials = candidate.name.split(' ').map(n => n[0]).join('').substring(0, 2);
        initialsElement.textContent = initials;
    }
}

function updateModalAnalysis(candidate) {
    const summaryText = candidateModal.querySelector('.bg-dark-primary p.text-gray-300');
    if (summaryText) {
        summaryText.textContent = candidate.recommendation || 'AI analysis based on profile matching and experience relevance.';
    }

    // Update score breakdown bars
    const scoreBreakdown = candidate.scoreBreakdown || {};
    updateScoreBar('Role Relevance', scoreBreakdown.roleRelevance || 0);
    updateScoreBar('Experience Match', scoreBreakdown.experienceMatch || 0);
    updateScoreBar('Location Fit', scoreBreakdown.locationFit || 0);
    updateScoreBar('Profile Quality', scoreBreakdown.profileQuality || 0);
}

function updateScoreBar(label, score) {
    const scoreElements = candidateModal.querySelectorAll('.grid.grid-cols-2 > div');
    scoreElements.forEach(element => {
        const labelElement = element.querySelector('.text-gray-400');
        if (labelElement && labelElement.textContent === label) {
            const progressBar = element.querySelector('.bg-accent-cyan');
            const scoreText = element.querySelector('.text-accent-cyan');
            if (progressBar) progressBar.style.width = `${score}%`;
            if (scoreText) scoreText.textContent = `${score}%`;
        }
    });
}

function updateModalProfile(candidate) {
    const profileSection = candidateModal.querySelector('.grid.grid-cols-1.md\\:grid-cols-2 > div:first-child');
    if (!profileSection) return;

    const profileData = [
        ['Experience:', candidate.experience || 'Experienced professional'],
        ['Current Role:', candidate.title],
        ['Location:', candidate.location],
        ['Source:', candidate.source],
        ['Salary Range:', candidate.salaryRange || 'Not specified'],
        ['Hiring Difficulty:', candidate.hiringDifficulty || 'Not assessed'],
        ['Profile Updated:', candidate.lastUpdated]
    ];

    const profileContent = profileSection.querySelector('.space-y-3');
    if (profileContent) {
        profileContent.innerHTML = `
            ${profileData.map(([label, value]) => `
                <div class="flex justify-between">
                    <span class="text-gray-400">${label}</span>
                    <span class="text-white text-right">${value}</span>
                </div>
            `).join('')}
            ${candidate.companyContext ? `
                <div class="pt-3 border-t border-gray-600">
                    <span class="text-gray-400 block mb-2">Company Context:</span>
                    <span class="text-white text-sm leading-relaxed">${candidate.companyContext}</span>
                </div>
            ` : ''}
            <div class="flex justify-between items-center pt-2">
                <span class="text-gray-400">Verification:</span>
                <div class="flex items-center space-x-2">
                    ${candidate.verificationStatus === 'Verified' ? `
                        <div class="flex items-center space-x-1 bg-accent-cyan/20 text-accent-cyan px-2 py-1 rounded-full">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.238.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            <span class="text-sm font-medium">Verified</span>
                        </div>
                    ` : `
                        <span class="text-yellow-400 text-sm">${candidate.verificationStatus || 'Unverified'}</span>
                    `}
                </div>
            </div>
        `;
    }
}

function updateModalStrengths(candidate) {
    const strengthsSection = candidateModal.querySelector('.grid.grid-cols-1.md\\:grid-cols-2 > div:last-child .space-y-2');
    if (!strengthsSection) return;

    const strengths = candidate.strengths || ['Professional background', 'Industry experience'];
    strengthsSection.innerHTML = strengths.map(strength => `
        <div class="flex items-center space-x-2">
            <div class="w-2 h-2 bg-accent-cyan rounded-full"></div>
            <span class="text-gray-300 text-sm">${strength}</span>
        </div>
    `).join('');
}

function updateModalConcerns(candidate) {
    const concernsSection = candidateModal.querySelector('.bg-yellow-900\\/20 .space-y-2');
    if (!concernsSection) return;

    const concerns = candidate.concerns || ['Profile verification recommended before contact'];
    concernsSection.innerHTML = concerns.map(concern => `
        <div class="flex items-start space-x-2">
            <span class="text-yellow-400">•</span>
            <span>${concern}</span>
        </div>
    `).join('');
}

function updateModalRecommendation(candidate) {
    const recommendationSection = candidateModal.querySelector('.bg-accent-cyan\\/10 p.text-gray-300');
    if (!recommendationSection) return;

    const priority = candidate.priority || 'medium';
    const recommendation = candidate.recommendation || 'Review profile for potential match';

    recommendationSection.innerHTML = `
        <strong>${priority.charAt(0).toUpperCase() + priority.slice(1)} Priority Contact:</strong> ${recommendation}
    `;
}

// Update current skills section in modal
function updateModalCurrentSkills(candidate) {
    const skillsContainer = candidateModal.querySelector('#currentSkillsContainer');
    if (!skillsContainer) return;

    const currentSkills = candidate.currentSkills || [];
    skillsContainer.innerHTML = currentSkills.map(skill => `
        <span class="px-3 py-1 bg-blue-500/20 text-blue-400 border border-blue-500/30 text-sm rounded-full font-medium">
            ${skill}
        </span>
    `).join('');
}

// Update growth opportunities section in modal
function updateModalGrowthOpportunities(candidate) {
    const growthContainer = candidateModal.querySelector('#growthOpportunitiesContainer');
    if (!growthContainer) return;

    const growthOpportunities = candidate.growthOpportunities || [];
    growthContainer.innerHTML = growthOpportunities.map(opportunity => `
        <div class="flex items-center space-x-2">
            <div class="w-2 h-2 bg-accent-cyan rounded-full flex-shrink-0"></div>
            <span class="text-gray-300 text-sm">${opportunity}</span>
        </div>
    `).join('');
}

// Parse career analytics text into structured sections
function parseCareerAnalytics(rawText) {
    if (!rawText) return null;
    
    const sections = {
        executiveSummary: '',
        currentStrengths: '',
        growthPotential: '',
        careerTrajectory: '',
        riskAssessment: '',
        hiringRecommendation: ''
    };
    
    // Split by emoji headers
    const parts = rawText.split(/(?=🏆|📈|💰|🎯|🌐|🔍|📊|⚡)/);
    
    parts.forEach(part => {
        if (part.includes('🏆 Potential Rating')) {
            // Extract key metrics for executive summary
            const potentialMatch = part.match(/Potential Rating: (\d+\/100)/);
            const levelMatch = part.match(/Current Level: (\d+\/100)/);
            const speedMatch = part.match(/Development Speed: ([^)]+\))/);
            
            if (potentialMatch && levelMatch && speedMatch) {
                sections.executiveSummary = `${potentialMatch[1]} potential rating with ${levelMatch[1]} current performance level. ${speedMatch[1]} development timeline.`;
            }
        }
        
        if (part.includes('📈 Career Trajectory') || part.includes('💰 Compensation')) {
            sections.careerTrajectory += part;
        }
        
        if (part.includes('🎯 Strategic Development') || part.includes('⚡ Acceleration Strategies')) {
            sections.growthPotential += part;
        }
        
        if (part.includes('📊 Peer Benchmarking') || part.includes('🌐 Market Intelligence')) {
            sections.currentStrengths += part;
        }
        
        if (part.includes('🔍 Risk Assessment')) {
            sections.riskAssessment = part;
        }
    });
    
    // Clean up sections - remove emoji headers and format nicely
    Object.keys(sections).forEach(key => {
        if (sections[key]) {
            sections[key] = cleanAndFormatSection(sections[key]);
        }
    });
    
    // Generate hiring recommendation from key insights
    sections.hiringRecommendation = "Based on the analysis above, this candidate shows strong potential for strategic roles. Consider for positions requiring leadership development and analytical thinking.";
    
    return sections;
}

// Helper function to clean and format sections
function cleanAndFormatSection(text) {
    if (!text) return '';
    
    return text
        // Remove only the emoji header lines (lines that start with emoji and end with newline)
        .replace(/^🏆.*?\n/gm, '')
        .replace(/^📈.*?\n/gm, '')
        .replace(/^💰.*?\n/gm, '')
        .replace(/^🎯.*?\n/gm, '')
        .replace(/^🌐.*?\n/gm, '')
        .replace(/^🔍.*?\n/gm, '')
        .replace(/^📊.*?\n/gm, '')
        .replace(/^⚡.*?\n/gm, '')
        // Clean up extra whitespace but preserve content
        .replace(/\n\n\n+/g, '\n\n')
        .trim();
}

// Helper function to extract specific sub-sections
function formatSubSection(text, sectionType) {
    if (!text) return '';
    
    const paragraphs = text.split('\n\n');
    
    if (sectionType === 'Market Intelligence') {
        // Return first paragraph (Market Intelligence content)
        return paragraphs[0] ? paragraphs[0].replace(/\n/g, '<br>') : '';
    } else if (sectionType === 'Peer Benchmarking') {
        // Return second paragraph (Peer Benchmarking content)
        return paragraphs[1] ? paragraphs[1].replace(/\n/g, '<br>') : '';
    } else if (sectionType === 'Career Trajectory') {
        // Return first paragraph (Career Trajectory content)
        return paragraphs[0] ? paragraphs[0].replace(/\n/g, '<br>') : '';
    } else if (sectionType === 'Compensation') {
        // Return second paragraph (Compensation content)
        return paragraphs[1] ? paragraphs[1].replace(/\n/g, '<br>') : '';
    } else if (sectionType === 'Strategic Development') {
        // Return first paragraph (Strategic Development content)
        const lines = text.split('\n');
        const strategicLines = lines.slice(0, 3); // First 3 lines are Strategic Development
        return strategicLines.join('<br>');
    } else if (sectionType === 'Acceleration') {
        // Return the bullet points (Acceleration Strategies)
        const lines = text.split('\n');
        const accelerationLines = lines.filter(line => line.startsWith('- '));
        return accelerationLines.join('<br>');
    }
    
    return text.replace(/\n/g, '<br>');
}

// Update career analytics section in modal
function updateModalCareerAnalytics(candidate) {
    console.log('=== FUNCTION CALLED ===');
    const analyticsContainer = candidateModal.querySelector('#careerAnalyticsContent');
    
    console.log('=== DEBUGGING CAREER ANALYTICS ===');
    console.log('Full candidate object:', candidate);
    console.log('candidate.careerAnalytics:', candidate.careerAnalytics);
    
    if (analyticsContainer && candidate.careerAnalytics) {
        // Parse the analytics text
        let analyticsText = candidate.careerAnalytics;
        if (typeof analyticsText === 'object' && analyticsText.output) {
            const parsed = JSON.parse(analyticsText.output);
            analyticsText = parsed.careerAnalytics;
        }
        
        // Parse into structured sections
        const sections = parseCareerAnalytics(analyticsText);
        console.log('Parsed sections:', sections);
        console.log('Parsed sections details:', JSON.stringify(sections, null, 2));
        
        if (sections) {
            console.log('=== APPLYING NEW HTML ===');
            console.log('Current Strengths raw text:', sections.currentStrengths);
            
            analyticsContainer.innerHTML = `
        <!-- Executive Summary -->
        <div class="mb-5 p-5 bg-gradient-to-r from-purple-500/10 to-blue-500/10 border border-purple-500/30 rounded-lg">
            <div class="flex items-center space-x-3 mb-3">
                <div class="w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center">
                    <span class="text-lg">🏆</span>
                </div>
                <h4 class="text-lg font-bold text-purple-400">Executive Summary</h4>
            </div>
            <p class="text-gray-300 leading-relaxed text-base">${sections.executiveSummary}</p>
        </div>

        <!-- Current Strengths -->
        <div class="mb-5 p-5 bg-gradient-to-r from-green-500/10 to-emerald-500/10 border border-green-500/30 rounded-lg">
            <div class="flex items-center space-x-3 mb-4">
                <div class="w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center">
                    <span class="text-lg">💪</span>
                </div>
                <h4 class="text-lg font-bold text-green-400">Current Strengths</h4>
            </div>
            <div class="space-y-4">
                <div>
                    <h5 class="font-semibold text-green-300 mb-2">Market Intelligence & Positioning</h5>
                    <div class="pl-4 border-l-2 border-green-500/30 text-gray-300 leading-relaxed">${formatSubSection(sections.currentStrengths, 'Market Intelligence')}</div>
                </div>
                <div>
                    <h5 class="font-semibold text-green-300 mb-2">Peer Benchmarking</h5>
                    <div class="pl-4 border-l-2 border-green-500/30 text-gray-300 leading-relaxed">${formatSubSection(sections.currentStrengths, 'Peer Benchmarking')}</div>
                </div>
            </div>
        </div>

        <!-- Career Trajectory -->
        <div class="mb-5 p-5 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 border border-blue-500/30 rounded-lg">
            <div class="flex items-center space-x-3 mb-4">
                <div class="w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center">
                    <span class="text-lg">📈</span>
                </div>
                <h4 class="text-lg font-bold text-blue-400">Career Trajectory & Compensation</h4>
            </div>
            <div class="space-y-4">
                <div>
                    <h5 class="font-semibold text-blue-300 mb-2">Career Trajectory Forecast</h5>
                    <div class="pl-4 border-l-2 border-blue-500/30 text-gray-300 leading-relaxed">${formatSubSection(sections.careerTrajectory, 'Career Trajectory')}</div>
                </div>
                <div>
                    <h5 class="font-semibold text-blue-300 mb-2">Compensation Progression Analysis</h5>
                    <div class="pl-4 border-l-2 border-blue-500/30 text-gray-300 leading-relaxed">${formatSubSection(sections.careerTrajectory, 'Compensation')}</div>
                </div>
            </div>
        </div>

        <!-- Growth Potential -->
        <div class="mb-5 p-5 bg-gradient-to-r from-yellow-500/10 to-orange-500/10 border border-yellow-500/30 rounded-lg">
            <div class="flex items-center space-x-3 mb-4">
                <div class="w-8 h-8 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                    <span class="text-lg">🎯</span>
                </div>
                <h4 class="text-lg font-bold text-yellow-400">Growth Potential & Development</h4>
            </div>
            <div class="space-y-4">
                <div>
                    <h5 class="font-semibold text-yellow-300 mb-2">Strategic Development Roadmap</h5>
                    <div class="pl-4 border-l-2 border-yellow-500/30 text-gray-300 leading-relaxed">${formatSubSection(sections.growthPotential, 'Strategic Development')}</div>
                </div>
                <div>
                    <h5 class="font-semibold text-yellow-300 mb-2">Acceleration Strategies</h5>
                    <div class="pl-4 border-l-2 border-yellow-500/30 text-gray-300 leading-relaxed">${formatSubSection(sections.growthPotential, 'Acceleration')}</div>
                </div>
            </div>
        </div>

        <!-- Risk Assessment -->
        <div class="mb-5 p-5 bg-gradient-to-r from-red-500/10 to-pink-500/10 border border-red-500/30 rounded-lg">
            <div class="flex items-center space-x-3 mb-3">
                <div class="w-8 h-8 bg-red-500/20 rounded-lg flex items-center justify-center">
                    <span class="text-lg">🔍</span>
                </div>
                <h4 class="text-lg font-bold text-red-400">Risk Assessment</h4>
            </div>
            <div class="text-gray-300 leading-relaxed">${sections.riskAssessment}</div>
        </div>

        <!-- Hiring Recommendation -->
        <div class="p-5 bg-gradient-to-r from-accent-cyan/10 to-accent-teal/10 border border-accent-cyan/30 rounded-lg">
            <div class="flex items-center space-x-3 mb-3">
                <div class="w-8 h-8 bg-accent-cyan/20 rounded-lg flex items-center justify-center">
                    <span class="text-lg">💡</span>
                </div>
                <h4 class="text-lg font-bold text-accent-cyan">Hiring Recommendation</h4>
            </div>
            <p class="text-gray-300 leading-relaxed text-base">${sections.hiringRecommendation}</p>
        </div>
    `;
            console.log('=== HTML APPLIED ===');
            console.log('Container after update:', analyticsContainer.innerHTML.substring(0, 200));
        } else {
            console.log('=== USING FALLBACK ===');
            // Fallback to original display
            analyticsContainer.textContent = analyticsText;
        }
    } else if (analyticsContainer) {
        // Clear analytics section if no analytics available
        analyticsContainer.innerHTML = '<p class="text-gray-400">No career analytics available for this candidate.</p>';
    }
}

// --- Result Filters and Sorting ---
function setupResultFilters() {
    console.log('setupResultFilters called');
    setupEnhancedFilters();

	// Initialize active filters display
    updateActiveFiltersState();
    updateActiveFiltersDisplay();
    
    // Sort dropdown
    const sortSelectElement = document.getElementById('sortSelect');
    if (sortSelectElement) {
        sortSelectElement.addEventListener('change', sortCandidates);
        console.log('Sort listener attached');
    }
}

// Filter candidates based on criteria
function filterCandidates() {
    const filterInput = document.querySelector('#resultsState input[placeholder*="Filter by name"]');
    const scoreRange = document.querySelector('#resultsState input[type="range"]');
    const minScore = parseInt(scoreRange?.value || 0);
    const searchTerm = filterInput?.value.toLowerCase() || '';

    const candidateCards = document.querySelectorAll('.candidate-card');
    let visibleCount = 0;

    candidateCards.forEach(card => {
        const candidateId = card.getAttribute('data-candidate-id');
        const candidate = currentCandidates.find(c => c.id === candidateId);

        if (!candidate) {
            card.style.display = 'none';
            return;
        }

        // Check score
        const meetsScore = candidate.aiScore >= minScore;

        // Check text search
        const searchableText = `${candidate.name} ${candidate.title} ${candidate.location} ${candidate.strengths?.join(' ')}`.toLowerCase();
        const meetsSearch = searchTerm === '' || searchableText.includes(searchTerm);

        if (meetsScore && meetsSearch) {
            card.style.display = 'block';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });

    // Update results count
    updateResultsCount(visibleCount);
}

// Enhanced filtering functionality
function setupEnhancedFilters() {
    // Experience filter
    const experienceFilter = document.getElementById('experienceFilter');
    const experienceValue = document.getElementById('experienceValue');
    if (experienceFilter && experienceValue) {
       		experienceFilter.addEventListener('input', (e) => {
		    experienceValue.textContent = e.target.value + '+';
		    filterCandidatesEnhanced();
		});
    }
    
    // Score filter  
    const scoreFilter = document.getElementById('scoreFilter');
    const scoreValue = document.getElementById('scoreValue');
    if (scoreFilter && scoreValue) {
        	scoreFilter.addEventListener('input', (e) => {
		    scoreValue.textContent = e.target.value;
		    filterCandidatesEnhanced();
		});
    }
    
    // Text filter
    const nameFilter = document.getElementById('nameFilter');
    if (nameFilter) {
        nameFilter.addEventListener('input', filterCandidatesEnhanced);
    }
    
    // Verification filter
    const verifiedFilter = document.getElementById('verifiedFilter');
    if (verifiedFilter) {
        verifiedFilter.addEventListener('change', filterCandidatesEnhanced);
    }
    
    // Location dropdown
    const locationBtn = document.getElementById('locationFilterBtn');
    const locationDropdown = document.getElementById('locationDropdown');
    if (locationBtn && locationDropdown) {
        locationBtn.addEventListener('click', () => {
            locationDropdown.classList.toggle('hidden');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!locationBtn.contains(e.target) && !locationDropdown.contains(e.target)) {
                locationDropdown.classList.add('hidden');
            }
        });
        
        // Location checkboxes
        document.querySelectorAll('.location-checkbox').forEach(checkbox => {
			checkbox.addEventListener('change', () => {
				updateLocationButtonText();
				filterCandidatesEnhanced(); // This will now update display automatically
			});
		});
    }
    
    // Clear filters
	const clearFilters = document.getElementById('clearFilters');
	if (clearFilters) {
	    clearFilters.addEventListener('click', () => {
	        console.log('Clear filters clicked');
	        console.log('Total candidates before clear:', currentCandidates.length);
	        
	        document.getElementById('nameFilter').value = '';
	        document.getElementById('experienceFilter').value = '0';
	        document.getElementById('scoreFilter').value = '0';
	        document.getElementById('verifiedFilter').checked = false;
	        document.querySelectorAll('.location-checkbox').forEach(cb => cb.checked = true);
	        experienceValue.textContent = '0+';
	        scoreValue.textContent = '0';
	        updateLocationButtonText();
	        
	        console.log('About to call filterCandidatesEnhanced');
	        filterCandidatesEnhanced();
	    });
	}
}

function filterCandidatesEnhanced() {
    console.log('filterCandidatesEnhanced called');

	// Update active filters state
    updateActiveFiltersState();
    updateActiveFiltersDisplay();
	
    const nameFilter = document.getElementById('nameFilter')?.value.toLowerCase() || '';
    const minExperience = parseInt(document.getElementById('experienceFilter')?.value || 0);
    const minScore = parseInt(document.getElementById('scoreFilter')?.value || 0);
    const verifiedOnly = document.getElementById('verifiedFilter')?.checked || false;
    
    console.log('Filter values:', { nameFilter, minExperience, minScore, verifiedOnly });
    
    const selectedLocations = Array.from(document.querySelectorAll('.location-checkbox:checked'))
        .map(cb => cb.value.toLowerCase());
    
    console.log('Selected locations:', selectedLocations);
    
    const candidateCards = document.querySelectorAll('.candidate-card');
    let visibleCount = 0;
    
    candidateCards.forEach(card => {
        const candidateId = card.getAttribute('data-candidate-id');
        const candidate = currentCandidates.find(c => c.id === candidateId);
        
        if (!candidate) {
            console.log('Candidate not found for card:', candidateId);
            card.style.display = 'none';
            return;
        }
        
        // Test each filter condition
        const searchableText = `${candidate.name} ${candidate.title} ${candidate.location}`.toLowerCase();
        const passesTextFilter = nameFilter === '' || searchableText.includes(nameFilter);
        
        const experienceYears = parseInt(candidate.experience?.match(/\d+/)?.[0] || '0');
        const passesExperienceFilter = experienceYears >= minExperience;
        
        const passesScoreFilter = candidate.aiScore >= minScore;
        
        const passesVerificationFilter = !verifiedOnly || candidate.verificationStatus === 'Verified';
        
        // Location filter
		const candidateLocation = candidate.location.toLowerCase();
		const specificCities = ['jakarta', 'surabaya', 'bandung', 'medan', 'semarang', 'makassar', 'palembang', 'tangerang', 'depok', 'bekasi'];
		const candidateHasSpecificCity = specificCities.some(city => candidateLocation.includes(city));
		
		let passesLocationFilter;
		if (candidateHasSpecificCity) {
		    // If candidate has a specific city, check if that city is selected
		    passesLocationFilter = selectedLocations.some(loc => candidateLocation.includes(loc));
		} else {
		    // If candidate has no specific city (like "Indonesia"), check if "other" is selected
		    passesLocationFilter = selectedLocations.includes('other');
		}
		
		// If no locations are selected, show all
		if (selectedLocations.length === 0) {
		    passesLocationFilter = true;
		}
        
        const allTestsPass = passesTextFilter && passesExperienceFilter && passesScoreFilter && 
		    passesVerificationFilter && passesLocationFilter;
		
		if (allTestsPass) {
            card.style.display = 'block';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });
    
    console.log('Visible count after filtering:', visibleCount);
    updateResultsCount(visibleCount);
}

// Track active filters state
let activeFilters = {
    nameFilter: '',
    scoreFilter: 0,
    experienceFilter: 0,
    verifiedFilter: false,
    locationFilters: []
};

// Update active filters display
function updateActiveFiltersDisplay() {
    const container = document.getElementById('activeFiltersContainer');
    const chipsContainer = document.getElementById('activeFiltersChips');
    const chips = [];
    
    // Name filter chip
    if (activeFilters.nameFilter) {
        chips.push({
            type: 'name',
            label: `Search: "${activeFilters.nameFilter}"`,
            value: activeFilters.nameFilter
        });
    }
    
    // Score filter chip
    if (activeFilters.scoreFilter > 0) {
        chips.push({
            type: 'score',
            label: `Score: ${activeFilters.scoreFilter}+`,
            value: activeFilters.scoreFilter
        });
    }
    
    // Experience filter chip
    if (activeFilters.experienceFilter > 0) {
        chips.push({
            type: 'experience',
            label: `Experience: ${activeFilters.experienceFilter}+ years`,
            value: activeFilters.experienceFilter
        });
    }
    
    // Verified filter chip
    if (activeFilters.verifiedFilter) {
        chips.push({
            type: 'verified',
            label: 'Verified Only',
            value: true
        });
    }
    
    // Location filters chip
    const allLocationCheckboxes = document.querySelectorAll('.location-checkbox');
    const checkedLocationCheckboxes = document.querySelectorAll('.location-checkbox:checked');
    if (checkedLocationCheckboxes.length > 0 && checkedLocationCheckboxes.length < allLocationCheckboxes.length) {
        const selectedLocations = Array.from(checkedLocationCheckboxes).map(cb => 
            cb.nextElementSibling.textContent
        );
        if (selectedLocations.length === 1) {
            chips.push({
                type: 'location',
                label: `Location: ${selectedLocations[0]}`,
                value: selectedLocations
            });
        } else {
            chips.push({
                type: 'location',
                label: `Locations: ${selectedLocations.length} selected`,
                value: selectedLocations
            });
        }
    }
    
    // Show/hide container based on active filters
    if (chips.length > 0) {
        container.classList.remove('hidden');
        chipsContainer.innerHTML = chips.map(chip => `
            <button class="filter-chip px-3 py-1.5 rounded-full text-xs font-medium flex items-center space-x-1 hover:shadow-lg transition-all" 
                    data-filter-type="${chip.type}">
                <span>${chip.label}</span>
                <svg class="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        `).join('');
        
        // Attach click handlers to remove individual chips
        chipsContainer.querySelectorAll('.filter-chip').forEach(chip => {
            chip.addEventListener('click', (e) => {
                e.preventDefault();
                removeFilter(chip.dataset.filterType);
            });
        });
    } else {
        container.classList.add('hidden');
    }
    
    // Update filter button states
    updateFilterButtonStates();
}

// Remove individual filter
function removeFilter(filterType) {
    switch (filterType) {
        case 'name':
            document.getElementById('nameFilter').value = '';
            activeFilters.nameFilter = '';
            break;
        case 'score':
            document.getElementById('scoreFilter').value = '0';
            document.getElementById('scoreValue').textContent = '0';
            activeFilters.scoreFilter = 0;
            break;
        case 'experience':
            document.getElementById('experienceFilter').value = '0';
            document.getElementById('experienceValue').textContent = '0+';
            activeFilters.experienceFilter = 0;
            break;
        case 'verified':
            document.getElementById('verifiedFilter').checked = false;
            activeFilters.verifiedFilter = false;
            break;
        case 'location':
            document.querySelectorAll('.location-checkbox').forEach(cb => cb.checked = true);
            updateLocationButtonText();
            break;
    }
    
    // Update display and re-filter
    updateActiveFiltersState();
    updateActiveFiltersDisplay();
    filterCandidatesEnhanced();
}

// Clear all filters
function clearAllFilters() {
    document.getElementById('nameFilter').value = '';
    document.getElementById('scoreFilter').value = '0';
    document.getElementById('experienceFilter').value = '0';
    document.getElementById('verifiedFilter').checked = false;
    document.querySelectorAll('.location-checkbox').forEach(cb => cb.checked = true);
    
    // Reset UI elements
    document.getElementById('scoreValue').textContent = '0';
    document.getElementById('experienceValue').textContent = '0+';
    updateLocationButtonText();
    
    // Reset active filters state
    activeFilters = {
        nameFilter: '',
        scoreFilter: 0,
        experienceFilter: 0,
        verifiedFilter: false,
        locationFilters: []
    };
    
    updateActiveFiltersDisplay();
    filterCandidatesEnhanced();
}

// Update active filters state from form inputs
function updateActiveFiltersState() {
    activeFilters.nameFilter = document.getElementById('nameFilter')?.value || '';
    activeFilters.scoreFilter = parseInt(document.getElementById('scoreFilter')?.value || 0);
    activeFilters.experienceFilter = parseInt(document.getElementById('experienceFilter')?.value || 0);
    activeFilters.verifiedFilter = document.getElementById('verifiedFilter')?.checked || false;
    
    const selectedLocations = Array.from(document.querySelectorAll('.location-checkbox:checked'))
        .map(cb => cb.value);
    activeFilters.locationFilters = selectedLocations;
}

// Update visual states of filter buttons
function updateFilterButtonStates() {
    // Score filter button
    const scoreFilter = document.getElementById('scoreFilter');
    const scoreContainer = scoreFilter?.closest('.flex.items-center');
    if (scoreContainer) {
        if (activeFilters.scoreFilter > 0) {
            scoreContainer.classList.add('filter-active');
        } else {
            scoreContainer.classList.remove('filter-active');
        }
    }
    
    // Experience filter button  
    const expFilter = document.getElementById('experienceFilter');
    const expContainer = expFilter?.closest('.flex.items-center');
    if (expContainer) {
        if (activeFilters.experienceFilter > 0) {
            expContainer.classList.add('filter-active');
        } else {
            expContainer.classList.remove('filter-active');
        }
    }
    
    // Verified filter
    const verifiedFilter = document.getElementById('verifiedFilter');
    const verifiedContainer = verifiedFilter?.closest('.flex.items-center');
    if (verifiedContainer) {
        if (activeFilters.verifiedFilter) {
            verifiedContainer.classList.add('filter-active');
        } else {
            verifiedContainer.classList.remove('filter-active');
        }
    }
    
    // Location filter button
    const locationBtn = document.getElementById('locationFilterBtn');
    const allLocationCheckboxes = document.querySelectorAll('.location-checkbox');
    const checkedLocationCheckboxes = document.querySelectorAll('.location-checkbox:checked');
    if (locationBtn) {
        if (checkedLocationCheckboxes.length > 0 && checkedLocationCheckboxes.length < allLocationCheckboxes.length) {
            locationBtn.classList.add('filter-active');
        } else {
            locationBtn.classList.remove('filter-active');
        }
    }
}

// Update location button text
function updateLocationButtonText() {
    const selectedLocations = Array.from(document.querySelectorAll('.location-checkbox:checked'));
    const locationBtn = document.getElementById('locationFilterBtn');
    const btnText = locationBtn.querySelector('span');
    
    if (selectedLocations.length === 0) {
        btnText.textContent = 'No Locations';
    } else if (selectedLocations.length === document.querySelectorAll('.location-checkbox').length) {
        btnText.textContent = 'All Locations';
    } else if (selectedLocations.length === 1) {
        btnText.textContent = selectedLocations[0].nextElementSibling.textContent;
    } else {
        btnText.textContent = `${selectedLocations.length} Locations`;
    }
}

// Sort candidates
function sortCandidates() {
    console.log('sortCandidates called', currentCandidates.length);
    const sortSelectElement = document.getElementById('sortSelect');
    const sortBy = sortSelectElement?.value || 'Sort by Score';
    console.log('Sort by:', sortBy);
    const container = document.querySelector('#candidateCardsContainer');
    console.log('Container found:', !!container);

    if (!container) return;

    const cards = Array.from(container.querySelectorAll('.candidate-card'));
    console.log('Cards found for sorting:', cards.length); // ADD THIS

    cards.sort((a, b) => {
        const idA = a.getAttribute('data-candidate-id');
        const idB = b.getAttribute('data-candidate-id');
        const candidateA = currentCandidates.find(c => c.id === idA);
        const candidateB = currentCandidates.find(c => c.id === idB);

        console.log('Comparing:', candidateA?.name, 'vs', candidateB?.name); // ADD THIS

        if (!candidateA || !candidateB) return 0;

        switch (sortBy) {
            case 'Sort by Score':
                console.log('Sorting by score:', candidateB.aiScore, 'vs', candidateA.aiScore); // ADD THIS
                return candidateB.aiScore - candidateA.aiScore;
            case 'Sort by Experience':
                const yearsA = parseInt(candidateA.experience?.match(/\d+/)?.[0] || '0');
                const yearsB = parseInt(candidateB.experience?.match(/\d+/)?.[0] || '0');
                console.log('Sorting by experience:', yearsB, 'vs', yearsA); // ADD THIS
                return yearsB - yearsA;
            case 'Sort by Location':
                console.log('Sorting by location:', candidateA.location, 'vs', candidateB.location); // ADD THIS
                return candidateA.location.localeCompare(candidateB.location);
            default:
                return 0;
        }
    });

    console.log('About to reorder DOM elements'); // ADD THIS
    // Reorder DOM
    cards.forEach(card => container.appendChild(card));
    console.log('DOM reordering complete'); // ADD THIS
}

// Update visible results count
function updateResultsCount(visibleCount) {
    const resultsDesc = document.querySelector('#resultsState p');
    if (resultsDesc && currentCandidates.length > 0) {
        const totalCount = currentCandidates.length;
        if (visibleCount < totalCount) {
            resultsDesc.textContent = `Showing ${visibleCount} of ${totalCount} candidates`;
        } else {
            resultsDesc.textContent = `Found ${totalCount} candidates matching your search`;
        }
    }
}

// --- Candidate Comparison Logic ---

// Update the compare button based on selected candidates
function updateCompareButton() {
    const selectedCheckboxes = document.querySelectorAll('.candidate-checkbox:checked');
    const compareBtn = document.getElementById('compareBtn');
    const bulkAnalyticsBtn = document.getElementById('bulkAnalyticsBtn');
    const selectionCount = document.getElementById('selectionCount');
    const bulkAnalyticsBtnText = document.getElementById('bulkAnalyticsBtnText');
    const selectedCount = selectedCheckboxes.length;
	const clearAllBtn = document.getElementById('clearAllBtn');

	if (selectedCount > 0) {
	    clearAllBtn.classList.remove('hidden');
	} else {
	    clearAllBtn.classList.add('hidden');
	}
    
    // Update selection count display
    selectionCount.textContent = `${selectedCount} candidate${selectedCount !== 1 ? 's' : ''} selected`;

    // Show/hide buttons based on selection
    if (selectedCount >= 2) {
        // Show bulk analytics button only for 2+ candidates
        bulkAnalyticsBtn.classList.remove('hidden');
        
        // Count how many selected candidates don't have analytics
        const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.dataset.candidateId);
        const candidatesWithoutAnalytics = selectedIds.filter(id => {
            const candidate = currentCandidates.find(c => c.id === id);
            return candidate && (!candidate.careerAnalytics || candidate.careerAnalytics === null);
        });
        
        const analyticsCount = candidatesWithoutAnalytics.length;
        const totalCredits = analyticsCount * 3; // Bulk pricing: 3 credits each
        
        if (analyticsCount > 0) {
            bulkAnalyticsBtnText.textContent = `Analyze ${analyticsCount} (${totalCredits} credits)`;
            bulkAnalyticsBtn.disabled = false;
            bulkAnalyticsBtn.classList.remove('opacity-50');
        } else {
            bulkAnalyticsBtnText.textContent = 'All have analytics';
            bulkAnalyticsBtn.disabled = true;
            bulkAnalyticsBtn.classList.add('opacity-50');
        }

        // Show compare button
        compareBtn.classList.remove('hidden');
        document.getElementById('compareBtnText').textContent = `Compare (${selectedCount})`;

        // Limit to max 3 selections for comparison
        if (selectedCount >= 3) {
            document.querySelectorAll('.candidate-checkbox:not(:checked)').forEach(cb => {
                cb.disabled = true;
                cb.parentElement.style.opacity = '0.5';
            });
        } else {
            document.querySelectorAll('.candidate-checkbox').forEach(cb => {
                cb.disabled = false;
                cb.parentElement.style.opacity = '1';
            });
        }
    } else {
        // Hide buttons when less than 2 selected
        bulkAnalyticsBtn.classList.add('hidden');
        compareBtn.classList.add('hidden');
        
        // Re-enable all checkboxes when not at limit
        document.querySelectorAll('.candidate-checkbox').forEach(cb => {
            cb.disabled = false;
            cb.parentElement.style.opacity = '1';
        });
    }
}
	
// Get selected candidates for comparison
function getSelectedCandidates() {
    const selectedCheckboxes = document.querySelectorAll('.candidate-checkbox:checked');
    const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.dataset.candidateId);
    return currentCandidates.filter(candidate => selectedIds.includes(candidate.id));
}

// Generate radar chart for candidate comparison
function generateRadarChart(candidates) {
    const ctx = document.getElementById('radarChart').getContext('2d');
    
    // Destroy existing chart if it exists
    if (window.comparisonChart) {
        window.comparisonChart.destroy();
    }
    
    const labels = [
        'Role Relevance',
        'Experience Match', 
        'Location Fit',
        'Profile Quality',
        'Overall Score',
        'Market Potential'
    ];
    
    const datasets = candidates.map((candidate, index) => {
        const scores = candidate.scoreBreakdown || {};
        return {
            label: candidate.name,
            data: [
                scores.roleRelevance || 0,
                scores.experienceMatch || 0,
                scores.locationFit || 0,
                scores.profileQuality || 0,
                candidate.aiScore || 0,
                calculateMarketPotential(candidate)
            ],
            borderColor: getChartColor(index),
            backgroundColor: getChartColor(index, 0.2),
            pointBackgroundColor: getChartColor(index),
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 6,
            borderWidth: 3,
            fill: true
        };
    });
    
    window.comparisonChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: labels,
            datasets: datasets
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: false // We'll use custom legend
                }
            },
            scales: {
                r: {
                    angleLines: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    pointLabels: {
                        color: '#9ca3af',
                        font: {
                            size: 12,
                            weight: 'bold'
                        }
                    },
                    ticks: {
                        color: '#6b7280',
                        backdropColor: 'transparent',
                        min: 0,
                        max: 100,
                        stepSize: 20
                    }
                }
            },
            elements: {
                line: {
                    tension: 0.1
                }
            }
        }
    });
}

// Get chart colors for different candidates (no red = bad association)
function getChartColor(index, alpha = 1) {
    const colors = [
        `rgba(0, 212, 170, ${alpha})`,   // Accent cyan (teal)
        `rgba(99, 102, 241, ${alpha})`,  // Indigo (purple-blue)
        `rgba(245, 158, 11, ${alpha})`,  // Orange (warm)
        `rgba(16, 185, 129, ${alpha})`,  // Green (emerald)
        `rgba(168, 85, 247, ${alpha})`   // Purple (violet)
    ];
    return colors[index] || colors[0];
}

// Calculate market potential score
function calculateMarketPotential(candidate) {
    let potential = 50; // Base score
    
    // Boost for verification
    if (candidate.verificationStatus === 'Verified') potential += 15;
    
    // Boost for experience level
    const expMatch = candidate.experience?.match(/(\d+)/);
    const years = expMatch ? parseInt(expMatch[0]) : 0;
    if (years >= 5) potential += 20;
    else if (years >= 2) potential += 10;
    
    // Boost for skills
    if (candidate.currentSkills && candidate.currentSkills.length >= 3) potential += 15;
    
    return Math.min(potential, 100);
}

// Generate individual comparison card
function generateComparisonCard(candidate, index) {
    const scoreColor = getChartColor(index);
    return `
        <div class="bg-dark-secondary rounded-lg p-6 border-2" style="border-color: ${scoreColor}">
            <!-- Header -->
            <div class="text-center mb-4">
                <div class="w-16 h-16 bg-gray-600 rounded-full flex items-center justify-center mx-auto mb-3">
                    <span class="text-white font-bold text-lg">${candidate.name.split(' ').map(n => n[0]).join('').substring(0, 2)}</span>
                </div>
                <h3 class="text-lg font-semibold text-white">${candidate.name}</h3>
                <p class="text-gray-300 text-sm">${candidate.title}</p>
                <div class="mt-2">
                    <div class="w-12 h-12 rounded-full score-circle flex items-center justify-center mx-auto" style="--score-deg: ${candidate.aiScore * 3.6}deg; --score-color: ${scoreColor}">
                        <div class="w-8 h-8 bg-dark-primary rounded-full flex items-center justify-center">
                            <span class="font-bold text-sm" style="color: ${scoreColor}">${candidate.aiScore}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span class="text-gray-400">Experience:</span>
                    <span class="text-white text-right">${candidate.experience || 'N/A'}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-400">Location:</span>
                    <span class="text-white text-right">${candidate.location}</span>
                </div>
                <div class="flex justify-between items-center">
		    <span class="text-gray-400">Source:</span>
		    <div class="px-2 py-1 bg-blue-500/20 border border-blue-500/30 rounded-full">
		        <span class="text-blue-400 text-xs font-medium">${candidate.source}</span>
		    </div>
		</div>
		<div class="flex justify-between items-center">
		    <span class="text-gray-400">Verified:</span>
		    <div class="px-2 py-1 bg-${candidate.verificationStatus === 'Verified' ? 'green' : 'yellow'}-500/20 border border-${candidate.verificationStatus === 'Verified' ? 'green' : 'yellow'}-500/30 rounded-full">
		        <span class="text-${candidate.verificationStatus === 'Verified' ? 'green' : 'yellow'}-400 text-xs font-medium">${candidate.verificationStatus === 'Verified' ? '✓ Verified' : '⚠ Unverified'}</span>
		    </div>
		</div>
            </div>
            
            <!-- Top Skills -->
            <div class="mt-4">
			    <h4 class="text-sm font-semibold text-gray-300 mb-2">Top Skills</h4>
			    <div class="flex flex-wrap gap-2">
			        ${(candidate.currentSkills || []).slice(0, 3).map((skill, index) => {
			            const colors = [
			                'bg-accent-cyan/20 border-accent-cyan/30 text-accent-cyan',
			                'bg-green-500/20 border-green-500/30 text-green-400',
			                'bg-purple-500/20 border-purple-500/30 text-purple-400'
			            ];
			            const colorClass = colors[index % colors.length];
			            return `
			                <span class="px-3 py-1 ${colorClass} border rounded-full text-xs font-medium">
			                    ${skill}
			                </span>
			            `;
			        }).join('')}
			    </div>
			</div>
        </div>
    `;
}

// Generate detailed score comparison rows
function generateScoreComparisonRows(candidates) {
    const metrics = [
        { key: 'aiScore', label: 'Overall AI Score', format: 'score' },
        { key: 'roleRelevance', label: 'Role Relevance', format: 'percentage', path: 'scoreBreakdown' },
        { key: 'experienceMatch', label: 'Experience Match', format: 'percentage', path: 'scoreBreakdown' },
        { key: 'locationFit', label: 'Location Fit', format: 'percentage', path: 'scoreBreakdown' },
        { key: 'profileQuality', label: 'Profile Quality', format: 'percentage', path: 'scoreBreakdown' },
        { key: 'marketPotential', label: 'Market Potential', format: 'percentage', calculate: true },
        { key: 'experience', label: 'Years Experience', format: 'years' },
        { key: 'verificationStatus', label: 'Profile Verified', format: 'boolean' },
        { key: 'skillCount', label: 'Listed Skills', format: 'count', calculate: true }
    ];

    return metrics.map(metric => {
        return `
            <tr class="border-b border-gray-700/50">
                <td class="py-3 text-gray-300 font-medium">${metric.label}</td>
                ${candidates.map((candidate, index) => {
                    let value = '';
                    let cellClass = 'text-center py-3';
                    let displayValue = '';

                    // Get the value based on metric configuration
                    if (metric.calculate) {
                        if (metric.key === 'marketPotential') {
                            value = calculateMarketPotential(candidate);
                        } else if (metric.key === 'skillCount') {
                            value = (candidate.currentSkills || []).length;
                        }
                    } else if (metric.path) {
                        value = candidate[metric.path] ? candidate[metric.path][metric.key] : 0;
                    } else {
                        value = candidate[metric.key];
                    }

                    // Format the display value
                    switch (metric.format) {
                        case 'score':
                        case 'percentage':
                            displayValue = `${value || 0}${metric.format === 'percentage' ? '%' : ''}`;
                            // Color coding for scores
                            if (value >= 80) cellClass += ' text-green-400 font-bold';
							else if (value >= 60) cellClass += ' text-yellow-400 font-semibold';
							else cellClass += ' text-gray-400'; 
                            break;
                        case 'years':
                            const expMatch = value?.match(/(\d+)/);
                            const years = expMatch ? parseInt(expMatch[0]) : 0;
                            displayValue = `${years}y`;
                            if (years >= 5) cellClass += ' text-green-400 font-bold';
                            else if (years >= 2) cellClass += ' text-yellow-400';
                            else cellClass += ' text-gray-400';
                            break;
                        case 'boolean':
                            displayValue = value === 'Verified' ? '✓' : '✗';
                            cellClass += value === 'Verified' ? ' text-green-400 font-bold' : ' text-red-400';
                            break;
                        case 'count':
                            displayValue = value || 0;
                            if (value >= 3) cellClass += ' text-green-400 font-bold';
                            else if (value >= 1) cellClass += ' text-yellow-400';
                            else cellClass += ' text-gray-400';
                            break;
                        default:
                            displayValue = value || 'N/A';
                            cellClass += ' text-gray-300';
                    }

                    // Find the best performer for this metric (for highlighting)
                    const allValues = candidates.map(c => {
                        if (metric.calculate) {
                            if (metric.key === 'marketPotential') return calculateMarketPotential(c);
                            if (metric.key === 'skillCount') return (c.currentSkills || []).length;
                        } else if (metric.path) {
                            return c[metric.path] ? c[metric.path][metric.key] : 0;
                        } else if (metric.format === 'years') {
                            const match = c[metric.key]?.match(/(\d+)/);
                            return match ? parseInt(match[0]) : 0;
                        } else if (metric.format === 'boolean') {
                            return c[metric.key] === 'Verified' ? 1 : 0;
                        }
                        return c[metric.key] || 0;
                    });

                    const maxValue = Math.max(...allValues.filter(v => typeof v === 'number'));
                    const currentValue = typeof value === 'number' ? value : 
                                       metric.format === 'years' ? (value?.match(/(\d+)/) ? parseInt(value.match(/(\d+)/)[0]) : 0) :
                                       metric.format === 'boolean' ? (value === 'Verified' ? 1 : 0) : 0;

                    // Add crown icon for best performer
                    if (currentValue === maxValue && maxValue > 0 && candidates.length > 1) {
                        displayValue = `👑 ${displayValue}`;
                        cellClass += ' bg-yellow-500/10 rounded';
                    }

                    return `<td class="${cellClass}">${displayValue}</td>`;
                }).join('')}
            </tr>
        `;
    }).join('');
}
	
// Show comparison modal with enhanced radar charts
function showComparisonModal(candidates) {
    const modal = document.getElementById('comparisonModal');
    const content = document.getElementById('comparisonContent');

    // Set grid columns based on number of candidates
    const gridCols = candidates.length === 2 ? 'grid-cols-1' : 'grid-cols-1';
    content.className = `space-y-6`;

    // Generate comparison content
    content.innerHTML = `
        <!-- Radar Chart Comparison -->
        <div class="bg-dark-primary rounded-lg p-6">
            <h3 class="text-xl font-bold text-accent-cyan mb-4 flex items-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
		    <circle cx="12" cy="12" r="3"/>
		    <circle cx="12" cy="12" r="6"/>
		    <circle cx="12" cy="12" r="9"/>
		    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v18m9-9H3"/>
		</svg>
                Skills & Performance Radar
            </h3>
            <div class="flex justify-center">
                <div class="w-full max-w-2xl">
                    <canvas id="radarChart" width="400" height="400"></canvas>
                </div>
            </div>
            
            <!-- Legend -->
            <div class="mt-4 flex flex-wrap justify-center gap-4">
                ${candidates.map((candidate, index) => `
                    <div class="flex items-center space-x-2">
                        <div class="w-4 h-4 rounded-full" style="background-color: ${getChartColor(index)}"></div>
                        <span class="text-gray-300 text-sm font-medium">${candidate.name}</span>
                    </div>
                `).join('')}
            </div>
        </div>

        <!-- Side-by-Side Comparison Cards -->
        <div class="grid ${candidates.length === 2 ? 'grid-cols-2' : 'grid-cols-3'} gap-6">
            ${candidates.map((candidate, index) => generateComparisonCard(candidate, index)).join('')}
        </div>

        <!-- Detailed Score Breakdown -->
        <div class="bg-dark-primary rounded-lg p-6">
            <h3 class="text-xl font-bold text-white mb-4">Detailed Score Analysis</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-gray-700">
                            <th class="text-left text-gray-400 pb-3">Metric</th>
                            ${candidates.map(candidate => `
                                <th class="text-center text-gray-400 pb-3">${candidate.name}</th>
                            `).join('')}
                        </tr>
                    </thead>
                    <tbody class="space-y-2">
                        ${generateScoreComparisonRows(candidates)}
                    </tbody>
                </table>
            </div>
        </div>
    `;

    // Generate the radar chart
    setTimeout(() => {
        generateRadarChart(candidates);
    }, 100);

    modal.classList.remove('hidden');
}

// --- Export and Clipboard Logic ---

function showExportToast(text = "Exporting...") {
    const toast = document.getElementById('exportToast');
    const toastText = document.getElementById('exportToastText');
    toastText.textContent = text;
    toast.classList.remove('hidden');
}
function hideExportToast() {
    const toast = document.getElementById('exportToast');
    toast.classList.add('hidden');
}

// Export all current candidates as CSV
function downloadCSV() {
    const csvRows = [
        ['Name', 'Title', 'Experience', 'Location', 'AI Score', 'Source', 'Strengths', 'Concerns', 'Recommendation']
    ];
    (currentCandidates || []).forEach(candidate => {
        csvRows.push([
            candidate.name,
            candidate.title,
            candidate.experience,
            candidate.location,
            candidate.aiScore,
            candidate.source,
            (candidate.strengths || []).join('; '),
            (candidate.concerns || []).join('; '),
            candidate.recommendation || ''
        ]);
    });
    const csvContent = csvRows.map(row => row.map(val => `"${(val || '').toString().replace(/"/g, '""')}"`).join(',')).join('\n');
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.setAttribute('hidden', '');
    a.setAttribute('href', url);
    a.setAttribute('download', `leadfinder_results_${new Date().toISOString().split('T')[0]}.csv`);
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

// Copy summary of results to clipboard
function copyToClipboard() {
    const textData = `LEADFINDER SEARCH RESULTS

${(currentCandidates || []).map(c =>
    `${c.name} - ${c.title} (${c.experience}) - ${c.location} - Score: ${c.aiScore}`
).join('\n')}

Generated on: ${new Date().toLocaleDateString()}`;
    navigator.clipboard.writeText(textData).then(() => {
        showCustomToast('Copied!', 'Results copied to clipboard!', 'success');
    }).catch(err => {
        console.error('Failed to copy: ', err);
    });
}

// Export one candidate to CSV
function exportCandidateToCSV(candidate) {
    if (!candidate) return;
    const csvRows = [
        ["Name", "Title", "Experience", "Location", "AI Score", "Source", "Strengths", "Concerns", "Recommendation"],
        [
            candidate.name,
            candidate.title,
            candidate.experience,
            candidate.location,
            candidate.aiScore,
            candidate.source,
            (candidate.strengths || []).join("; "),
            (candidate.concerns || []).join("; "),
            candidate.recommendation || ""
        ]
    ];
    const csvContent = csvRows.map(row => row.map(value => `"${(value || '').toString().replace(/"/g, '""')}"`).join(",")).join("\n");
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.setAttribute('hidden', '');
    a.setAttribute('href', url);
    a.setAttribute('download', `candidate_${candidate.name.replace(/\s+/g, "_")}_${new Date().toISOString().split('T')[0]}.csv`);
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

// Export one candidate to PDF (uses jsPDF library)
function exportCandidateToPDF(candidate) {
    if (!candidate) return;
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Title
    doc.setFontSize(18);
    doc.setTextColor(0, 212, 170);
    doc.text("Candidate Profile", 14, 16);

    // Basic info
    doc.setFontSize(12);
    doc.setTextColor(34, 34, 34);
    let y = 30;
    doc.text(`Name: ${candidate.name}`, 14, y);      y += 8;
    doc.text(`Title: ${candidate.title}`, 14, y);    y += 8;
    doc.text(`Experience: ${candidate.experience || ''}`, 14, y); y += 8;
    doc.text(`Location: ${candidate.location}`, 14, y);  y += 8;
    doc.text(`AI Score: ${candidate.aiScore}`, 14, y);   y += 8;
    doc.text(`Source: ${candidate.source}`, 14, y);      y += 8;

    // AI Analysis Summary (metrics)
    doc.setFont(undefined, "bold");
    doc.text("AI Analysis Metrics:", 14, y); y += 6;
    doc.setFont(undefined, "normal");
    const m = candidate.scoreBreakdown || {};
    doc.text(`- Role Relevance: ${m.roleRelevance ?? 'N/A'}%`, 18, y); y += 6;
    doc.text(`- Experience Match: ${m.experienceMatch ?? 'N/A'}%`, 18, y); y += 6;
    doc.text(`- Location Fit: ${m.locationFit ?? 'N/A'}%`, 18, y); y += 6;
    doc.text(`- Profile Quality: ${m.profileQuality ?? 'N/A'}%`, 18, y); y += 8;

    // Company Context
    doc.setFont(undefined, "bold");
    doc.text("Company Context:", 14, y); y += 6;
    doc.setFont(undefined, "normal");
    doc.text(doc.splitTextToSize(
        candidate.companyContext || "No company context provided.",
        180), 18, y);
    y += Math.max(12, doc.splitTextToSize(candidate.companyContext || "", 180).length * 6);

    // Strengths
    doc.setFont(undefined, "bold");
    doc.text("Key Strengths:", 14, y);
    doc.setFont(undefined, "normal");
    y += 6;
    (candidate.strengths || []).forEach(strength => {
        doc.text(`- ${strength}`, 18, y);
        y += 6;
    });

    // Concerns
    if (candidate.concerns && candidate.concerns.length > 0) {
        doc.setFont(undefined, "bold");
        doc.text("Concerns:", 14, y);
        doc.setFont(undefined, "normal");
        y += 6;
        (candidate.concerns || []).forEach(concern => {
            doc.text(`- ${concern}`, 18, y);
            y += 6;
        });
    }

    // Recommendation
    if (candidate.recommendation) {
        doc.setFont(undefined, "bold");
        doc.text("AI Recommendation:", 14, y);
        doc.setFont(undefined, "normal");
        y += 6;
        doc.text(doc.splitTextToSize(candidate.recommendation, 180), 18, y);
        y += 12;
    }

    doc.save(`candidate_${candidate.name.replace(/\s+/g, "_")}_${new Date().toISOString().split('T')[0]}.pdf`);
}

// Export one candidate to Clipboard
function exportCandidateToClipboard(candidate) {
    if (!candidate) return;
    const m = candidate.scoreBreakdown || {};
    const text = `
Candidate Profile - ${candidate.name}
---------------------------------------

Title: ${candidate.title}
Experience: ${candidate.experience || ''}
Location: ${candidate.location}
AI Score: ${candidate.aiScore}
Source: ${candidate.source}

AI Analysis Metrics:
- Role Relevance: ${m.roleRelevance ?? 'N/A'}%
- Experience Match: ${m.experienceMatch ?? 'N/A'}%
- Location Fit: ${m.locationFit ?? 'N/A'}%
- Profile Quality: ${m.profileQuality ?? 'N/A'}%

Company Context:
${candidate.companyContext || "No company context provided."}

Key Strengths:
${(candidate.strengths || []).map(s => `- ${s}`).join('\n')}

${candidate.concerns && candidate.concerns.length > 0 ? "Concerns:\n" + candidate.concerns.map(c => `- ${c}`).join('\n') + "\n" : ""}
${candidate.recommendation ? "AI Recommendation:\n" + candidate.recommendation : ""}
    `.trim();

    navigator.clipboard.writeText(text).then(() => {
        showExportToast("Copied to clipboard!");
        setTimeout(hideExportToast, 1200);
    }).catch(() => {
        showCustomToast('Copy Failed', 'Failed to copy to clipboard.', 'error');
    });
}

function handleExport(type) {
    switch (type) {
        case 'pdf':
            // Generate PDF report
            showCustomToast('Coming Soon', 'PDF export functionality will be implemented with jsPDF', 'info');
            break;
        case 'csv':
            // Generate CSV download
            downloadCSV();
            break;
        case 'clipboard':
            // Copy to clipboard
            copyToClipboard();
            break;
    }
    exportModal.classList.add('hidden');
}

// Export button event delegation
document.addEventListener('click', (e) => {
    if (e.target.closest('button') && e.target.closest('button').textContent.includes('PDF Report')) {
        handleExport('pdf');
    } else if (e.target.closest('button') && e.target.closest('button').textContent.includes('CSV Spreadsheet')) {
        handleExport('csv');
    } else if (e.target.closest('button') && e.target.closest('button').textContent.includes('Copy to Clipboard')) {
        handleExport('clipboard');
    }
});

// --- Search History Logic ---

// Update search history count badge
function updateSearchHistoryCount() {
    const historyBtn = document.getElementById('searchHistoryBtn');
    const countSpan = historyBtn.querySelector('span:last-child');
    if (countSpan) {
        countSpan.textContent = searchHistory.length.toString();
    }
}

// Update the search history UI with recent history
async function updateSearchHistoryUI() {
    const history = JSON.parse(localStorage.getItem('leadfinder_history') || '[]');
    const historyBtn = document.getElementById('searchHistoryBtn');
    const countSpan = historyBtn.querySelector('.bg-accent-cyan');
    
    if (countSpan) {
        countSpan.textContent = history.length.toString();
    }
    
    const historyModal = document.getElementById('historyModal');
    const historyContainer = historyModal.querySelector('.space-y-4');
    
    if (historyContainer) {
        if (history.length === 0) {
            historyContainer.innerHTML = `
                <div class="text-center py-8 text-gray-400">
                    <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    <p>No search history yet</p>
                </div>
            `;
        } else {
            historyContainer.innerHTML = history.map((item, index) => `
                <div class="bg-dark-primary rounded-lg p-4 hover:bg-dark-tertiary transition-colors cursor-pointer search-history-item" data-search-index="${index}">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="font-semibold text-white">${item.jobTitle || 'Untitled Search'} in ${item.location || 'Any Location'}</h3>
                        <span class="text-sm text-gray-400">${getRelativeTime(item.timestamp)}</span>
                    </div>
                    <p class="text-sm text-gray-300 mb-2">${item.industry || 'Any Industry'} • ${item.experience || 'Any Experience'}</p>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-accent-cyan">${item.resultCount} candidates found</span>
                        <button class="px-3 py-1 bg-accent-cyan/20 hover:bg-accent-cyan text-accent-cyan hover:text-dark-primary rounded-lg text-xs font-semibold flex items-center rerun-search-btn">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            Rerun Search
                        </button>
                    </div>
                </div>
            `).join('');
            
            window.searchHistoryData = history;
        }
    }
}

// Helper for relative time strings
function getRelativeTime(timestamp) {
    const now = new Date();
    const then = new Date(timestamp);
    const diffMs = now - then;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    if (diffMins < 60) return `${diffMins} minutes ago`;
    if (diffHours < 24) return `${diffHours} hours ago`;
    return `${diffDays} days ago`;
}

// Custom toast notification system
function showCustomToast(title, message, type = 'info', duration = 5000) {
    const toast = document.getElementById('customToast');
    const icon = document.getElementById('toastIcon');
    const titleEl = document.getElementById('toastTitle');
    const messageEl = document.getElementById('toastMessage');
    
    titleEl.textContent = title;
    messageEl.textContent = message;
    
    // Set icon based on type
    if (type === 'success') {
        icon.className = 'w-8 h-8 rounded-full flex items-center justify-center bg-green-500/20 text-green-400';
        icon.innerHTML = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>';
    } else if (type === 'error') {
        icon.className = 'w-8 h-8 rounded-full flex items-center justify-center bg-red-500/20 text-red-400';
        icon.innerHTML = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>';
    } else {
        icon.className = 'w-8 h-8 rounded-full flex items-center justify-center bg-blue-500/20 text-blue-400';
        icon.innerHTML = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/></svg>';
    }
    
    toast.classList.remove('hidden');
    
    if (duration > 0) {
        setTimeout(() => {
            toast.classList.add('hidden');
        }, duration);
    }
}

// Toast close button handler
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('toastClose').addEventListener('click', () => {
        document.getElementById('customToast').classList.add('hidden');
    });
});

// Save a search to local history (still useful as fallback or secondary record)
// Enhanced history management
function saveToSearchHistory(searchParams, resultCount, candidates) {
    const searchEntry = {
        id: Date.now(),
        ...searchParams,
        resultCount: resultCount,
        candidates: candidates,
        timestamp: new Date().toISOString(),
        date: new Date().toLocaleDateString(),
        type: searchParams.type || 'basic' // 'basic', 'individual', 'bulk'
    };
    
    // Get existing history
    let basicHistory = JSON.parse(localStorage.getItem('leadfinder_basic_history') || '[]');
    let analyticsHistory = JSON.parse(localStorage.getItem('leadfinder_analytics_history') || '[]');
    
    if (searchEntry.type === 'basic') {
        basicHistory.unshift(searchEntry);
        basicHistory = basicHistory.slice(0, 50);
        localStorage.setItem('leadfinder_basic_history', JSON.stringify(basicHistory));
    } else {
        analyticsHistory.unshift(searchEntry);
        analyticsHistory = analyticsHistory.slice(0, 50);
        localStorage.setItem('leadfinder_analytics_history', JSON.stringify(analyticsHistory));
    }
    
    updateHistoryTabCounts();
}

// Tab switching functionality
document.getElementById('basicSearchTab').addEventListener('click', function() {
    switchHistoryTab('basic');
});

document.getElementById('analyticsHistoryTab').addEventListener('click', function() {
    switchHistoryTab('analytics');
});

function switchHistoryTab(tabType) {
    // Update tab buttons
    document.querySelectorAll('.history-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Hide all content
    document.getElementById('basicSearchContent').classList.add('hidden');
    document.getElementById('analyticsHistoryContent').classList.add('hidden');
    
    if (tabType === 'basic') {
        document.getElementById('basicSearchTab').classList.add('active');
        document.getElementById('basicSearchContent').classList.remove('hidden');
    } else if (tabType === 'analytics') {
        document.getElementById('analyticsHistoryTab').classList.add('active');
        document.getElementById('analyticsHistoryContent').classList.remove('hidden');
    }
}

// Bookmark Management System
let savedCandidates = JSON.parse(localStorage.getItem('leadfinder_saved_candidates') || '[]');

// Check if candidate is bookmarked
function isBookmarked(candidateId) {
    return savedCandidates.some(candidate => candidate.id === candidateId);
}

// Toggle bookmark status
function toggleBookmark(candidateId) {
    const candidate = currentCandidates.find(c => c.id === candidateId);
    if (!candidate) return;
    
    if (isBookmarked(candidateId)) {
        // Remove bookmark
        savedCandidates = savedCandidates.filter(c => c.id !== candidateId);
        showCustomToast('Removed', `${candidate.name} removed from saved candidates`, 'info');
    } else {
        // Add bookmark (check limit)
        if (savedCandidates.length >= 50) {
            showCustomToast('Limit Reached', 'Maximum 50 candidates can be saved. Remove some candidates first.', 'error');
            return;
        }
        
        // Add timestamp for when it was saved
        const candidateWithTimestamp = {
            ...candidate,
            savedAt: new Date().toISOString()
        };
        
        savedCandidates.unshift(candidateWithTimestamp); // Add to beginning
        showCustomToast('Saved', `${candidate.name} added to saved candidates`, 'success');
    }
    
    // Update localStorage
    localStorage.setItem('leadfinder_saved_candidates', JSON.stringify(savedCandidates));
    
    // Update UI
    updateBookmarkCounter();
    updateBookmarkIcons();
    updateHistoryTabCounts();
}

// Update bookmark counter (FIXED VERSION)
function updateBookmarkCounter() {
    // Update both possible elements
    const headerText = document.getElementById('savedCandidatesHeaderText');
    const savedCount = document.getElementById('savedCount');
    const count = savedCandidates.length;
    
    // Update the span in the header button
    if (savedCount) {
        savedCount.textContent = count.toString();
    }
    
    // Keep the old one for backward compatibility
    if (headerText) {
        headerText.textContent = count === 0 ? '0 saved' : 
                                 count === 1 ? '1 saved' : 
                                 `${count} saved`;
    }
    console.log('Bookmarks updated:', savedCandidates.length);
}

// Update bookmark icons on current page
function updateBookmarkIcons() {
    document.querySelectorAll('.bookmark-icon').forEach(icon => {
        const candidateId = icon.dataset.candidateId;
        
        // Only update if we have a valid candidate ID
        if (candidateId) {
            const bookmarked = isBookmarked(candidateId);
            icon.className = `bookmark-icon ${bookmarked ? 'bookmarked' : 'not-bookmarked'}`;
            icon.title = bookmarked ? 'Remove from saved candidates' : 'Save candidate';
        } else {
            // Default to not bookmarked if no ID
            icon.className = 'bookmark-icon not-bookmarked';
            icon.title = 'Save candidate';
        }
    });
}

// Get saved candidates for display
function getSavedCandidates() {
    return savedCandidates.sort((a, b) => new Date(b.savedAt) - new Date(a.savedAt));
}

// Remove candidate from saved list
function removeSavedCandidate(candidateId) {
    savedCandidates = savedCandidates.filter(c => c.id !== candidateId);
    localStorage.setItem('leadfinder_saved_candidates', JSON.stringify(savedCandidates));
    
    updateBookmarkCounter();
    updateBookmarkIcons();
    updateHistoryTabCounts();
    renderSavedCandidates(); // Refresh the saved candidates view
}

// Render saved candidates in the modal
function renderSavedCandidates() {
    const container = document.getElementById('savedCandidatesList');
    const candidates = getSavedCandidates();
    
    if (candidates.length === 0) {
        container.innerHTML = `
            <div class="text-center py-8 text-gray-400">
                <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/>
                </svg>
                <p>No saved candidates yet</p>
                <p class="text-sm mt-2">Bookmark candidates from search results to save them here</p>
            </div>
        `;
        return;
    }

    container.innerHTML = candidates.map((candidate, index) => `
        <div class="bg-dark-primary rounded-lg p-4 hover:bg-dark-tertiary transition-colors">
            <div class="flex items-center justify-between mb-2">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center">
                        <span class="text-white font-semibold text-sm">${candidate.name.split(' ').map(n => n[0]).join('').substring(0, 2)}</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-white">${candidate.name}</h3>
                        <p class="text-sm text-gray-300">${candidate.title}</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="text-center">
                        <div class="text-lg font-bold text-accent-cyan">${candidate.aiScore}</div>
                        <div class="text-xs text-gray-400">AI Score</div>
                    </div>
                    <span class="text-sm text-gray-400">${getRelativeTime(candidate.savedAt)}</span>
                    <button class="text-red-400 hover:text-red-300 p-1" onclick="removeSavedCandidate('${candidate.id}')" title="Remove from saved">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="flex items-center justify-between">
                <span class="text-sm text-gray-400">${candidate.location} • ${candidate.experience || 'Experienced'}</span>
                <button class="px-3 py-1 bg-accent-cyan/20 hover:bg-accent-cyan text-accent-cyan hover:text-dark-primary rounded-lg text-xs font-semibold view-saved-candidate" data-candidate='${JSON.stringify(candidate).replace(/'/g, "&apos;")}'>
                    View Details
                </button>
            </div>
        </div>
    `).join('');

    // Add click handlers for viewing saved candidate details
    container.querySelectorAll('.view-saved-candidate').forEach(btn => {
        btn.addEventListener('click', function() {
            const candidateData = JSON.parse(this.dataset.candidate.replace(/&apos;/g, "'"));
            showCandidateModal(candidateData);
            document.getElementById('historyModal').classList.add('hidden');
        });
    });
}

// Show saved candidates in main results view (like search results)
function showSavedCandidatesInMainView() {
    const savedCands = getSavedCandidates();
    
    if (savedCands.length === 0) {
        // Show empty state
        document.getElementById('initialState').classList.add('hidden');
        document.getElementById('loadingState').classList.add('hidden');
        document.getElementById('resultsState').classList.remove('hidden');
        
        // Update title
        const resultsTitle = document.querySelector('#resultsState h3');
        const resultsDesc = document.querySelector('#resultsState p');
        if (resultsTitle) resultsTitle.textContent = 'Saved Candidates';
        if (resultsDesc) resultsDesc.textContent = 'No saved candidates yet. Bookmark candidates from search results.';
        
        document.getElementById('candidateCardsContainer').innerHTML = `
            <div class="text-center py-8 text-gray-400">
                <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/>
                </svg>
                <p>No saved candidates yet</p>
                <p class="text-sm mt-2">Bookmark candidates from search results to save them here</p>
            </div>
        `;
        return;
    }
    
    // Show saved candidates in main view
    currentCandidates = savedCands; // Set global candidates
    
    // Update results description
    const resultsTitle = document.querySelector('#resultsState h3');
    const resultsDesc = document.querySelector('#resultsState p');
    if (resultsTitle) resultsTitle.textContent = 'Saved Candidates';
    if (resultsDesc) resultsDesc.textContent = `${savedCands.length} saved candidates ready for review`;
    
    // Update AI insights for saved candidates
    const aiInsights = `Viewing **${savedCands.length} saved candidates** from your bookmarks. These are your top picks selected across multiple searches. **All features available:** filtering, comparison, analytics, and export.`;
    document.getElementById('aiInsightsText').innerHTML = aiInsights;
    
    // Generate and populate stats grid for saved candidates
    const statsGrid = generateStatsGrid(savedCands);
    document.getElementById('statsGrid').innerHTML = statsGrid;
    
    // Show results view
    document.getElementById('initialState').classList.add('hidden');
    document.getElementById('loadingState').classList.add('hidden');
    document.getElementById('resultsState').classList.remove('hidden');
    
    // Update candidate cards
    updateCandidateCards(savedCands);
    
    // Setup filters for saved candidates
    setTimeout(() => {
        setupResultFilters();
    }, 100);
}
	
function updateHistoryTabCounts() {
    const basicHistory = JSON.parse(localStorage.getItem('leadfinder_basic_history') || '[]');
    const analyticsHistory = JSON.parse(localStorage.getItem('leadfinder_analytics_history') || '[]');
    
    document.getElementById('basicSearchCount').textContent = basicHistory.length;
    document.getElementById('analyticsHistoryCount').textContent = analyticsHistory.length;
    
    // Update main search history button count
    const totalCount = basicHistory.length + analyticsHistory.length;
    const mainHistoryBtn = document.getElementById('searchHistoryBtn');
    const countSpan = mainHistoryBtn.querySelector('.bg-accent-cyan');
    if (countSpan) {
        countSpan.textContent = totalCount.toString();
    }
}

// Enhanced search history UI update
async function updateSearchHistoryUI() {
    const basicHistory = JSON.parse(localStorage.getItem('leadfinder_basic_history') || '[]');
    const analyticsHistory = JSON.parse(localStorage.getItem('leadfinder_analytics_history') || '[]');
    
    updateHistoryTabCounts();
    renderBasicSearchHistory(basicHistory);
    renderAnalyticsHistory(analyticsHistory);
}

function renderBasicSearchHistory(history) {
    const container = document.getElementById('basicSearchList');
    
    if (history.length === 0) {
        container.innerHTML = `
            <div class="text-center py-8 text-gray-400">
                <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <p>No search history yet</p>
                <p class="text-sm mt-2">Your basic searches will appear here</p>
            </div>
        `;
        return;
    }

    container.innerHTML = history.map((item, index) => `
        <div class="bg-dark-primary rounded-lg p-4 hover:bg-dark-tertiary transition-colors cursor-pointer search-history-item" data-search-index="${index}" data-history-type="basic">
            <div class="flex items-center justify-between mb-2">
                <h3 class="font-semibold text-white">${item.jobTitle || 'Search'} in ${item.location || 'Any Location'}</h3>
                <div class="flex items-center space-x-3">
                    <span class="text-sm text-gray-400">${getRelativeTime(item.timestamp)}</span>
                    <span class="px-2 py-1 bg-accent-cyan/20 text-accent-cyan text-xs rounded-full font-medium">Basic</span>
                </div>
            </div>
            <p class="text-sm text-gray-300 mb-2">${item.industry || 'Any Industry'} • ${item.experience || 'Any Experience'}</p>
            <div class="flex items-center justify-between">
                <span class="text-sm text-accent-cyan">${item.resultCount} candidates found</span>
                <button class="px-3 py-1 bg-accent-cyan/20 hover:bg-accent-cyan text-accent-cyan hover:text-dark-primary rounded-lg text-xs font-semibold flex items-center rerun-search-btn">
                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    Rerun Search
                </button>
            </div>
        </div>
    `).join('');
}

function renderAnalyticsHistory(history) {
    const container = document.getElementById('analyticsHistoryList');
    
    if (history.length === 0) {
        container.innerHTML = `
            <div class="text-center py-8 text-gray-400">
                <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <p>No analytics history yet</p>
                <p class="text-sm mt-2">Your upgraded candidate analyses will appear here</p>
            </div>
        `;
        return;
    }

    container.innerHTML = history.map((item, index) => {
        const isIndividual = item.type === 'individual';
        const isBulk = item.type === 'bulk';
        
        return `
            <div class="bg-gradient-to-r from-purple-900/20 to-blue-900/20 border border-purple-500/30 rounded-lg p-4 hover:from-purple-500/20 hover:to-blue-500/20 transition-colors cursor-pointer analytics-history-item" data-analytics-index="${index}">
			    <div class="flex items-center justify-between mb-2">
			        <div class="flex items-center space-x-2">
			            <h3 class="font-semibold text-white">${isIndividual ? `${item.candidateName} - Predictive Analytics` : isBulk ? `${item.candidateCount} Candidates - ${item.candidateNames ? item.candidateNames.join(', ') : 'Bulk Analytics'}` : item.jobTitle}</h3>
			            <span class="px-2 py-1 bg-purple-500/30 text-purple-300 text-xs rounded-full font-medium">
			                ${isIndividual ? 'Individual' : isBulk ? 'Bulk' : 'Analytics'}
			            </span>
			        </div>
			        <span class="text-sm text-gray-400">${getRelativeTime(item.timestamp)}</span>
			    </div>
			    
			    <div class="flex items-center justify-between">
			        <span class="text-sm text-purple-400">
			            ${isIndividual ? '1 candidate analyzed' : isBulk ? `${item.candidateCount} candidates analyzed` : `${item.resultCount} results`}
			        </span>
			        <span class="text-xs text-gray-400">
			            ${isIndividual ? '5 credits used' : isBulk ? `${item.candidateCount * 3} credits used` : 'Credits used'}
			        </span>
			    </div>
			</div>
        `;
    }).join('');
}

// Event delegation for rerun search button in history
document.addEventListener('click', (e) => {
    if (e.target.classList.contains('rerun-search-btn')) {
        e.stopPropagation();
        const historyItem = e.target.closest('.search-history-item');
        const searchIndex = parseInt(historyItem.dataset.searchIndex);
        const searchData = window.searchHistoryData[searchIndex];
        // Fill form with historical search
        document.getElementById('jobTitle').value = searchData.jobTitle || '';
        document.getElementById('industry').value = searchData.industry || '';
        document.getElementById('location').value = searchData.location || '';
        document.getElementById('experience').value = searchData.experience || '';
        // Close modal and run search
        historyModal.classList.add('hidden');
        searchForm.dispatchEvent(new Event('submit'));
    }
});

// --- Analytics & AI Insights Logic ---

// Update any analytics displays you have (optional; console.log for now)
function updateAnalytics(analytics) {
    // Example: update analytics widgets if you have them
    if (!analytics) return;
    console.log('Search Quality:', analytics.searchQuality);
    console.log('Recommended Action:', analytics.recommendedAction);
}

// Extract job title from search query string
function extractJobTitleFromQuery(queryString) {
    if (!queryString) return null;
    // Remove location and extra keywords, keep first 2-3 words
    const words = queryString.split(' ').filter(word => 
        !['indonesia', 'jakarta', 'bandung', '-jobs', '-hiring', '-vacancy'].includes(word.toLowerCase())
    );
    return words.slice(0, 3).join(' '); // Take first 3 words as job title
}

// Generate and display AI insights summary for the search
function generateAIInsights(candidates, searchQuery) {
    console.log('generateAIInsights called with:', searchQuery);
    
    const totalCandidates = candidates.length;
    if (totalCandidates === 0) return "No candidates found for this search.";
    
    // Score analysis
    const scores = candidates.map(c => c.aiScore).sort((a, b) => b - a);
    const minScore = Math.min(...scores);
    const maxScore = Math.max(...scores);
    const avgScore = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
    
    // Experience analysis
    const experiences = candidates.map(c => {
	    const match = c.experience?.match(/(\d+)/);
	    const years = match ? parseInt(match[0]) : 0;
	    // Filter out unrealistic values (more than 50 years experience)
	    return years > 0 && years <= 50 ? years : 0;
	}).filter(exp => exp > 0);
    
    const minExp = experiences.length > 0 ? Math.min(...experiences) : 0;
    const maxExp = experiences.length > 0 ? Math.max(...experiences) : 0;
    const avgExp = experiences.length > 0 ? Math.round(experiences.reduce((a, b) => a + b, 0) / experiences.length) : 0;
    
    // Priority breakdown
    const highScoreCandidates = candidates.filter(c => c.aiScore >= 80).length;
    const mediumScoreCandidates = candidates.filter(c => c.aiScore >= 60 && c.aiScore < 80).length;
    const lowScoreCandidates = candidates.filter(c => c.aiScore < 60).length;
    
    // Verification count
    const verifiedCount = candidates.filter(c => c.verificationStatus === 'Verified').length;
    
    // Locations
    const locations = [...new Set(candidates.map(c => c.location))];
    
    // Use the correct property names
    const jobTitle = extractJobTitleFromQuery(searchQuery.searchQuery) || searchQuery.jobTitle || 'the position';
    const location = searchQuery.location || 'the specified location';

    // Build enhanced insights
    let insights = `Found **${totalCandidates} candidates** matching "${jobTitle}" in ${location}. `;
    
    // Score and experience distribution
    insights += `**Score Range:** ${minScore}-${maxScore} (Avg: ${avgScore}) • `;
    if (experiences.length > 0) {
        insights += `**Experience:** ${minExp}-${maxExp} years (Avg: ${avgExp}) • `;
    }
    
    // Priority breakdown
    if (highScoreCandidates > 0) {
        insights += `**${highScoreCandidates} High Priority** (80+) • `;
    }
    if (mediumScoreCandidates > 0) {
        insights += `**${mediumScoreCandidates} Medium Priority** (60-79) • `;
    }
    if (lowScoreCandidates > 0) {
        insights += `**${lowScoreCandidates} Low Priority** (<60) • `;
    }
    
    // Verification and location info
    if (verifiedCount > 0) {
        insights += `**${verifiedCount} verified profiles** • `;
    }
    
    if (locations.length > 1) {
        insights += `Spread across **${locations.length} locations** • `;
    }
    
    insights += `**Top matches ready for immediate contact.**`;

    return insights;
}

// Generate visual stats grid for enhanced display
function generateStatsGrid(candidates) {
    if (candidates.length === 0) return '';
    
    // Calculate stats
    const scores = candidates.map(c => c.aiScore);
    const minScore = Math.min(...scores);
    const maxScore = Math.max(...scores);
    const avgScore = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
    
    const experiences = candidates.map(c => {
        const match = c.experience?.match(/(\d+)/);
        return match ? parseInt(match[0]) : 0;
    }).filter(exp => exp > 0);
    
    const avgExp = experiences.length > 0 ? Math.round(experiences.reduce((a, b) => a + b, 0) / experiences.length) : 0;
    const highPriority = candidates.filter(c => c.aiScore >= 80).length;
    const verifiedCount = candidates.filter(c => c.verificationStatus === 'Verified').length;
    
    return `
        <div class="text-center p-3 bg-blue-500/10 rounded-lg border border-blue-500/20">
            <div class="flex items-center justify-center space-x-1 mb-1">
                <svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span class="text-xs text-blue-400 font-medium">Score Range</span>
            </div>
            <div class="text-lg font-bold text-white">${minScore}-${maxScore}</div>
            <div class="text-xs text-gray-400">Avg: ${avgScore}</div>
        </div>
        
        <div class="text-center p-3 bg-green-500/10 rounded-lg border border-green-500/20">
            <div class="flex items-center justify-center space-x-1 mb-1">
                <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                </svg>
                <span class="text-xs text-green-400 font-medium">Experience</span>
            </div>
            <div class="text-lg font-bold text-white">${experiences.length > 0 ? Math.min(...experiences) + '-' + Math.max(...experiences) + 'y' : 'N/A'}</div>
            <div class="text-xs text-gray-400">Avg: ${avgExp}y</div>
        </div>
        
        <div class="text-center p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20">
            <div class="flex items-center justify-center space-x-1 mb-1">
                <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
                <span class="text-xs text-yellow-400 font-medium">High Priority</span>
            </div>
            <div class="text-lg font-bold text-white">${highPriority}</div>
            <div class="text-xs text-gray-400">${Math.round(highPriority/candidates.length*100)}% of total</div>
        </div>
        
        <div class="text-center p-3 bg-purple-500/10 rounded-lg border border-purple-500/20">
            <div class="flex items-center justify-center space-x-1 mb-1">
                <svg class="w-4 h-4 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.238.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span class="text-xs text-purple-400 font-medium">Verified</span>
            </div>
            <div class="text-lg font-bold text-white">${verifiedCount}</div>
            <div class="text-xs text-gray-400">${Math.round(verifiedCount/candidates.length*100)}% verified</div>
        </div>
    `;
}

// --- Enhanced Loading Animation ---

// Main enhanced loading function with steps and tips
async function showEnhancedLoading() {
	loadingCancelled = false;
    const steps = [
        { 
            step: 1, 
            text: 'Initializing LinkedIn search parameters', 
            delay: 2000, 
            progress: 8,
            tip: '🔍 Optimizing search criteria for best results'
        },
        { 
            step: 2, 
            text: 'Searching LinkedIn professional profiles', 
            delay: 8000, 
            progress: 25,
            tip: '🌐 Scanning thousands of LinkedIn profiles in Indonesia'
        },
        { 
            step: 3, 
            text: 'Extracting candidate information', 
            delay: 15000, 
            progress: 40,
            tip: '📊 Processing profile data and work history'
        },
        { 
            step: 4, 
            text: 'Running AI analysis and scoring', 
            delay: 25000, 
            progress: 60,
            tip: '🤖 AI analyzing candidate qualifications and experience'
        },
        { 
            step: 5, 
            text: 'Evaluating role and experience match', 
            delay: 35000, 
            progress: 75,
            tip: '⚡ Calculating compatibility scores for each candidate'
        },
        { 
            step: 6, 
            text: 'Ranking candidates by compatibility', 
            delay: 42000, 
            progress: 90,
            tip: '🎯 Sorting candidates by best matches first'
        },
        { 
            step: 7, 
            text: 'Finalizing results and recommendations', 
            delay: 48000, 
            progress: 100,
            tip: '✨ Preparing your personalized talent recommendations'
        }
    ];

    let previousDelay = 0;
    let lastProgress = 0;

    for (let stepData of steps) {
	    if (loadingCancelled) {
            console.log('Loading animation cancelled');
            return;
        }
        // Animate progress from lastProgress to stepData.progress over the segment duration
        await smoothRandomProgress(lastProgress, stepData.progress, stepData.delay - previousDelay);

		if (loadingCancelled) return;

        updateStepStatus(stepData.step, 'processing');
        updateLoadingTip(stepData.tip);

        await new Promise(resolve => setTimeout(resolve, 800));

		if (loadingCancelled) return;
		
        updateStepStatus(stepData.step, 'complete');

        lastProgress = stepData.progress;
        previousDelay = stepData.delay + 800;
    }
	if (!loadingCancelled) {
    	await new Promise(resolve => setTimeout(resolve, 500));
    	updateLoadingTip('🎉 Search completed successfully! Displaying results...');
	}
}

function cancelLoadingAnimation() {
    loadingCancelled = true;
}
	
// Smooth, randomized progress increment between two values over a set duration
async function smoothRandomProgress(from, to, totalDuration = 1000) {
    return new Promise(resolve => {
        let current = from;
        const target = to;
        const increments = [];
        let remaining = target - current;
        // Create random increments between 1 and 5, sum up to the difference
        while (remaining > 0) {
            let step = Math.min(Math.floor(Math.random() * 5) + 1, remaining);
            increments.push(step);
            remaining -= step;
        }
        const stepDuration = totalDuration / increments.length;

        function doStep(i) {
            if (i >= increments.length) {
                updateProgressBar(target); // make sure it hits the target
                resolve();
                return;
            }
            current += increments[i];
            updateProgressBar(current);
            setTimeout(() => doStep(i + 1), stepDuration);
        }
        doStep(0);
    });
}

// Update the progress bar visually
function updateProgressBar(percentage) {
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressPercentage');
    if (progressBar) {
        progressBar.style.width = `${percentage}%`;
        progressBar.style.boxShadow = `0 0 10px rgba(0, 212, 170, 0.4)`;
    }
    if (progressText) {
        progressText.textContent = `${percentage}%`;
    }
}

// Update the step status indicator and style
function updateStepStatus(stepNumber, status) {
    const stepElement = document.querySelector(`[data-step="${stepNumber}"]`);
    if (!stepElement) return;
    const allSpans = stepElement.querySelectorAll('span');
    let statusElement = null;
    for (let i = allSpans.length - 1; i >= 0; i--) {
        if (allSpans[i].textContent.includes('Pending') || 
            allSpans[i].textContent.includes('Processing') || 
            allSpans[i].textContent.includes('Complete')) {
            statusElement = allSpans[i];
            break;
        }
    }
    const numberCircle = stepElement.querySelector('.w-6.h-6.rounded-full');
    if (status === 'processing') {
        stepElement.classList.add('bg-dark-tertiary/30', 'rounded-lg', 'scale-[1.02]', 'transition-all');
        if (statusElement) {
            statusElement.className = 'text-yellow-400 flex items-center';
            statusElement.innerHTML = `
                <svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                Processing...
            `;
        }
        if (numberCircle) {
            numberCircle.className = 'w-6 h-6 rounded-full bg-yellow-500 flex items-center justify-center text-xs text-dark-primary font-semibold animate-pulse';
        }
    } else if (status === 'complete') {
        stepElement.classList.remove('bg-dark-tertiary/30', 'scale-[1.02]');
        if (statusElement) {
            statusElement.className = 'text-accent-cyan flex items-center font-medium';
            statusElement.innerHTML = `
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                Complete
            `;
        }
        if (numberCircle) {
            numberCircle.className = 'w-6 h-6 rounded-full bg-accent-cyan flex items-center justify-center text-xs text-dark-primary font-semibold';
            numberCircle.innerHTML = `
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
            `;
        }
    }
}

function updateLoadingStep(stepText, status) {
    const statusContainer = document.querySelector('#loadingState .space-y-2');
    if (!statusContainer) return;
    
    const stepElements = statusContainer.querySelectorAll('.flex');
    
    stepElements.forEach(element => {
	const textSpan = element.querySelector('span:first-child');
	const statusSpan = element.querySelector('span:last-child');
	
	if (textSpan && textSpan.textContent === stepText) {
	    if (status === 'processing') {
		statusSpan.className = 'text-yellow-400';
		statusSpan.innerHTML = '⏳ Processing...';
	    } else if (status === 'complete') {
		statusSpan.className = 'text-accent-cyan';
		statusSpan.innerHTML = '✓ Complete';
	    }
	}
    });
}

// Update loading step tip message (with fade animation)
function updateLoadingTip(tip) {
    const tipElement = document.getElementById('loadingTip');
    if (tipElement) {
        tipElement.textContent = tip;
        tipElement.style.opacity = '0';
        setTimeout(() => {
            tipElement.style.opacity = '1';
        }, 100);
    }
}

// Individual candidate upgrade
async function upgradeIndividualCandidate(candidateId) {
    console.log('=== INDIVIDUAL ANALYTICS DEBUG ===');
    console.log('Target candidate ID:', candidateId);
    
    // Check if another operation is in progress
    if (isSearching || isAnalyzing) {
        showCustomToast('Please Wait', 'Another operation is in progress', 'info');
        throw new Error('Operation in progress');
    }
    isAnalyzing = true;

    const candidate = currentCandidates.find(c => c.id === candidateId);
    console.log('Found candidate:', candidate ? candidate.name : 'NOT FOUND');
    
    if (!candidate) {
        isAnalyzing = false; // Reset flag on early return
        throw new Error('Candidate not found');
    }
    
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 300000); // 5 minutes
    
    const requestBody = {
        candidate: candidate,
        userId: 'test-user-123',
        timestamp: new Date().toISOString(),
        type: 'individual'
    };
    
    const requestUrl = 'https://montpro.app.n8n.cloud/webhook/leadfinder-individual-analytics';
    
    // DETAILED DEBUG LOGGING
    console.log('=== INDIVIDUAL ANALYTICS REQUEST DEBUG ===');
    console.log('Request URL:', requestUrl);
    console.log('Request Body:', JSON.stringify(requestBody, null, 2));
    console.log('Candidate being sent:', candidate.name);
    console.log('==========================================');
    
    try {
        console.log('Making fetch request...');
        
        const response = await fetch(requestUrl, {
            method: 'POST',
            signal: controller.signal,
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': `Bearer leadfinder_secretkey123`,
                'X-User-ID': 'test-user-123'
            },
            body: JSON.stringify(requestBody)
        });
        
        clearTimeout(timeoutId);
        console.log('Response received. Status:', response.status);
        console.log('Response headers:', Object.fromEntries(response.headers.entries()));
        
        // Log response text regardless of status for debugging
        const responseText = await response.text();
        console.log('Raw response text:', responseText);
        
        const data = JSON.parse(responseText);
        console.log('Parsed response data:', data);
        
        // Handle both success (200) and server errors (500) that still return valid data
        if (!response.ok && response.status !== 500) {
            throw new Error(`HTTP error! status: ${response.status}, response: ${responseText}`);
        }
        
        // Handle the standardized response format (direct object, not wrapped in array)
        if (data && data.success && data.results && data.results.length > 0) {
            const result = data.results[0];
            console.log('=== INDIVIDUAL ANALYTICS RESULT ===');
            console.log('Processing analytics for:', result.candidateName);
            console.log('Target candidate ID was:', candidateId);
            
            // Update candidate with analytics
            const candidateIndex = currentCandidates.findIndex(c => c.id === candidateId);
            console.log('Found candidate at index:', candidateIndex);
            
            if (candidateIndex !== -1) {
                console.log('Before update - candidate name:', currentCandidates[candidateIndex].name);
                console.log('Assigning analytics to:', currentCandidates[candidateIndex].name);
                
                currentCandidates[candidateIndex] = {
                    ...currentCandidates[candidateIndex],
                    careerAnalytics: result.careerAnalytics
                };

                console.log('After update - has analytics:', !!currentCandidates[candidateIndex].careerAnalytics);
                
                // Check if other candidates got contaminated
                currentCandidates.forEach((c, i) => {
                    if (i !== candidateIndex && c.careerAnalytics) {
                        console.log(`🚨 CONTAMINATION: Candidate ${i} (${c.name}) has analytics but shouldn't!`);
                    }
                });
                
                // Refresh the UI
                updateCandidateCards(currentCandidates);
                attachCandidateCardHandlers(currentCandidates);
                
                // Deduct credits on success (5 for individual)
                const creditDeducted = await deductCredit(5);
                if (creditDeducted) {
                    await logCreditTransaction(-5, 'individual_analytics', `Individual Analytics: ${result.candidateName}`);
                    console.log('5 credits deducted successfully');
                }
                
                // Save to analytics history
                saveToSearchHistory({
                    jobTitle: 'Individual Predictive Analytics',
                    candidateName: result.candidateName,
                    type: 'individual'
                }, 1, [currentCandidates[candidateIndex]]);
                
                showCustomToast('Success', `Analytics completed for ${result.candidateName}!`, 'success');
                console.log('Individual analytics completed successfully');
            }
        } else {
            throw new Error(`Analytics failed: ${data.error || 'Unknown error'}`);
        }
        
        // Reset flag on success
        isAnalyzing = false;
        
    } catch (error) {
        clearTimeout(timeoutId);
        console.error('Individual analytics failed:', error);
        
        // Reset flag on error
        isAnalyzing = false;
        throw error;
    }
}

// Bulk candidates upgrade  
async function upgradeBulkCandidates(candidateIds) {
    // Check if another operation is in progress
    if (isSearching || isAnalyzing) {
        showCustomToast('Please Wait', 'Another operation is in progress', 'info');
        throw new Error('Operation in progress');
    }
    isAnalyzing = true;

    const candidates = candidateIds.map(id => currentCandidates.find(c => c.id === id)).filter(Boolean);
    if (candidates.length === 0) {
        isAnalyzing = false; // Reset flag on early return
        throw new Error('No candidates found');
    }
    
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 600000); // 10 minutes for bulk
    
    const requestBody = {
        candidates: candidates,
        userId: 'test-user-123',
        timestamp: new Date().toISOString(),
        type: 'bulk'
    };
    
    const requestUrl = 'https://montpro.app.n8n.cloud/webhook/leadfinder-bulk-analytics';
    
    // DETAILED DEBUG LOGGING
    console.log('=== BULK ANALYTICS REQUEST DEBUG ===');
    console.log('Request URL:', requestUrl);
    console.log('Request Body:', JSON.stringify(requestBody, null, 2));
    console.log('Candidates being sent:', candidates.map(c => c.name));
    console.log('========================================');
    
    try {
        console.log('Making bulk fetch request...');
        
        const response = await fetch(requestUrl, {
            method: 'POST',
            signal: controller.signal,
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': `Bearer leadfinder_secretkey123`,
                'X-User-ID': 'test-user-123'
            },
            body: JSON.stringify(requestBody)
        });
        
        clearTimeout(timeoutId);
        console.log('Bulk response received. Status:', response.status);
        console.log('Bulk response headers:', Object.fromEntries(response.headers.entries()));
        
        // Log response text regardless of status for debugging
        const responseText = await response.text();
        console.log('Bulk raw response text:', responseText);
        
        const data = JSON.parse(responseText);
        console.log('Bulk parsed response data:', data);
        
        // Handle both success (200) and server errors (500) that still return valid data
        if (!response.ok && response.status !== 500) {
            throw new Error(`HTTP error! status: ${response.status}, response: ${responseText}`);
        }
        
        // Handle the standardized response format (direct object, not wrapped in array)
        if (data && data.success && data.results) {
            console.log(`Processing ${data.processed} of ${data.total} candidates`);
            
            let updatedCandidates = [];
            
            // Process each result
		data.results.forEach((result, index) => {
		    console.log(`=== Processing result ${index + 1} ===`);
		    console.log('Result candidate name:', result.candidateName);
		    console.log('Result candidate ID:', result.candidateId);
		    
                const candidateIndex = currentCandidates.findIndex(c => {
		    // Try exact name match first (most reliable)
		    if (c.name === result.candidateName) return true;
		    
		    // Try exact ID match  
		    if (c.id === result.candidateId) return true;
		    
		    // Try partial name match (case insensitive)
		    if (c.name.toLowerCase().includes(result.candidateName.toLowerCase()) || 
		        result.candidateName.toLowerCase().includes(c.name.toLowerCase())) {
		        return true;
		    }
		    
		    return false;
		});
		
		console.log(`Matching "${result.candidateName}" → Found index: ${candidateIndex}`);
		if (candidateIndex !== -1) {
		    console.log(`Matched to: ${currentCandidates[candidateIndex].name}`);
		}

	    	console.log('Found candidate at index:', candidateIndex);
                if (candidateIndex !== -1) {
		console.log('Matched candidate name:', currentCandidates[candidateIndex].name);
	        console.log('Analytics being assigned to:', currentCandidates[candidateIndex].name);
                    currentCandidates[candidateIndex] = {
                        ...currentCandidates[candidateIndex],
                        careerAnalytics: result.careerAnalytics
                    };
                    updatedCandidates.push(currentCandidates[candidateIndex]);
                    console.log('Updated analytics for:', result.candidateName);
                }
            });
            
            if (updatedCandidates.length > 0) {
                // Refresh the UI
                updateCandidateCards(currentCandidates);
                attachCandidateCardHandlers(currentCandidates);
                
                // Deduct credits (3 per successfully processed candidate)
		const creditsUsed = data.processed * 3;
		const creditDeducted = await deductCredit(creditsUsed);
		if (creditDeducted) {
		    await logCreditTransaction(-creditsUsed, 'bulk_analytics', `Bulk Analytics: ${data.processed} candidates analyzed`);
		    console.log(`${creditsUsed} credits deducted successfully`);
		}
                
                // Save to analytics history
                saveToSearchHistory({
                    jobTitle: 'Bulk Analytics',
                    candidateCount: data.processed,
                    candidateNames: data.results.map(r => r.candidateName),
                    type: 'bulk'
                }, data.processed, updatedCandidates);
                
                // Clear selections
                document.querySelectorAll('.candidate-checkbox:checked').forEach(cb => cb.checked = false);
                updateCompareButton();
                
                const message = data.processed === data.total 
                    ? `Analytics completed for all ${data.processed} candidates!`
                    : `Analytics completed for ${data.processed} of ${data.total} candidates. Credits used: ${creditsUsed}`;
                
                showCustomToast('Bulk Analysis Complete', message, 'success');
                console.log('Bulk analytics completed. Processed:', data.processed);
            }
        } else {
            throw new Error(`Bulk analytics failed: ${data.error || 'Unknown error'}`);
        }
        
        // Reset flag on success
        isAnalyzing = false;
        
    } catch (error) {
        clearTimeout(timeoutId);
        console.error('Bulk analytics failed:', error);
        
        // Reset flag on error
        isAnalyzing = false;
        throw error;
    }
}

// Generate outreach messages
async function generateOutreachMessages(candidateData) {
    const purpose = document.getElementById('outreachPurpose').value;
    const customPurpose = document.getElementById('customPurpose').value;
	const userCompany = document.getElementById('userCompany').value.trim() || 'a leading company';
	const messageLanguage = document.getElementById('messageLanguage').value;
    
    const requestData = {
        candidate: {
            name: candidateData.name,
            title: candidateData.title,
            experience: candidateData.experience,
            location: candidateData.location
        },
        purpose: purpose === 'custom' ? customPurpose : purpose,
        currentJobRole: candidateData.title,
        currentCompanyName: candidateData.companyContext || 'No company information available',
    	recruiterCompany: userCompany,
		language: messageLanguage,
        userId: currentUser?.id || "test-user-123"
    };
    
    try {
        // Show loading state
        showMessageLoading();
        
        const response = await fetch('https://montpro.app.n8n.cloud/webhook/leadfinder-outreach', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer leadfinder_secretkey123',
                'X-User-ID': 'test-user-123'
            },
            body: JSON.stringify(requestData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            populateMessages(data.messages);
        } else {
            throw new Error(data.error || 'Failed to generate messages');
        }
        
    } catch (error) {
        console.error('Message generation failed:', error);
        showMessageError();
    }
}

// Show loading state for messages
function showMessageLoading() {
    const messageIds = [
        'linkedinShortMessage',
        'linkedinElaborateMessage', 
        'emailShortMessage',
        'emailElaborateMessage'
    ];
    
    messageIds.forEach(id => {
        const element = document.getElementById(id);
        element.innerHTML = `
            <div class="flex items-center space-x-2 message-loading">
                <svg class="w-4 h-4 animate-spin text-accent-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
                </svg>
                <span class="text-gray-400">Generating personalized message...</span>
            </div>
        `;
    });
    
    // Disable generate button
    const generateBtn = document.getElementById('generateNewMessages');
    generateBtn.disabled = true;
    generateBtn.classList.add('opacity-50');
}

// Populate messages with API response
function populateMessages(messages) {
    // LinkedIn messages
    document.getElementById('linkedinShortMessage').innerHTML = messages.linkedinShort || 'Failed to generate message';
    document.getElementById('linkedinElaborateMessage').innerHTML = messages.linkedinElaborate || 'Failed to generate message';
    
    // Email messages  
    document.getElementById('emailShortMessage').innerHTML = messages.emailShort || 'Failed to generate message';
    document.getElementById('emailElaborateMessage').innerHTML = messages.emailElaborate || 'Failed to generate message';
    
    // SAVE MESSAGES TO CANDIDATE DATA
    if (activeCandidate) {
        activeCandidate.outreachMessages = messages;
        
        // Also update in currentCandidates array
        const candidateIndex = currentCandidates.findIndex(c => c.id === activeCandidate.id);
        if (candidateIndex !== -1) {
            currentCandidates[candidateIndex].outreachMessages = messages;
        }
    }
    
    // Re-enable generate button
    const generateBtn = document.getElementById('generateNewMessages');
    generateBtn.disabled = false;
    generateBtn.classList.remove('opacity-50');
}

// Show error state
function showMessageError() {
    const messageIds = [
        'linkedinShortMessage',
        'linkedinElaborateMessage',
        'emailShortMessage', 
        'emailElaborateMessage'
    ];
    
    messageIds.forEach(id => {
        const element = document.getElementById(id);
        element.innerHTML = `
            <div class="flex items-center space-x-2 text-red-400">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                </svg>
                <span>Failed to generate message. Please try again.</span>
            </div>
        `;
    });
    
    // Re-enable generate button
    const generateBtn = document.getElementById('generateNewMessages');
    generateBtn.disabled = false;
    generateBtn.classList.remove('opacity-50');
}

// Reset message boxes to default state
function resetMessageBoxes() {
    const messageIds = [
        'linkedinShortMessage',
        'linkedinElaborateMessage',
        'emailShortMessage',
        'emailElaborateMessage'
    ];
    
    messageIds.forEach(id => {
        document.getElementById(id).innerHTML = 'Click "Generate Messages" to create personalized outreach content...';
    });
}

// Custom confirmation modal
function showConfirmModal(title, message) {
    return new Promise((resolve) => {
        const modal = document.getElementById('confirmModal');
        const titleEl = document.getElementById('confirmTitle');
        const messageEl = document.getElementById('confirmMessage');
        const okBtn = document.getElementById('confirmOk');
        const cancelBtn = document.getElementById('confirmCancel');
        
        titleEl.textContent = title;
        messageEl.textContent = message;
        modal.classList.remove('hidden');
        
        function cleanup() {
            modal.classList.add('hidden');
            okBtn.removeEventListener('click', handleOk);
            cancelBtn.removeEventListener('click', handleCancel);
            modal.removeEventListener('click', handleBackdrop);
        }
        
        function handleOk() {
            cleanup();
            resolve(true);
        }
        
        function handleCancel() {
            cleanup();
            resolve(false);
        }
        
        function handleBackdrop(e) {
            if (e.target === modal) {
                cleanup();
                resolve(false);
            }
        }
        
        okBtn.addEventListener('click', handleOk);
        cancelBtn.addEventListener('click', handleCancel);
        modal.addEventListener('click', handleBackdrop);
    });
}

async function initiateCreditPurchase() {
    console.log('=== STARTING CREDIT PURCHASE ===');
    
    // Check if user is authenticated
    if (!currentUser) {
        showCustomToast('Authentication Required', 'Please sign in to purchase credits', 'error');
        showAuthModal();
        return;
    }
    
    // Show loading modal with enhanced UX
    showPaymentLoading('Preparing secure payment gateway...');
    
    try {
        // Create order ID with timestamp for uniqueness
        const orderId = `MP-${currentUser.id.slice(0, 8)}-${Date.now()}`;
        
        // Prepare payment request data (simplified for your backend)
        const paymentData = {
            amount: 599000,
            credits: 30,
            user_email: currentUser.email,
            user_id: currentUser.id
        };
        
        console.log('Payment data prepared:', paymentData);
        updatePaymentLoadingText('Contacting payment processor...');
        
        // Call your backend to create Midtrans transaction
        const response = await fetch('https://montpro.app.n8n.cloud/webhook/create-payment', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(paymentData)
        });
        
        if (!response.ok) {
            throw new Error(`Payment API error: ${response.status}`);
        }
        
        const paymentResponse = await response.json();
        console.log('Backend payment response:', paymentResponse);
        
        // Extract token from response (handle both array and object formats)
        let snapToken;
        if (Array.isArray(paymentResponse)) {
            snapToken = paymentResponse[0]?.token;
        } else {
            snapToken = paymentResponse.token;
        }
        
        if (!snapToken) {
            throw new Error('Invalid payment token received');
        }
        
        updatePaymentLoadingText('Opening secure payment window...');
        
        // Hide loading modal before showing Snap
        hidePaymentLoading();
        
        // Open Midtrans Snap payment
        window.snap.pay(snapToken, {
            onSuccess: async function(result) {
                console.log('Payment success:', result);
                await handlePaymentSuccess(result, orderId);
            },
            onPending: function(result) {
                console.log('Payment pending:', result);
                showCustomToast('Payment Pending', 'Please complete your payment to receive credits', 'warning');
            },
            onError: function(result) {
                console.log('Payment error:', result);
                handlePaymentError(result);
            },
            onClose: function() {
                console.log('Payment popup closed');
                showCustomToast('Payment Cancelled', 'You can try again anytime', 'info');
            }
        });
        
    } catch (error) {
        console.error('Payment initiation failed:', error);
        hidePaymentLoading();
        
        let errorMessage = 'Payment setup failed. Please try again.';
        if (error.message.includes('network')) {
            errorMessage = 'Network error. Please check your connection.';
        } else if (error.message.includes('token')) {
            errorMessage = 'Payment gateway error. Please try again.';
        }
        
        showCustomToast('Payment Error', errorMessage, 'error');
    }
}

// Handle successful payment
async function handlePaymentSuccess(result, orderId) {
    console.log('=== PAYMENT SUCCESS HANDLING ===');
    
    try {
        // Show success modal first for immediate feedback
        showPaymentSuccess();
        
        // Add credits to user account
        const creditsToAdd = 30;
        const newCreditTotal = userCredits + creditsToAdd;
        
        const { error: updateError } = await supabaseClient
            .from('leadfinder_users')
            .update({ 
                credits: newCreditTotal,
                updated_at: new Date().toISOString()
            })
            .eq('id', currentUser.id);
        
        if (updateError) {
            console.error('Failed to update credits:', updateError);
            // Still show success but with warning
            showCustomToast('Payment Complete', 'Credits will be added shortly. Contact support if delayed.', 'warning');
        } else {
            // Update local state
            userCredits = newCreditTotal;
            updateCreditsDisplay();
            
            // Log the transaction
            await logCreditTransaction(creditsToAdd, 'purchase', `Credit purchase: ${orderId}`);
            
            console.log('Credits successfully added. New total:', newCreditTotal);
        }
        
        // Hide pricing page if it's open
        hidePricingPage();
        
        // Optional: Track conversion for analytics
        trackPurchaseEvent(orderId, creditsToAdd, 599000);
        
    } catch (error) {
        console.error('Post-payment processing error:', error);
        showCustomToast('Payment Received', 'There was an issue adding credits. Contact support with order ID: ' + orderId, 'warning');
    }
}

// Handle payment errors
function handlePaymentError(result) {
    console.log('=== PAYMENT ERROR HANDLING ===');
    
    let errorMessage = 'Payment failed. Please try again.';
    
    // Customize error messages based on error type
    if (result && result.status_message) {
        if (result.status_message.includes('insufficient')) {
            errorMessage = 'Insufficient funds. Please check your payment method.';
        } else if (result.status_message.includes('expired')) {
            errorMessage = 'Payment session expired. Please try again.';
        } else if (result.status_message.includes('cancelled')) {
            errorMessage = 'Payment was cancelled.';
        }
    }
    
    showCustomToast('Payment Failed', errorMessage, 'error');
}

// Payment loading modal functions
function showPaymentLoading(message = 'Processing payment...') {
    const modal = document.getElementById('paymentLoadingModal');
    const textElement = document.getElementById('paymentLoadingText');
    
    if (textElement) textElement.textContent = message;
    modal.classList.remove('hidden');
}

function updatePaymentLoadingText(message) {
    const textElement = document.getElementById('paymentLoadingText');
    if (textElement) textElement.textContent = message;
}

function hidePaymentLoading() {
    const modal = document.getElementById('paymentLoadingModal');
    modal.classList.add('hidden');
}

// Payment success modal functions
function showPaymentSuccess() {
    const modal = document.getElementById('paymentSuccessModal');
    modal.classList.remove('hidden');
}

function hidePaymentSuccess() {
    const modal = document.getElementById('paymentSuccessModal');
    modal.classList.add('hidden');
}

// Close success modal event listener
document.getElementById('closeSuccessModal').addEventListener('click', function() {
    hidePaymentSuccess();
});

// Analytics tracking (optional)
function trackPurchaseEvent(orderId, credits, amount) {
    try {
        // You can integrate with Google Analytics, Mixpanel, etc.
        console.log('Purchase tracked:', {
            orderId,
            credits,
            amount: amount / 1000, // Convert to thousands for readability
            userId: currentUser.id
        });
        
        // Example: Google Analytics 4 event
        if (typeof gtag !== 'undefined') {
            gtag('event', 'purchase', {
                transaction_id: orderId,
                value: amount / 1000,
                currency: 'IDR',
                items: [{
                    item_id: 'CREDITS_30',
                    item_name: '30 Credits - Leadfinder Tool',
                    category: 'Credits',
                    quantity: 1,
                    price: amount / 1000
                }]
            });
        }
    } catch (error) {
        console.log('Analytics tracking failed:', error);
    }
}

// Enhanced error handling for payment flow
function isPaymentRelatedError(error) {
    const paymentErrorKeywords = ['payment', 'transaction', 'midtrans', 'snap', 'token'];
    const errorMessage = error.message?.toLowerCase() || '';
    return paymentErrorKeywords.some(keyword => errorMessage.includes(keyword));
}
	
// --- Utility: Modal/Keyboard Shortcuts & Startup
	
// Close modals when clicking outside
document.addEventListener('click', (e) => {
    if (e.target === candidateModal) candidateModal.classList.add('hidden');
    if (e.target === historyModal) historyModal.classList.add('hidden');
    if (e.target === exportModal) exportModal.classList.add('hidden');
});

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
    // Escape key closes modals
    if (e.key === 'Escape') {
        candidateModal.classList.add('hidden');
        historyModal.classList.add('hidden');
        exportModal.classList.add('hidden');
    }
    // Ctrl/Cmd + Enter submits search (unless loading)
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        if (!loadingState.classList.contains('hidden')) return;
        handleSearch(e);
    }
});

// Initial UI setup: update search history, focus job title input, scale search button on hover
(async () => {
    await updateSearchHistoryUI();
    document.getElementById('jobTitle').focus();

	// Initialize bookmark system
    updateBookmarkCounter();
    updateHistoryTabCounts();
	
})();
const searchBtn = document.getElementById('searchBtn');
searchBtn.addEventListener('mouseenter', () => {
    if (!searchBtn.disabled) {
        searchBtn.classList.add('transform', 'scale-105');
    }
});
searchBtn.addEventListener('mouseleave', () => {
    searchBtn.classList.remove('transform', 'scale-105');
});

// Candidate modal export handlers
document.addEventListener('click', async (e) => {
    const btn = e.target.closest('.export-modal-btn');
    if (btn) {
        const type = btn.dataset.type;
        showExportToast(`Exporting ${type.toUpperCase()}...`);
        await new Promise(r => setTimeout(r, 1000));
        if (type === 'pdf') {
            exportCandidateToPDF(activeCandidate);
        } else if (type === 'csv') {
            exportCandidateToCSV(activeCandidate);
        } else if (type === 'clipboard') {
            exportCandidateToClipboard(activeCandidate);
        }
        hideExportToast();
    }
	// Manual test for checkboxes
setTimeout(() => {
    console.log('Testing checkbox listeners...');
    const checkboxes = document.querySelectorAll('.candidate-checkbox');
    console.log('Found checkboxes:', checkboxes.length);
    checkboxes.forEach((cb, i) => {
        console.log(`Checkbox ${i}:`, cb);
    });
}, 2000);
});
	// Compare button event listener
	document.getElementById('compareBtn').addEventListener('click', function() {
	    console.log('Compare button clicked');
	    const selectedCandidates = getSelectedCandidates();
	    console.log('Selected candidates:', selectedCandidates.length);
	    if (selectedCandidates.length > 0) {
	        showComparisonModal(selectedCandidates);
	    }
	});
	// ADD THIS: Comparison modal close handlers
	document.getElementById('closeComparisonModal').addEventListener('click', function() {
	    document.getElementById('comparisonModal').classList.add('hidden');
	});
	
	// Close comparison modal when clicking outside
	document.getElementById('comparisonModal').addEventListener('click', function(e) {
	    if (e.target === this) {
	        this.classList.add('hidden');
	    }
	});
	// LinkedIn button click handler
	document.getElementById('viewLinkedInBtn').addEventListener('click', function() {
	    if (activeCandidate && activeCandidate.profileUrl) {
	        window.open(activeCandidate.profileUrl, '_blank');
	    } else {
	        showCustomToast('Not Available', 'LinkedIn profile URL not available for this candidate', 'info');
	    }
	});
	// Search History modal handler
	document.getElementById('searchHistoryBtn').addEventListener('click', function() {
	    // Load and render both history types
	    const basicHistory = JSON.parse(localStorage.getItem('leadfinder_basic_history') || '[]');
	    const analyticsHistory = JSON.parse(localStorage.getItem('leadfinder_analytics_history') || '[]');

		console.log('Basic history:', basicHistory); // DEBUG
	    console.log('Analytics history:', analyticsHistory); // DEBUG
	    console.log('About to call render functions'); // DEBUG
	    
	    updateHistoryTabCounts();
	    renderBasicSearchHistory(basicHistory);
	    renderAnalyticsHistory(analyticsHistory);

		console.log('Modal should open now'); // DEBUG
	    document.getElementById('historyModal').classList.remove('hidden');
	});
	// Close history modal handlers
	document.getElementById('closeHistoryModal').addEventListener('click', function() {
	    document.getElementById('historyModal').classList.add('hidden');
	});
	
	document.getElementById('historyModal').addEventListener('click', function(e) {
	    if (e.target === this) {
	        this.classList.add('hidden');
	    }
	});
	// Event delegation for search history items
	document.addEventListener('click', (e) => {
	    // Existing rerun search button handler
	    if (e.target.classList.contains('rerun-search-btn')) {
	        e.stopPropagation();
	        const historyItem = e.target.closest('.search-history-item');
	        const searchIndex = parseInt(historyItem.dataset.searchIndex);
	        const searchData = window.searchHistoryData[searchIndex];
	        // Fill form with historical search
	        document.getElementById('jobTitle').value = searchData.jobTitle || '';
	        document.getElementById('industry').value = searchData.industry || '';
	        document.getElementById('location').value = searchData.location || '';
	        document.getElementById('experience').value = searchData.experience || '';
	        // Close modal and run search
	        document.getElementById('historyModal').classList.add('hidden');
	        document.getElementById('searchForm').dispatchEvent(new Event('submit'));
	    }
	    
	    // ADD THIS: Click on history item to show results
	    if (e.target.closest('.search-history-item') && !e.target.closest('.rerun-search-btn')) {
	        const historyItem = e.target.closest('.search-history-item');
	        const searchIndex = parseInt(historyItem.dataset.searchIndex);
	        const searchData = window.searchHistoryData[searchIndex];
	        
	        console.log('History item clicked:', searchData);
	        
	        // Show the previous results without running new search
	        showHistorySearchResult(searchData);
	        
	        // Close history modal and show results
	        document.getElementById('historyModal').classList.add('hidden');
	        document.getElementById('initialState').classList.add('hidden');
	        document.getElementById('resultsState').classList.remove('hidden');
	    }
	});

	// Individual upgrade button handler - FIXED VERSION
	document.addEventListener('click', async function(e) {
	    const upgradeBtn = e.target.closest('.upgrade-analytics-btn');
	    
	    if (upgradeBtn) {
	        // Set flag IMMEDIATELY to prevent modal opening
	        window.upgradingCandidate = true;
	        
	        e.stopPropagation();
	        e.preventDefault();
	        e.stopImmediatePropagation();
	        
	        const candidateId = upgradeBtn.dataset.candidateId;
	        const candidate = currentCandidates.find(c => c.id === candidateId);
	        
	        if (!candidate) {
	            console.error('Candidate not found for ID:', candidateId);
	            window.upgradingCandidate = false;
	            return;
	        }
	        
	        // Check credits (5 credits for individual)
	        if (userCredits < 5) {
	            showCustomToast('Insufficient Credits', 'You need 5 credits for individual analytics.', 'error');
	            window.upgradingCandidate = false;
	            return;
	        }
	        
	        // Show custom confirmation
	        const confirmed = await showConfirmModal(
	            'Career Predictive Analytics',
	            `Analyze ${candidate.name}'s career potential and growth trajectory for 5 credits?`
	        );
	        
	        if (!confirmed) {
	            window.upgradingCandidate = false;
	            return;
	        }
	        
	        // Disable button and show loading
	        upgradeBtn.disabled = true;
	        const originalHTML = upgradeBtn.innerHTML;
	        upgradeBtn.innerHTML = `
	            <div class="flex items-center space-x-2">
	                <svg class="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
	                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
	                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
	                </svg>
	                <span>Analyzing...</span>
	            </div>
	        `;
	        upgradeBtn.classList.add('opacity-75');
	        
	        try {
	            await upgradeIndividualCandidate(candidateId);
	        } catch (error) {
	            console.error('Individual upgrade failed:', error);
	            showCustomToast('Analysis Failed', 'Please try again.', 'error');
	            
	            // Re-enable button on error
	            upgradeBtn.disabled = false;
	            upgradeBtn.innerHTML = originalHTML;
	            upgradeBtn.classList.remove('opacity-75');
	        } finally {
	            window.upgradingCandidate = false;
	        }
	    }
	});

	// Bookmark toggle event handler
	document.addEventListener('click', function(e) {
	    // Bookmark icon clicks
	    if (e.target.closest('.bookmark-icon')) {
	        e.stopPropagation(); // Prevent card click
	        e.preventDefault(); // Prevent any default behavior
	        e.stopImmediatePropagation(); // Stop all event propagation
	        
	        const bookmarkIcon = e.target.closest('.bookmark-icon');
	        const candidateId = bookmarkIcon.dataset.candidateId;
	        
	        // Toggle bookmark
	        toggleBookmark(candidateId);
	        
	        // Force immediate visual update
	        setTimeout(() => {
	            updateBookmarkIcons();
	        }, 50);
	    }
	});

	// Bulk upgrade button handler - FIXED VERSION
	document.getElementById('bulkAnalyticsBtn').addEventListener('click', async function(e) {
	    e.stopPropagation();
	    e.preventDefault();
	    
	    const selectedCheckboxes = document.querySelectorAll('.candidate-checkbox:checked');
	    const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.dataset.candidateId);
	    
	    // Filter to candidates without analytics
	    const candidatesWithoutAnalytics = selectedIds.filter(id => {
	        const candidate = currentCandidates.find(c => c.id === id);
	        return candidate && (!candidate.careerAnalytics || candidate.careerAnalytics === null);
	    }).map(id => currentCandidates.find(c => c.id === id));
	    
	    if (candidatesWithoutAnalytics.length === 0) {
	        showCustomToast('Already Analyzed', 'All selected candidates already have analytics.', 'info');
	        return;
	    }
	    
	    const totalCredits = candidatesWithoutAnalytics.length * 3; // Bulk pricing
	    
	    // Check credits
	    if (userCredits < totalCredits) {
	        showCustomToast('Insufficient Credits', `You need ${totalCredits} credits for bulk analytics.`, 'error');
	        return;
	    }
	    
	    // Prepare confirmation message
	    const candidateNames = candidatesWithoutAnalytics.slice(0, 3).map(c => c.name).join(', ');
	    const remainingCount = candidatesWithoutAnalytics.length - 3;
	    const namesDisplay = remainingCount > 0 ? `${candidateNames} and ${remainingCount} others` : candidateNames;
	    
	    const message = `Run career predictive analytics for ${candidatesWithoutAnalytics.length} candidates (${namesDisplay}) for ${totalCredits} credits?`;
	    
	    // Show custom confirmation
	    const confirmed = await showConfirmModal(
	        'Bulk Career Predictive Analytics',
	        message
	    );
	    
	    if (!confirmed) return;
	    
	    // Disable button and show loading
	    const button = this;
	    button.disabled = true;
	    const originalText = button.innerHTML;
	    button.innerHTML = `
	        <svg class="w-4 h-4 mr-1 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
	            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
	            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
	        </svg>
	        Analyzing...
	    `;
	    button.classList.add('opacity-50');
	    
	    try {
	        await upgradeBulkCandidates(candidatesWithoutAnalytics.map(c => c.id));
	    } catch (error) {
	        console.error('Bulk upgrade failed:', error);
	        showCustomToast('Analysis Failed', `${error.message}. Please try again.`, 'error');
	        
	        // Re-enable button
	        button.disabled = false;
	        button.innerHTML = originalText;
	        button.classList.remove('opacity-50');
	    }
	});

	// Enhanced history item click handlers
	document.addEventListener('click', (e) => {
	    // Basic search history - rerun search button
	    if (e.target.classList.contains('rerun-search-btn')) {
	        e.stopPropagation();
	        const historyItem = e.target.closest('.search-history-item');
	        const searchIndex = parseInt(historyItem.dataset.searchIndex);
	        const historyType = historyItem.dataset.historyType;
	        
	        let searchData;
	        if (historyType === 'basic') {
	            const basicHistory = JSON.parse(localStorage.getItem('leadfinder_basic_history') || '[]');
	            searchData = basicHistory[searchIndex];
	        }
	        
	        if (searchData) {
	            // Fill form with historical search
	            document.getElementById('jobTitle').value = searchData.jobTitle || '';
	            document.getElementById('industry').value = searchData.industry || '';
	            document.getElementById('location').value = searchData.location || '';
	            document.getElementById('experience').value = searchData.experience || '';
	            
	            // Set to basic search type
	            document.querySelector('input[name="searchType"][value="standard"]').checked = true;
	            
	            // Close modal and run search
	            document.getElementById('historyModal').classList.add('hidden');
	            document.getElementById('searchForm').dispatchEvent(new Event('submit'));
	        }
	    }
	    
	    // Basic search history - click on item to view results
	    if (e.target.closest('.search-history-item') && !e.target.closest('.rerun-search-btn')) {
	        const historyItem = e.target.closest('.search-history-item');
	        const searchIndex = parseInt(historyItem.dataset.searchIndex);
	        const basicHistory = JSON.parse(localStorage.getItem('leadfinder_basic_history') || '[]');
	        const searchData = basicHistory[searchIndex];
	        
	        if (searchData && searchData.candidates) {
	            showHistorySearchResult(searchData);
	            document.getElementById('historyModal').classList.add('hidden');
	            document.getElementById('initialState').classList.add('hidden');
	            document.getElementById('resultsState').classList.remove('hidden');
	        }
	    }
	    
	    // Analytics history - view results button
		if (e.target.closest('.analytics-history-item')) {
		    e.stopPropagation();
		    const historyItem = e.target.closest('.analytics-history-item');
		    const analyticsIndex = parseInt(historyItem.dataset.analyticsIndex);
		    const analyticsHistory = JSON.parse(localStorage.getItem('leadfinder_analytics_history') || '[]');
		    const analyticsData = analyticsHistory[analyticsIndex];
		    
		    if (analyticsData && analyticsData.candidates) {
		        showHistorySearchResult(analyticsData);
		        document.getElementById('historyModal').classList.add('hidden');
		        document.getElementById('initialState').classList.add('hidden');
		        document.getElementById('resultsState').classList.remove('hidden');
		    }
		}
	});

	// Clear all checkboxes button
	document.getElementById('clearAllBtn').addEventListener('click', function() {
	    document.querySelectorAll('.candidate-checkbox:checked').forEach(cb => cb.checked = false);
	    updateCompareButton();
	});

	// Clear all filters button
	document.getElementById('clearAllFiltersBtn').addEventListener('click', clearAllFilters);

	// Saved candidates button click handler - FIXED
	document.getElementById('savedCandidatesBtn').addEventListener('click', function() {
	    // Show saved candidates directly in main results area (replaces current results)
	    showSavedCandidatesInMainView();
	});

	// Test AI Outreach Popup
	document.addEventListener('click', (e) => {
	    if (e.target.closest('#generateOutreachBtn')) {
	        console.log('Generate button clicked!');
	        const popup = document.getElementById('aiOutreachPopup');
	        popup.classList.remove('hidden');
	    }
	    
	    if (e.target.closest('#closeOutreachPopup') || e.target.closest('#closeOutreachPopupBtn')) {
	        console.log('Close button clicked!');
	        const popup = document.getElementById('aiOutreachPopup');
	        popup.classList.add('hidden');
	    }
	});

	// When popup opens, check for existing messages
	document.addEventListener('click', (e) => {
	    if (e.target.closest('#generateOutreachBtn')) {
		const popup = document.getElementById('aiOutreachPopup');
		popup.classList.remove('hidden');
		
		// Initialize LinkedIn tab as active
		document.getElementById('linkedinTab').classList.add('active');
		document.getElementById('linkedinMessages').classList.add('active');
		
		// CHECK IF CURRENT CANDIDATE HAS MESSAGES
		if (activeCandidate && activeCandidate.outreachMessages) {
		    populateMessages(activeCandidate.outreachMessages);
		} else {
		    // RESET TO DEFAULT STATE FOR NEW CANDIDATE
		    resetMessageBoxes();
		}
	    }
	});
	
	// Tab switching functionality
	document.addEventListener('click', (e) => {
	    // Platform tab switching
	    if (e.target.closest('.platform-tab')) {
	        const clickedTab = e.target.closest('.platform-tab');
	        
	        // Remove active class from all tabs
	        document.querySelectorAll('.platform-tab').forEach(tab => {
	            tab.classList.remove('active');
	        });
	        
	        // Add active class to clicked tab
	        clickedTab.classList.add('active');
	        
	        // Hide all message content
	        document.querySelectorAll('.message-content').forEach(content => {
	            content.classList.remove('active');
	        });
	        
	        // Show corresponding content
	        if (clickedTab.id === 'linkedinTab') {
	            document.getElementById('linkedinMessages').classList.add('active');
	        } else if (clickedTab.id === 'emailTab') {
	            document.getElementById('emailMessages').classList.add('active');
	        }
	    }
	});
	
	// Initialize default tab when popup opens
	document.addEventListener('click', (e) => {
	    if (e.target.closest('#generateOutreachBtn')) {
	        // Show popup (existing code)
	        const popup = document.getElementById('aiOutreachPopup');
	        popup.classList.remove('hidden');
	        
	        // Initialize LinkedIn tab as active
	        document.getElementById('linkedinTab').classList.add('active');
	        document.getElementById('linkedinMessages').classList.add('active');
	    }
	});

	// Purpose selector functionality
	document.addEventListener('change', (e) => {
	    if (e.target.id === 'outreachPurpose') {
	        const customInput = document.getElementById('customPurpose');
	        if (e.target.value === 'custom') {
	            customInput.classList.remove('hidden');
	            customInput.focus();
	        } else {
	            customInput.classList.add('hidden');
	            customInput.value = '';
	        }
	    }
	});

	// Copy message functionality
	document.addEventListener('click', (e) => {
	    if (e.target.closest('.copy-message-btn')) {
	        const button = e.target.closest('.copy-message-btn');
	        const messageType = button.dataset.messageType;
	        
	        let messageText = '';
	        
	        // Get the message text based on type
	        switch(messageType) {
	            case 'linkedin-short':
	                messageText = document.getElementById('linkedinShortMessage').textContent;
	                break;
	            case 'linkedin-elaborate':
	                messageText = document.getElementById('linkedinElaborateMessage').textContent;
	                break;
	            case 'email-short':
	                messageText = document.getElementById('emailShortMessage').textContent;
	                break;
	            case 'email-elaborate':
	                messageText = document.getElementById('emailElaborateMessage').textContent;
	                break;
	        }
	        
	        // Copy to clipboard
	        if (messageText && messageText !== 'Generating message...' && !messageText.includes('Failed to generate')) {
	            navigator.clipboard.writeText(messageText).then(() => {
	                // Show success feedback
	                const originalText = button.innerHTML;
	                button.innerHTML = '✓ Copied';
	                button.classList.add('bg-green-500', 'text-white');
	                button.classList.remove('bg-accent-cyan/20', 'text-accent-cyan');
	                
	                setTimeout(() => {
	                    button.innerHTML = originalText;
	                    button.classList.remove('bg-green-500', 'text-white');
	                    button.classList.add('bg-accent-cyan/20', 'text-accent-cyan');
	                }, 2000);
	            }).catch(() => {
	                showCustomToast('Copy Failed', 'Failed to copy message to clipboard', 'error');
	            });
	        } else {
	            showCustomToast('Cannot Copy', 'No message available to copy', 'error');
	        }
	    }
	});
	
	// Generate messages button click
	document.addEventListener('click', async (e) => {
	    if (e.target.closest('#generateNewMessages')) {
	        // Check credits (2 credits required)
	        // if (userCredits < 2) {
	        //     showCustomToast('Insufficient Credits', 'You need 2 credits to generate messages', 'error');
	        //     return;
	        // }
	        
	        // Validate purpose
	        const purpose = document.getElementById('outreachPurpose').value;
	        const customPurpose = document.getElementById('customPurpose').value;
	        
	        if (purpose === 'custom' && !customPurpose.trim()) {
	            showCustomToast('Missing Purpose', 'Please enter your custom purpose', 'error');
	            document.getElementById('customPurpose').focus();
	            return;
	        }
	        
	        // Generate messages with current candidate data
	        if (activeCandidate) {
	            try {
	                await generateOutreachMessages(activeCandidate);
	                
	                // Deduct credits on success (2 for message generation)
			const creditDeducted = await deductCredit(2);
			if (creditDeducted) {
			    await logCreditTransaction(-2, 'message_generation', `Outreach Messages: ${activeCandidate.name}`);
			    console.log('2 credits deducted successfully');
			}
	                
	                showCustomToast('Success', 'Messages generated successfully!', 'success');
	            } catch (error) {
	                showCustomToast('Generation Failed', 'Please try again', 'error');
	            }
	        } else {
	            showCustomToast('Error', 'No candidate selected', 'error');
	        }
	    }
	});

	// Close popup when clicking outside
	document.addEventListener('click', (e) => {
	    const popup = document.getElementById('aiOutreachPopup');
	    const popupContent = popup.querySelector('.absolute.bottom-8');
	    
	    if (!popup.classList.contains('hidden') && 
	        !popupContent.contains(e.target) && 
	        !e.target.closest('#generateOutreachBtn')) {
	        popup.classList.add('hidden');
	    }
	});

	// Refresh credits button
	document.getElementById('refreshCreditsBtn').addEventListener('click', async () => {
	    await syncCreditsAfterEvent('manual');
	});

	// Pricing page event listeners
	document.getElementById('closePricingPage').addEventListener('click', hidePricingPage);
	document.getElementById('buyCreditsBtn').addEventListener('click', async function() {
	    await initiateCreditPurchase();
	});
	
	// Close pricing page when clicking outside
	document.getElementById('pricingPage').addEventListener('click', function(e) {
	    if (e.target === this) {
	        hidePricingPage();
	    }
	});

	// Add this inside your DOMContentLoaded block with other event listeners:
	document.getElementById('closePrivacyPolicy').addEventListener('click', hidePrivacyPolicy);
	
	// Close when clicking outside
	document.getElementById('privacyPolicyPage').addEventListener('click', function(e) {
	    if (e.target === this) {
	        hidePrivacyPolicy();
	    }
	});

	document.getElementById('closeTermsOfService').addEventListener('click', hideTermsOfService);

	// Close when clicking outside
	document.getElementById('termsOfServicePage').addEventListener('click', function(e) {
	    if (e.target === this) {
	        hideTermsOfService();
	    }
	});

	// Add these event listeners in your DOMContentLoaded section:
	document.getElementById('closeHowItWorks').addEventListener('click', hideHowItWorks);
	
	// Close when clicking outside
	document.getElementById('howItWorksPage').addEventListener('click', function(e) {
	    if (e.target === this) {
	        hideHowItWorks();
	    }
	});

	document.getElementById('closeFAQ').addEventListener('click', hideFAQ);

	// Close when clicking outside
	document.getElementById('faqPage').addEventListener('click', function(e) {
	    if (e.target === this) {
	        hideFAQ();
	    }
	});

	document.getElementById('closeFeatures').addEventListener('click', hideFeatures);

	// Close when clicking outside
	document.getElementById('featuresPage').addEventListener('click', function(e) {
	    if (e.target === this) {
	        hideFeatures();
	    }
	});

	// Logout button event listener
	document.getElementById('logoutBtn').addEventListener('click', async function() {
	    try {
	        const { error } = await supabaseClient.auth.signOut();
	        if (error) {
	            console.error('Logout error:', error);
	            showCustomToast('Logout Failed', 'Please try again', 'error');
	        } else {
	            showCustomToast('Logged Out', 'You have been successfully logged out', 'success');
	            // The auth state change listener will handle the rest
	        }
	    } catch (error) {
	        console.error('Logout error:', error);
	        showCustomToast('Logout Failed', 'Please try again', 'error');
	    }
	});

	// Low credit warning button
	document.getElementById('lowCreditWarning').addEventListener('click', showPricingPage);
	
	});

	// Leadfinder logo click to refresh
	document.querySelector('h1').closest('div').addEventListener('click', function() {
	    location.reload();
	});
	
    </script>

	<!-- Add this right before </body> -->
<div id="customToast" class="fixed top-4 right-4 z-50 hidden">
    <div class="bg-dark-secondary border border-accent-cyan/30 rounded-xl p-4 shadow-2xl max-w-md">
        <div class="flex items-center space-x-3">
            <div id="toastIcon" class="w-8 h-8 rounded-full flex items-center justify-center"></div>
            <div class="flex-1">
                <h4 id="toastTitle" class="font-semibold text-white"></h4>
                <p id="toastMessage" class="text-sm text-gray-300"></p>
            </div>
            <button id="toastClose" class="text-gray-400 hover:text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
    </div>
</div>

<!-- Custom Confirmation Modal -->
<div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-dark-secondary rounded-xl max-w-md w-full border border-accent-cyan/30 shadow-2xl">
        <div class="p-6">
            <div class="flex items-center space-x-3 mb-4">
                <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <h3 id="confirmTitle" class="text-xl font-bold text-white">Confirm Analysis</h3>
            </div>
            <p id="confirmMessage" class="text-gray-300 mb-6 leading-relaxed"></p>
            <div class="flex items-center justify-end space-x-3">
                <button id="confirmCancel" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors">
                    Cancel
                </button>
                <button id="confirmOk" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white rounded-lg transition-colors font-medium">
                    Analyze Now
                </button>
            </div>
        </div>
    </div>
</div>

</body>

<!-- Simple Pricing Page Modal -->
<div id="pricingPage" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-dark-secondary rounded-xl max-w-md w-full border border-gray-600">
        <!-- Header -->
        <div class="p-6 border-b border-gray-700">
            <div class="flex items-center justify-between">
                <h2 class="text-xl font-bold text-white">Get More Credits</h2>
                <button id="closePricingPage" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="p-6">
            <!-- Credit Package -->
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-accent-cyan/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-accent-cyan" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"/>
                    </svg>
                </div>
                
                <h3 class="text-2xl font-bold text-white mb-2">30 Credits</h3>
                <p class="text-gray-400 text-sm mb-4">Perfect for your recruiting needs</p>
                
                <div class="text-3xl font-bold text-accent-cyan mb-2">Rp 599.000</div>
                <div class="text-sm text-gray-400">~Rp 20.000 per search</div>
            </div>

            <!-- Features -->
            <div class="space-y-3 mb-6">
                <div class="flex items-center space-x-3">
                    <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                    </svg>
                    <span class="text-gray-300 text-sm">AI-powered candidate search</span>
                </div>
                <div class="flex items-center space-x-3">
                    <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                    </svg>
                    <span class="text-gray-300 text-sm">Access to 1M+ LinkedIn profiles</span>
                </div>
                <div class="flex items-center space-x-3">
                    <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                    </svg>
                    <span class="text-gray-300 text-sm">Credits never expire</span>
                </div>
                <div class="flex items-center space-x-3">
                    <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                    </svg>
                    <span class="text-gray-300 text-sm">Instant activation</span>
                </div>
            </div>

            <!-- Buy Button -->
            <button id="buyCreditsBtn" class="w-full bg-gradient-to-r from-accent-cyan to-accent-teal hover:from-accent-teal hover:to-accent-cyan text-dark-primary font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 mb-4">
                Purchase 30 Credits
            </button>

            <!-- Security Note -->
            <div class="flex items-center justify-center space-x-2 text-xs text-gray-400">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/>
                </svg>
                <span>Secure payment via Midtrans</span>
            </div>
        </div>
    </div>
</div>

<!-- Accurate Privacy Policy Based on Implementation -->
<div id="privacyPolicyPage" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-dark-secondary rounded-xl max-w-4xl w-full max-h-screen overflow-y-auto">
        <!-- Header -->
        <div class="p-6 border-b border-gray-700">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold text-white">Privacy Policy</h2>
                    <p class="text-gray-400 mt-1">How we handle your data in Leadfinder</p>
                </div>
                <button id="closePrivacyPolicy" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="p-6 space-y-6">
            <!-- Key Points Summary -->
            <div class="bg-gradient-to-r from-accent-cyan/10 to-accent-teal/10 rounded-xl p-6 border border-accent-cyan/30">
                <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                    <svg class="w-5 h-5 text-accent-cyan mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/>
                    </svg>
                    Your Privacy at a Glance
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300">We only collect data needed for our service</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300">Your data is never sold to third parties</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300">You can delete your account anytime</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300">Secure authentication via Supabase</span>
                    </div>
                </div>
            </div>

            <!-- What We Collect -->
            <div class="bg-dark-primary rounded-lg p-6">
                <h3 class="text-lg font-bold text-white mb-4">Information We Collect</h3>
                <div class="space-y-4">
                    <div class="border-l-4 border-accent-cyan pl-4">
                        <h4 class="font-semibold text-accent-cyan mb-2">Account Information</h4>
                        <p class="text-gray-300 text-sm">Email address and authentication details when you sign in via magic link or Google OAuth. This is handled securely through Supabase authentication.</p>
                    </div>
                    
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h4 class="font-semibold text-blue-400 mb-2">Search Data</h4>
                        <p class="text-gray-300 text-sm">Your search queries (job titles, locations, experience levels), saved candidates, and search history stored locally in your browser and our database to improve your experience.</p>
                    </div>
                    
                    <div class="border-l-4 border-purple-500 pl-4">
                        <h4 class="font-semibold text-purple-400 mb-2">Credit System Data</h4>
                        <p class="text-gray-300 text-sm">Your credit balance and transaction history stored in our database to manage your account and service usage.</p>
                    </div>
                    
                    <div class="border-l-4 border-green-500 pl-4">
                        <h4 class="font-semibold text-green-400 mb-2">Payment Information</h4>
                        <p class="text-gray-300 text-sm">Payment data is processed securely through Midtrans. We only store transaction IDs and purchase records - never your credit card details.</p>
                    </div>
                </div>
            </div>

            <!-- How We Use Your Information -->
            <div class="bg-dark-primary rounded-lg p-6">
                <h3 class="text-lg font-bold text-white mb-4">How We Use Your Information</h3>
                <div class="space-y-3">
                    <div class="flex items-start space-x-3">
                        <svg class="w-5 h-5 text-accent-cyan mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"/>
                        </svg>
                        <div>
                            <h4 class="font-medium text-white text-sm">Provide AI-Powered Search</h4>
                            <p class="text-gray-400 text-xs">Process your search queries to find and rank candidates using our AI algorithms</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-3">
                        <svg class="w-5 h-5 text-accent-cyan mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <div>
                            <h4 class="font-medium text-white text-sm">Manage Your Account</h4>
                            <p class="text-gray-400 text-xs">Track your credits, save your preferences, and maintain your search history</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-3">
                        <svg class="w-5 h-5 text-accent-cyan mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"/>
                        </svg>
                        <div>
                            <h4 class="font-medium text-white text-sm">Process Payments</h4>
                            <p class="text-gray-400 text-xs">Handle credit purchases securely through Midtrans payment gateway</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-3">
                        <svg class="w-5 h-5 text-accent-cyan mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                        </svg>
                        <div>
                            <h4 class="font-medium text-white text-sm">Send Important Updates</h4>
                            <p class="text-gray-400 text-xs">Account notifications, credit alerts, and service announcements</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Storage -->
            <div class="bg-dark-primary rounded-lg p-6">
                <h3 class="text-lg font-bold text-white mb-4">Where Your Data is Stored</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-dark-secondary rounded-lg p-4">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-10 h-10 bg-blue-500/20 rounded-full flex items-center justify-center">
                                <svg class="w-5 h-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                                </svg>
                            </div>
                            <h4 class="font-semibold text-blue-400">Supabase Database</h4>
                        </div>
                        <ul class="text-gray-300 text-sm space-y-1">
                            <li>• User accounts and authentication</li>
                            <li>• Credit balances and transactions</li>
                            <li>• Search preferences and history</li>
                            <li>• Secured with industry-standard practices</li>
                        </ul>
                    </div>
                    
                    <div class="bg-dark-secondary rounded-lg p-4">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-10 h-10 bg-purple-500/20 rounded-full flex items-center justify-center">
                                <svg class="w-5 h-5 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"/>
                                </svg>
                            </div>
                            <h4 class="font-semibold text-purple-400">Your Browser (Local Storage)</h4>
                        </div>
                        <ul class="text-gray-300 text-sm space-y-1">
                            <li>• Recent search history</li>
                            <li>• Saved candidates and bookmarks</li>
                            <li>• User preferences and settings</li>
                            <li>• Cleared when you clear browser data</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Your Rights -->
            <div class="bg-dark-primary rounded-lg p-6">
                <h3 class="text-lg font-bold text-white mb-4">Your Data Rights</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-3">
                        <div class="flex items-start space-x-3">
                            <svg class="w-5 h-5 text-accent-cyan mt-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z"/>
                            </svg>
                            <div>
                                <h4 class="font-semibold text-white">Access Your Data</h4>
                                <p class="text-gray-400 text-sm">Request a copy of your personal information we store</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start space-x-3">
                            <svg class="w-5 h-5 text-accent-cyan mt-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                            </svg>
                            <div>
                                <h4 class="font-semibold text-white">Update Information</h4>
                                <p class="text-gray-400 text-sm">Correct any inaccurate data in your account</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex items-start space-x-3">
                            <svg class="w-5 h-5 text-accent-cyan mt-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2h8a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 1a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z"/>
                            </svg>
                            <div>
                                <h4 class="font-semibold text-white">Delete Your Account</h4>
                                <p class="text-gray-400 text-sm">Remove your account and all associated data</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start space-x-3">
                            <svg class="w-5 h-5 text-accent-cyan mt-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                            </svg>
                            <div>
                                <h4 class="font-semibold text-white">Export Your Data</h4>
                                <p class="text-gray-400 text-sm">Download your search history and preferences</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-accent-cyan/10 border border-accent-cyan/30 rounded-lg">
                    <div class="flex items-start space-x-3">
                        <svg class="w-5 h-5 text-accent-cyan mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                        </svg>
                        <div>
                            <h4 class="font-semibold text-accent-cyan mb-1">Exercise Your Rights</h4>
                            <p class="text-gray-300 text-sm">
                                To access, update, delete, or export your data, contact us at 
                                <strong class="text-accent-cyan">support@aapgrp.com</strong>. 
                                We'll respond as soon as possible during business hours.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Third-Party Services -->
            <div class="bg-dark-primary rounded-lg p-6">
                <h3 class="text-lg font-bold text-white mb-4">Third-Party Services We Use</h3>
                <div class="space-y-4">
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                            <svg class="w-6 h-6 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"/>
                            </svg>
                        </div>
                        <div>
                            <h4 class="font-semibold text-blue-400 mb-1">Supabase</h4>
                            <p class="text-gray-300 text-sm">Handles user authentication, database storage, and account management. View their privacy policy at supabase.com.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                            <svg class="w-6 h-6 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"/>
                            </svg>
                        </div>
                        <div>
                            <h4 class="font-semibold text-green-400 mb-1">Midtrans</h4>
                            <p class="text-gray-300 text-sm">Processes all credit purchases securely. We never see or store your payment details. View their privacy policy at midtrans.com.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                            <svg class="w-6 h-6 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                            </svg>
                        </div>
                        <div>
                            <h4 class="font-semibold text-purple-400 mb-1">Google OAuth</h4>
                            <p class="text-gray-300 text-sm">Optional sign-in method that only shares your email address with us. Managed through Google's secure authentication.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact & Updates -->
            <div class="text-center space-y-4">
                <div class="bg-dark-primary rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-2">Questions About Your Privacy?</h4>
                    <p class="text-gray-400 text-sm mb-3">
                        We're here to help with any privacy questions or data requests.
                    </p>
                    <a href="mailto:support@aapgrp.com" 
                       class="inline-flex items-center space-x-2 bg-accent-cyan hover:bg-accent-teal text-dark-primary font-medium py-2 px-4 rounded-lg transition-colors">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                        </svg>
                        <span>Contact Support</span>
                    </a>
                </div>
                
                <div class="text-sm text-gray-400">
                    <p>Last updated: June 2025</p>
                    <p class="mt-1">This policy reflects our current implementation and may be updated as we add new features.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Simple How It Works Modal -->
<div id="howItWorksPage" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-dark-secondary rounded-xl max-w-4xl w-full max-h-screen overflow-y-auto">
        <!-- Header -->
        <div class="p-6 border-b border-gray-700">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold text-white mb-2">How Leadfinder Works</h2>
                    <p class="text-gray-400">Find the perfect candidates in 3 simple steps</p>
                </div>
                <button id="closeHowItWorks" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="p-6">
            <!-- Steps -->
            <div class="space-y-8">
                <!-- Step 1: Tell Us What You Need -->
                <div class="flex items-start space-x-6">
                    <div class="flex-shrink-0">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-white mb-3">1. Tell Us What You Need</h3>
                        <p class="text-gray-300 mb-4">
                            Simply fill out our search form with the role you're hiring for, preferred location, and experience level. 
                            The more specific you are, the better matches you'll get.
                        </p>
                        <div class="bg-dark-primary rounded-lg p-4">
                            <div class="text-sm text-gray-400 mb-2">Example:</div>
                            <div class="text-accent-cyan">
                                "Marketing Manager in Jakarta with 3-5 years experience"
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: AI Finds & Ranks Candidates -->
                <div class="flex items-start space-x-6">
                    <div class="flex-shrink-0">
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-white mb-3">2. AI Finds & Ranks Candidates</h3>
                        <p class="text-gray-300 mb-4">
                            Our AI searches through thousands of LinkedIn profiles and ranks candidates based on how well they match your needs. 
                            It looks at skills, experience, location, and career progression.
                        </p>
                        
                        <!-- Quick Stats -->
                        <div class="grid grid-cols-3 gap-4 bg-dark-primary rounded-lg p-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-400">1M+</div>
                                <div class="text-xs text-gray-400">Profiles Searched</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-400">30-60s</div>
                                <div class="text-xs text-gray-400">Search Time</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-400">5-10</div>
                                <div class="text-xs text-gray-400">Top Matches</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Review & Contact -->
                <div class="flex items-start space-x-6">
                    <div class="flex-shrink-0">
                        <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center shadow-lg">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
							</svg>
                        </div>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-white mb-3">3. Review & Contact</h3>
                        <p class="text-gray-300 mb-4">
                            Browse the ranked candidates, view their profiles, and see why AI thinks they're a good match. 
                            When you find someone interesting, generate personalized outreach messages instantly.
                        </p>
                        
                        <!-- Features -->
                        <div class="space-y-3">
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                                </svg>
                                <span class="text-gray-300 text-sm">AI compatibility scores for each candidate</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                                </svg>
                                <span class="text-gray-300 text-sm">Detailed profiles with key strengths highlighted</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                                </svg>
                                <span class="text-gray-300 text-sm">Auto-generated LinkedIn & email messages</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Why It's Better Section -->
            <div class="mt-12 bg-gradient-to-r from-dark-primary to-dark-tertiary rounded-xl p-6 border border-gray-600">
                <h3 class="text-xl font-bold text-white mb-6 text-center">Why Leadfinder vs Manual Search?</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Manual Search -->
                    <div class="space-y-4">
                        <h4 class="font-semibold text-red-400 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/>
                            </svg>
                            Manual LinkedIn Search
                        </h4>
                        <ul class="space-y-2 text-gray-400 text-sm">
                            <li>• 3-4 hours of scrolling and clicking</li>
                            <li>• Only basic keyword matching</li>
                            <li>• Easy to miss qualified candidates</li>
                            <li>• No ranking or scoring system</li>
                            <li>• Manual message writing</li>
                        </ul>
                    </div>
                    
                    <!-- Leadfinder -->
                    <div class="space-y-4">
                        <h4 class="font-semibold text-accent-cyan flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                            </svg>
                            Leadfinder AI
                        </h4>
                        <ul class="space-y-2 text-accent-cyan text-sm">
                            <li>• Seconds of automated search</li>
                            <li>• Smart AI matching & ranking</li>
                            <li>• Discovers hidden talent</li>
                            <li>• Clear compatibility scores</li>
                            <li>• Instant personalized messages</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- CTA -->
            <div class="mt-8 text-center">
                <button onclick="document.getElementById('howItWorksPage').classList.add('hidden')" class="bg-gradient-to-r from-accent-cyan to-accent-teal hover:from-accent-teal hover:to-accent-cyan text-dark-primary font-bold py-3 px-8 rounded-lg transition-all duration-200 transform hover:scale-105">
                    Try Your First Search
                </button>
                <p class="text-gray-400 text-sm mt-2">Get started with 5 free credits</p>
            </div>
        </div>
    </div>
</div>

<!-- FAQ Modal -->
<div id="faqPage" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-dark-secondary rounded-xl max-w-4xl w-full max-h-screen overflow-y-auto">
        <!-- Header -->
        <div class="p-6 border-b border-gray-700">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-accent-cyan/20 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-accent-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-white">Frequently Asked Questions</h2>
                        <p class="text-gray-400">Everything you need to know about Leadfinder</p>
                    </div>
                </div>
                <button id="closeFAQ" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="p-6">
            <!-- Quick Access Categories -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <button class="faq-category-btn bg-gradient-to-r from-blue-500/20 to-blue-600/20 border border-blue-500/30 rounded-lg p-4 text-left hover:from-blue-500/30 hover:to-blue-600/30 transition-all" data-category="getting-started">
                    <div class="font-semibold text-blue-400 mb-1">🚀 Getting Started</div>
                    <div class="text-sm text-gray-400">Account setup and first search</div>
                </button>
                <button class="faq-category-btn bg-gradient-to-r from-purple-500/20 to-purple-600/20 border border-purple-500/30 rounded-lg p-4 text-left hover:from-purple-500/30 hover:to-purple-600/30 transition-all" data-category="how-it-works">
                    <div class="font-semibold text-purple-400 mb-1">🤖 How AI Works</div>
                    <div class="text-sm text-gray-400">Search quality and data sources</div>
                </button>
                <button class="faq-category-btn bg-gradient-to-r from-green-500/20 to-green-600/20 border border-green-500/30 rounded-lg p-4 text-left hover:from-green-500/30 hover:to-green-600/30 transition-all" data-category="billing">
                    <div class="font-semibold text-green-400 mb-1">💳 Billing & Credits</div>
                    <div class="text-sm text-gray-400">Pricing and payment options</div>
                </button>
            </div>

            <!-- FAQ Items -->
            <div class="space-y-4">
                <!-- Getting Started Section -->
                <div class="faq-section" data-category="getting-started">
                    <h3 class="text-lg font-bold text-blue-400 mb-4 flex items-center">
                        <span class="text-2xl mr-2">🚀</span>
                        Getting Started
                    </h3>

                    <!-- FAQ Item 1 -->
                    <div class="faq-item bg-dark-primary rounded-lg">
                        <button class="faq-question w-full text-left p-4 flex items-center justify-between hover:bg-dark-tertiary/50 transition-colors">
                            <span class="font-semibold text-white">How do I create an account and start searching?</span>
                            <svg class="faq-arrow w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4">
                            <div class="text-gray-300 space-y-3">
                                <p>Account creation takes less than 2 minutes. You can sign up using Google authentication or email verification.</p>
                                <div class="bg-dark-secondary rounded-lg p-4">
                                    <h4 class="font-semibold text-white mb-2">Setup Process:</h4>
                                    <ol class="space-y-1 text-sm">
                                        <li>1. Click "Continue with Google" or enter your email for magic link authentication</li>
                                        <li>2. Complete account verification (automatic with Google, email link for others)</li>
                                        <li>3. Access your dashboard with 5 free searches already credited</li>
                                        <li>4. Enter search criteria and run your first candidate search</li>
                                    </ol>
                                </div>
                                <div class="p-3 bg-accent-cyan/10 border border-accent-cyan/30 rounded-lg">
                                    <p class="text-accent-cyan text-sm"><strong>Best practice:</strong> Use specific job titles like "Senior Software Engineer" rather than generic terms like "Developer" for optimal results.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ Item 2 -->
                    <div class="faq-item bg-dark-primary rounded-lg">
                        <button class="faq-question w-full text-left p-4 flex items-center justify-between hover:bg-dark-tertiary/50 transition-colors">
                            <span class="font-semibold text-white">What information should I provide for effective searches?</span>
                            <svg class="faq-arrow w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4">
                            <div class="text-gray-300 space-y-3">
                                <p>Search accuracy depends on the specificity and relevance of your input criteria. Our AI performs better with detailed, focused parameters.</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
                                        <h4 class="font-semibold text-green-400 mb-2">Required Information</h4>
                                        <ul class="text-sm space-y-1">
                                            <li>• <strong>Job title:</strong> Specific role designation</li>
                                            <li>• <strong>Location:</strong> City or metropolitan area</li>
                                            <li>• <strong>Experience level:</strong> Years of relevant experience</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                                    <p class="text-yellow-400 text-sm"><strong>Example:</strong> "Senior React Developer, Jakarta, 3-5 years experience" yields more targeted results than "Developer".</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ Item 3 -->
                    <div class="faq-item bg-dark-primary rounded-lg">
                        <button class="faq-question w-full text-left p-4 flex items-center justify-between hover:bg-dark-tertiary/50 transition-colors">
                            <span class="font-semibold text-white">How many candidates will I see per search?</span>
                            <svg class="faq-arrow w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4">
                            <div class="text-gray-300 space-y-3">
                                <p>Each search returns 5-10 carefully vetted candidates, ranked by compatibility score. This focused approach prioritizes quality over quantity.</p>
                                <div class="bg-dark-secondary rounded-lg p-4">
                                    <h4 class="font-semibold text-accent-cyan mb-2">Quality-First Approach</h4>
                                    <ul class="space-y-1 text-sm">
                                        <li>• AI pre-filtering eliminates irrelevant profiles</li>
                                        <li>• Compatibility scoring from 0-100 ensures relevance</li>
                                        <li>• Reduces time spent reviewing unqualified candidates</li>
                                        <li>• Higher response rates from targeted outreach</li>
                                    </ul>
                                </div>
                                <div class="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                    <p class="text-blue-400 text-sm"><strong>Need more candidates?</strong> Run additional searches with modified criteria (different experience levels, broader location scope) to expand your candidate pool.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- How AI Works Section -->
                <div class="faq-section" data-category="how-it-works">
                    <h3 class="text-lg font-bold text-purple-400 mb-4 flex items-center">
                        <span class="text-2xl mr-2">🤖</span>
                        How Our AI Works
                    </h3>

                    <!-- FAQ Item 1 -->
                    <div class="faq-item bg-dark-primary rounded-lg">
                        <button class="faq-question w-full text-left p-4 flex items-center justify-between hover:bg-dark-tertiary/50 transition-colors">
                            <span class="font-semibold text-white">How accurate are the candidate matches?</span>
                            <svg class="faq-arrow w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4">
                            <div class="text-gray-300 space-y-3">
                                <p>Our AI delivers 85-92% match accuracy based on user feedback and hiring outcomes. The system analyzes multiple data points for comprehensive candidate evaluation.</p>
                                <div class="bg-dark-secondary rounded-lg p-4">
                                    <h4 class="font-semibold text-purple-400 mb-2">AI Analysis Components</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                        <div class="space-y-2">
                                            <p class="font-medium text-white">Profile Analysis</p>
                                            <ul class="space-y-1 text-gray-300">
                                                <li>• Complete professional history review</li>
                                                <li>• Contextual skill assessment</li>
                                                <li>• Career progression pattern analysis</li>
                                            </ul>
                                        </div>
                                        <div class="space-y-2">
                                            <p class="font-medium text-white">Compatibility Scoring</p>
                                            <ul class="space-y-1 text-gray-300">
                                                <li>• Skills and experience alignment</li>
                                                <li>• Industry background relevance</li>
                                                <li>• Seniority level appropriateness</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-3 bg-green-500/10 border border-green-500/30 rounded-lg">
                                    <p class="text-green-400 text-sm"><strong>Performance indicator:</strong> Candidates with 75%+ compatibility scores typically show high interview-to-hire conversion rates.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ Item 2 -->
                    <div class="faq-item bg-dark-primary rounded-lg">
                        <button class="faq-question w-full text-left p-4 flex items-center justify-between hover:bg-dark-tertiary/50 transition-colors">
                            <span class="font-semibold text-white">What are your data sources?</span>
                            <svg class="faq-arrow w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4">
                            <div class="text-gray-300 space-y-3">
                                <p>All candidate information is sourced from publicly available professional profiles and platforms. No private or confidential data is accessed.</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
                                        <h4 class="font-semibold text-green-400 mb-2">Data Sources</h4>
                                        <ul class="text-sm space-y-1">
                                            <li>• Public LinkedIn profiles</li>
                                            <li>• Professional portfolio websites</li>
                                            <li>• Public job board profiles</li>
                                            <li>• Company team pages</li>
                                        </ul>
                                    </div>
                                    <div class="bg-red-500/10 border border-red-500/30 rounded-lg p-4">
                                        <h4 class="font-semibold text-red-400 mb-2">Privacy Boundaries</h4>
                                        <ul class="text-sm space-y-1">
                                            <li>• No access to private messages</li>
                                            <li>• No personal social media data</li>
                                            <li>• No confidential company information</li>
                                            <li>• No protected contact details</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                    <p class="text-blue-400 text-sm"><strong>Privacy compliance:</strong> Data collection adheres to professional networking platform terms and Indonesian data protection regulations.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ Item 3 -->
                    <div class="faq-item bg-dark-primary rounded-lg">
                        <button class="faq-question w-full text-left p-4 flex items-center justify-between hover:bg-dark-tertiary/50 transition-colors">
                            <span class="font-semibold text-white">Can I search for candidates outside Indonesia?</span>
                            <svg class="faq-arrow w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4">
                            <div class="text-gray-300 space-y-3">
                                <p>Currently, Leadfinder specializes exclusively in Indonesian talent to deliver optimal results for the local market.</p>
                                <div class="bg-dark-secondary rounded-lg p-4">
                                    <h4 class="font-semibold text-yellow-400 mb-2">Indonesia-Focused Advantages</h4>
                                    <ul class="text-sm space-y-2">
                                        <li class="flex items-start space-x-2">
                                            <span class="text-yellow-400 mt-0.5">•</span>
                                            <span><strong>Market expertise:</strong> Deep understanding of Indonesian professional landscape and hiring practices</span>
                                        </li>
                                        <li class="flex items-start space-x-2">
                                            <span class="text-yellow-400 mt-0.5">•</span>
                                            <span><strong>Cultural context:</strong> Accurate compensation benchmarking and workplace culture analysis</span>
                                        </li>
                                        <li class="flex items-start space-x-2">
                                            <span class="text-yellow-400 mt-0.5">•</span>
                                            <span><strong>Language optimization:</strong> Enhanced performance with Bahasa Indonesia content and local platform data</span>
                                        </li>
                                        <li class="flex items-start space-x-2">
                                            <span class="text-yellow-400 mt-0.5">•</span>
                                            <span><strong>Career pattern recognition:</strong> Local industry career progression understanding</span>
                                        </li>
                                    </ul>
                                </div>
                                <div class="p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg">
                                    <p class="text-purple-400 text-sm"><strong>Expansion roadmap:</strong> Vietnam market coverage planned for 2025.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Billing & Credits Section -->
                <div class="faq-section" data-category="billing">
                    <h3 class="text-lg font-bold text-green-400 mb-4 flex items-center">
                        <span class="text-2xl mr-2">💳</span>
                        Billing & Credits
                    </h3>

                    <!-- FAQ Item 1 -->
                    <div class="faq-item bg-dark-primary rounded-lg">
                        <button class="faq-question w-full text-left p-4 flex items-center justify-between hover:bg-dark-tertiary/50 transition-colors">
                            <span class="font-semibold text-white">What are the pricing options?</span>
                            <svg class="faq-arrow w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4">
                            <div class="text-gray-300 space-y-3">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
				    <!-- Free Tier -->
				    <div class="bg-gradient-to-r from-blue-500/10 to-blue-600/10 rounded-lg p-6 border border-blue-500/30 text-center">
				        <div class="text-3xl mb-3">🆓</div>
				        <h4 class="font-semibold text-blue-400 text-lg mb-2">Free Tier</h4>
				        <div class="text-3xl font-bold text-white mb-2">5 searches</div>
				        <div class="text-sm text-gray-400 mb-3">Per month • Auto-resets</div>
				        <div class="text-xs text-blue-400 bg-blue-500/20 rounded-full px-3 py-1">Perfect for evaluation</div>
				    </div>
				    
				    <!-- Credit Package -->
				    <div class="bg-gradient-to-r from-accent-cyan/10 to-accent-teal/10 rounded-lg p-6 border border-accent-cyan/30 text-center">
				        <div class="text-3xl mb-3">💳</div>
				        <h4 class="font-semibold text-accent-cyan text-lg mb-2">Credit Package</h4>
				        <div class="text-3xl font-bold text-white mb-2">30 Credits</div>
				        <div class="text-xl text-accent-cyan font-semibold mb-1">IDR 599,000</div>
				        <div class="text-sm text-gray-400 mb-3">~IDR 20,000 per search</div>
				        <div class="text-xs text-accent-cyan bg-accent-cyan/20 rounded-full px-3 py-1">Scale your hiring</div>
				    </div>
				</div>
				<div class="mt-4 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
				    <p class="text-yellow-400 text-sm"><strong>Simple approach:</strong> Start with free searches to test the platform, then top up with 30-credit packages as needed.</p>
				</div>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ Item 2 -->
                    <div class="faq-item bg-dark-primary rounded-lg">
                        <button class="faq-question w-full text-left p-4 flex items-center justify-between hover:bg-dark-tertiary/50 transition-colors">
                            <span class="font-semibold text-white">What payment methods are accepted?</span>
                            <svg class="faq-arrow w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4">
                            <div class="text-gray-300 space-y-3">
                                <p>Payment processing is handled through Midtrans, supporting all major Indonesian payment methods with enterprise-grade security.</p>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-dark-secondary rounded-lg p-4 text-center">
                                        <div class="text-3xl mb-2">🏦</div>
                                        <h4 class="font-semibold text-white mb-1">Bank Transfer</h4>
                                        <div class="text-xs text-gray-400">BCA, Mandiri, BNI, BRI</div>
                                    </div>
                                    <div class="bg-dark-secondary rounded-lg p-4 text-center">
                                        <div class="text-3xl mb-2">💳</div>
                                        <h4 class="font-semibold text-white mb-1">Credit/Debit Cards</h4>
                                        <div class="text-xs text-gray-400">Visa, Mastercard, JCB</div>
                                    </div>
                                    <div class="bg-dark-secondary rounded-lg p-4 text-center">
                                        <div class="text-3xl mb-2">📱</div>
                                        <h4 class="font-semibold text-white mb-1">E-Wallets</h4>
                                        <div class="text-xs text-gray-400">OVO, DANA, GoPay, LinkAja</div>
                                    </div>
                                </div>
                                <div class="p-3 bg-green-500/10 border border-green-500/30 rounded-lg">
                                    <p class="text-green-400 text-sm"><strong>Security assurance:</strong> All transactions processed through Midtrans with PCI DSS compliance. Payment details are never stored on our servers.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ Item 3 -->
                    <div class="faq-item bg-dark-primary rounded-lg">
                        <button class="faq-question w-full text-left p-4 flex items-center justify-between hover:bg-dark-tertiary/50 transition-colors">
                            <span class="font-semibold text-white">What is your refund policy?</span>
                            <svg class="faq-arrow w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4">
                            <div class="text-gray-300 space-y-3">
                                <p>We offer a satisfaction guarantee designed to ensure platform value and user confidence.</p>
                                <div class="bg-dark-secondary rounded-lg p-4">
                                    <h4 class="font-semibold text-green-400 mb-3 flex items-center">
                                        <span class="text-xl mr-2">🛡️</span>
                                        Refund Policy Terms
                                    </h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                        <div class="space-y-2">
                                            <p class="font-medium text-white">First-Time Users</p>
                                            <ul class="space-y-1 text-gray-300">
                                                <li>• 7-day full refund on initial purchase</li>
                                                <li>• No usage restrictions or questions</li>
                                                <li>• Email request process</li>
                                            </ul>
                                        </div>
                                        <div class="space-y-2">
                                            <p class="font-medium text-white">Technical Issues</p>
                                            <ul class="space-y-1 text-gray-300">
                                                <li>• Credit restoration for failed searches</li>
                                                <li>• Partial refunds evaluated case-by-case</li>
                                                <li>• Service level compensation</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                    <p class="text-blue-400 text-sm"><strong>Process:</strong> Submit refund requests to support@aapgrp.com with order reference. Standard response time is 24-48 hours.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ Item 4 -->
                    <div class="faq-item bg-dark-primary rounded-lg">
                        <button class="faq-question w-full text-left p-4 flex items-center justify-between hover:bg-dark-tertiary/50 transition-colors">
                            <span class="font-semibold text-white">Do credits expire?</span>
                            <svg class="faq-arrow w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4">
                            <div class="text-gray-300 space-y-3">
                                <p>Credit expiration policies differ between free and purchased credits to optimize platform usage.</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
                                        <h4 class="font-semibold text-blue-400 mb-2 flex items-center">
                                            <span class="text-xl mr-2">🆓</span>
                                            Free Credits
                                        </h4>
                                        <ul class="text-sm space-y-1">
                                            <li>• Monthly allocation: 5 searches</li>
                                            <li>• Reset date: 1st of each month</li>
                                            <li>• Non-transferable between months</li>
                                        </ul>
                                    </div>
                                    <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
                                        <h4 class="font-semibold text-green-400 mb-2 flex items-center">
                                            <span class="text-xl mr-2">💰</span>
                                            Purchased Credits
                                        </h4>
                                        <ul class="text-sm space-y-1">
                                            <li>• <strong>No expiration date</strong></li>
                                            <li>• Permanent account balance</li>
                                            <li>• Use at your own pace</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg">
                                    <p class="text-purple-400 text-sm"><strong>Usage priority:</strong> System automatically uses free credits first each month, preserving purchased credits for extended availability.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Support Contact Section -->
            <div class="mt-8 bg-gradient-to-r from-accent-cyan/10 to-accent-teal/10 rounded-xl p-6 border border-accent-cyan/30 text-center">
                <div class="flex items-center justify-center mb-3">
                    <div class="w-12 h-12 bg-accent-cyan/20 rounded-lg flex items-center justify-center mr-3">
                        <svg class="w-6 h-6 text-accent-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-3.582 8-8 8a8.959 8.959 0 01-4.906-1.42c-1.09-.703-2.426-.993-3.795-.84L3 18.5c-.825.247-1.5-.076-1.5-.85 0-.824.75-1.5 1.5-1.5.75 0 1.5-.676 1.5-1.5v-1c0-.824-.75-1.5-1.5-1.5-.75 0-1.5-.676-1.5-1.5C3 10.5 3.582 6 8 6c4.418 0 8 3.582 8 6z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-white">Need Additional Support?</h3>
                </div>
                <p class="text-gray-300 mb-4">Our support team is available to assist with technical questions, account issues, and platform guidance.</p>
                <div class="flex flex-col sm:flex-row gap-3 justify-center items-center">
                    <a href="mailto:support@aapgrp.com" class="bg-accent-cyan hover:bg-accent-teal text-dark-primary font-bold py-3 px-6 rounded-lg transition-colors transform hover:scale-105 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        Contact Support
                    </a>
                    <div class="text-gray-400 text-sm">
                        <div class="flex items-center">
                            <svg class="w-4 h-4 mr-1 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            Response within 24 hours
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Simple Features Modal -->
<div id="featuresPage" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-dark-secondary rounded-xl max-w-5xl w-full max-h-screen overflow-y-auto">
        <!-- Header -->
        <div class="p-6 border-b border-gray-700">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold text-white mb-2">Why Recruiters Love Leadfinder</h2>
                    <p class="text-gray-400">Powerful features that make hiring faster and smarter</p>
                </div>
                <button id="closeFeatures" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="p-6">
            <!-- Main Features Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- AI-Powered Search -->
                <div class="bg-dark-primary rounded-xl p-6 border border-gray-600/50 hover:border-accent-cyan/50 transition-colors">
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center flex-shrink-0">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-white mb-2">Smart AI Matching</h3>
                            <p class="text-gray-300 text-sm mb-3">
                                Our AI understands context, not just keywords. It finds candidates who truly fit your role requirements.
                            </p>
                            <div class="text-xs text-blue-400">✨ Goes beyond basic LinkedIn search</div>
                        </div>
                    </div>
                </div>

                <!-- Instant Results -->
                <div class="bg-dark-primary rounded-xl p-6 border border-gray-600/50 hover:border-accent-cyan/50 transition-colors">
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center flex-shrink-0">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-white mb-2">Lightning Fast</h3>
                            <p class="text-gray-300 text-sm mb-3">
                                Get ranked candidates in seconds. No more hours of manual scrolling through profiles.
                            </p>
                            <div class="text-xs text-green-400">⚡ 100x faster than manual search</div>
                        </div>
                    </div>
                </div>

                <!-- Quality Scoring -->
                <div class="bg-dark-primary rounded-xl p-6 border border-gray-600/50 hover:border-accent-cyan/50 transition-colors">
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-white mb-2">Compatibility Scores</h3>
                            <p class="text-gray-300 text-sm mb-3">
                                Every candidate gets a compatibility score so you know exactly who to contact first.
                            </p>
                            <div class="text-xs text-purple-400">📊 Data-driven hiring decisions</div>
                        </div>
                    </div>
                </div>

                <!-- Message Generation -->
                <div class="bg-dark-primary rounded-xl p-6 border border-gray-600/50 hover:border-accent-cyan/50 transition-colors">
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center flex-shrink-0">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-white mb-2">Auto Outreach Messages</h3>
                            <p class="text-gray-300 text-sm mb-3">
                                Generate personalized LinkedIn and email messages instantly. No more writer's block.
                            </p>
                            <div class="text-xs text-orange-400">💬 Ready-to-send messages</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- What Makes Us Different -->
            <div class="bg-gradient-to-r from-dark-primary to-dark-tertiary rounded-xl p-6 border border-gray-600 mb-8">
                <h3 class="text-xl font-bold text-white mb-6 text-center">What Makes Leadfinder Different?</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Quality Over Quantity -->
                    <div class="text-center">
                        <div class="w-16 h-16 bg-accent-cyan/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-accent-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                            </svg>
                        </div>
                        <h4 class="font-semibold text-white mb-2">Quality Over Quantity</h4>
                        <p class="text-gray-400 text-sm">We show you the best matches per search, not thousands of irrelevant profiles</p>
                    </div>

                    <!-- Human-Friendly AI -->
                    <div class="text-center">
                        <div class="w-16 h-16 bg-accent-cyan/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-accent-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                        </div>
                        <h4 class="font-semibold text-white mb-2">Human-Friendly AI</h4>
                        <p class="text-gray-400 text-sm">No complex algorithms to learn - just tell us what you need in plain English</p>
                    </div>

                    <!-- Built for Recruiters -->
                    <div class="text-center">
                        <div class="w-16 h-16 bg-accent-cyan/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-accent-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                            </svg>
                        </div>
                        <h4 class="font-semibold text-white mb-2">Built for Recruiters</h4>
                        <p class="text-gray-400 text-sm">Every feature designed specifically for talent acquisition professionals</p>
                    </div>
                </div>
            </div>

            <!-- Simple Benefits List -->
            <div class="bg-dark-primary rounded-xl p-6 border border-gray-600/50">
                <h3 class="text-lg font-bold text-white mb-4 text-center">Everything You Need to Hire Better</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300 text-sm">Search 1M+ LinkedIn profiles instantly</span>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300 text-sm">AI compatibility scoring for each candidate</span>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300 text-sm">Detailed candidate profiles with insights</span>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300 text-sm">Personalized outreach message generation</span>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300 text-sm">Export candidate data for your team</span>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300 text-sm">Save and compare candidates</span>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300 text-sm">Search history for easy re-use</span>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300 text-sm">No contracts - pay as you search</span>
                    </div>
                </div>
            </div>

            <!-- CTA -->
            <div class="mt-8 text-center">
                <button onclick="document.getElementById('featuresPage').classList.add('hidden')" class="bg-gradient-to-r from-accent-cyan to-accent-teal hover:from-accent-teal hover:to-accent-cyan text-dark-primary font-bold py-3 px-8 rounded-lg transition-all duration-200 transform hover:scale-105">
                    Start Finding Great Candidates
                </button>
                <p class="text-gray-400 text-sm mt-2">Try it now with 5 free searches</p>
            </div>
        </div>
    </div>
</div> 

<!-- Simple Terms of Service Modal -->
<div id="termsOfServicePage" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-dark-secondary rounded-xl max-w-4xl w-full max-h-screen overflow-y-auto">
        <!-- Header -->
        <div class="p-6 border-b border-gray-700">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold text-white">Terms of Service</h2>
                    <p class="text-gray-400 mt-1">Your agreement for using Leadfinder</p>
                </div>
                <button id="closeTermsOfService" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="p-6 space-y-6">
            <!-- Quick Summary -->
            <div class="bg-gradient-to-r from-accent-cyan/10 to-accent-teal/10 border border-accent-cyan/30 rounded-xl p-6">
                <h3 class="text-lg font-bold text-accent-cyan mb-3 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"/>
                    </svg>
                    Terms Summary
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300">Use Leadfinder for legitimate recruiting only</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300">You get 5 free searches monthly</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300">Credits never expire</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                        </svg>
                        <span class="text-gray-300">Cancel anytime, no contracts</span>
                    </div>
                </div>
            </div>

            <!-- 1. Service Description -->
            <div class="bg-dark-primary rounded-lg p-6">
                <h3 class="text-lg font-bold text-white mb-4">1. What Leadfinder Provides</h3>
                <div class="space-y-4">
                    <p class="text-gray-300">
                        Leadfinder is an AI-powered talent discovery platform that helps you find and evaluate candidates from publicly available professional profiles, primarily LinkedIn.
                    </p>
                    
                    <div class="bg-dark-secondary rounded-lg p-4">
                        <h4 class="font-semibold text-accent-cyan mb-2">Our Service Includes:</h4>
                        <ul class="text-gray-300 text-sm space-y-1">
                            <li>• AI-powered candidate search and compatibility scoring</li>
                            <li>• Access to publicly available professional profiles</li>
                            <li>• Personalized outreach message generation</li>
                            <li>• Candidate data export and comparison tools</li>
                            <li>• Search history and candidate bookmark features</li>
                        </ul>
                    </div>
                    
                    <div class="bg-yellow-900/20 border border-yellow-600/30 rounded-lg p-4">
                        <p class="text-yellow-300 text-sm">
                            <strong>Important:</strong> We provide search tools to help you find candidates. The actual recruitment, interviewing, hiring decisions, and compliance with employment laws are your responsibility.
                        </p>
                    </div>
                </div>
            </div>

            <!-- 2. Your Responsibilities -->
            <div class="bg-dark-primary rounded-lg p-6">
                <h3 class="text-lg font-bold text-white mb-4">2. Your Responsibilities</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-dark-secondary rounded-lg p-4">
                        <h4 class="font-semibold text-green-400 mb-2 flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                            </svg>
                            Professional Use
                        </h4>
                        <ul class="text-gray-300 text-sm space-y-1">
                            <li>• Use only for legitimate recruitment purposes</li>
                            <li>• Respect candidate privacy and data protection</li>
                            <li>• Provide accurate search criteria</li>
                            <li>• Follow applicable employment laws</li>
                            <li>• Keep your account credentials secure</li>
                        </ul>
                    </div>
                    
                    <div class="bg-dark-secondary rounded-lg p-4">
                        <h4 class="font-semibold text-red-400 mb-2 flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/>
                            </svg>
                            Prohibited Activities
                        </h4>
                        <ul class="text-gray-300 text-sm space-y-1">
                            <li>• Mass spamming or unsolicited messaging</li>
                            <li>• Discriminatory recruitment practices</li>
                            <li>• Sharing or reselling candidate data</li>
                            <li>• Attempting to bypass our security</li>
                            <li>• Using fake or fraudulent accounts</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 3. Credits & Payment -->
            <div class="bg-dark-primary rounded-lg p-6">
                <h3 class="text-lg font-bold text-white mb-4">3. Credits & Payment Terms</h3>
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gradient-to-br from-green-500/10 to-emerald-500/10 border border-green-500/30 rounded-lg p-4">
                            <h4 class="font-semibold text-green-400 mb-2">Free Credits</h4>
                            <p class="text-gray-300 text-sm">
                                Every user receives 5 free searches monthly. These refresh automatically and don't roll over.
                            </p>
                        </div>
                        
                        <div class="bg-gradient-to-br from-blue-500/10 to-blue-600/10 border border-blue-500/30 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-400 mb-2">Purchased Credits</h4>
                            <p class="text-gray-300 text-sm">
                                Additional credits cost Rp 599,000 for 30 searches. Credits never expire and remain in your account.
                            </p>
                        </div>
                    </div>
                    
                    <div class="bg-dark-secondary rounded-lg p-4">
                        <h4 class="font-semibold text-accent-cyan mb-2">Payment Processing</h4>
                        <div class="text-gray-300 text-sm space-y-2">
                            <p>• All payments processed securely through Midtrans</p>
                            <p>• We never store your credit card information</p>
                            <p>• Credits are added to your account immediately after payment</p>
                            <p>• Prices are in Indonesian Rupiah (IDR) and include applicable taxes</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. Data Usage -->
			<div class="bg-dark-primary rounded-lg p-6">
			    <h3 class="text-lg font-bold text-white mb-4">4. Data Usage & Candidate Information</h3>
			    <div class="space-y-4">
			        <div class="bg-dark-secondary rounded-lg p-4">
			            <h4 class="font-semibold text-purple-400 mb-2">What Data We Access</h4>
			            <p class="text-gray-300 text-sm">
			                We only access publicly available professional information from platforms like LinkedIn through third-party search APIs. No private messages, personal contacts, or confidential data is ever accessed.
			            </p>
			        </div>
			        
			        <!-- NEW: How We Collect Data -->
			        <div class="bg-dark-secondary rounded-lg p-4">
			            <h4 class="font-semibold text-blue-400 mb-2">How We Collect Data</h4>
			            <p class="text-gray-300 text-sm mb-3">
			                We use <strong class="text-blue-300">Tavily AI Search API</strong> and other professional search services to access publicly available candidate information. We do not directly scrape or access LinkedIn's servers.
			            </p>
			            <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3">
			                <p class="text-blue-300 text-xs">
			                    <strong>Compliance Note:</strong> All data collection is performed through legitimate third-party search services that comply with platform terms and data protection regulations.
			                </p>
			            </div>
			        </div>
			        
			        <!-- UPDATED: Data Sources -->
			        <div class="bg-dark-secondary rounded-lg p-4">
			            <h4 class="font-semibold text-green-400 mb-2">Data Sources</h4>
			            <ul class="text-gray-300 text-sm space-y-1">
			                <li>• Public LinkedIn profiles (accessed via Tavily API)</li>
			                <li>• Professional portfolio websites</li>
			                <li>• Public job board profiles</li>
			                <li>• Company team pages</li>
			                <li>• Other publicly available professional information</li>
			            </ul>
			        </div>
			        
			        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
			            <div class="bg-dark-secondary rounded-lg p-4">
			                <h4 class="font-semibold text-accent-cyan mb-2">Your Responsibilities</h4>
			                <ul class="text-gray-300 text-sm space-y-1">
			                    <li>• Use candidate data responsibly</li>
			                    <li>• Respect privacy preferences</li>
			                    <li>• Follow employment and privacy laws</li>
			                    <li>• Don't share data without proper consent</li>
			                </ul>
			            </div>
			            
			            <div class="bg-dark-secondary rounded-lg p-4">
			                <h4 class="font-semibold text-yellow-400 mb-2">Our Commitments</h4>
			                <ul class="text-gray-300 text-sm space-y-1">
			                    <li>• Only public data sources</li>
			                    <li>• Legitimate API-based data access</li>
			                    <li>• Secure data transmission</li>
			                    <li>• No selling of candidate information</li>
			                    <li>• Transparent data practices</li>
			                </ul>
			            </div>
			        </div>
			    </div>
			</div>

            <!-- 5. Service Availability -->
            <div class="bg-dark-primary rounded-lg p-6">
                <h3 class="text-lg font-bold text-white mb-4">5. Service Availability & Limitations</h3>
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-dark-secondary rounded-lg p-4">
                            <h4 class="font-semibold text-green-400 mb-2">What We Strive For</h4>
                            <ul class="text-gray-300 text-sm space-y-1">
                                <li>• 99% uptime for search functionality</li>
                                <li>• Fast search results (typically 30-60 seconds)</li>
                                <li>• Responsive customer support</li>
                                <li>• Regular platform improvements</li>
                            </ul>
                        </div>
                        
                        <div class="bg-dark-secondary rounded-lg p-4">
                            <h4 class="font-semibold text-yellow-400 mb-2">Important Disclaimers</h4>
                            <ul class="text-gray-300 text-sm space-y-1">
                                <li>• Candidate data accuracy depends on sources</li>
                                <li>• Search results may vary by location/industry</li>
                                <li>• Platform maintenance may cause brief downtime</li>
                                <li>• AI scoring is suggestive, not definitive</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 6. Account Termination -->
            <div class="bg-dark-primary rounded-lg p-6">
                <h3 class="text-lg font-bold text-white mb-4">6. Account Termination</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-400 mb-2">You Can Cancel Anytime</h4>
                        <ul class="text-gray-300 text-sm space-y-1">
                            <li>• No long-term contracts or commitments</li>
                            <li>• Unused credits remain available</li>
                            <li>• Export your data before closing account</li>
                            <li>• Reactivate later if needed</li>
                        </ul>
                    </div>
                    
                    <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
                        <h4 class="font-semibold text-red-400 mb-2">We May Suspend Accounts For</h4>
                        <ul class="text-gray-300 text-sm space-y-1">
                            <li>• Violating these terms</li>
                            <li>• Suspicious or fraudulent activity</li>
                            <li>• Misuse of candidate data</li>
                            <li>• Repeated policy violations</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-4 bg-yellow-900/20 border border-yellow-600/30 rounded-lg p-4">
                    <p class="text-yellow-300 text-sm">
                        <strong>Fair Process:</strong> Before suspending any account, we'll contact you to resolve issues when possible. Account suspension is a last resort.
                    </p>
                </div>
            </div>

            <!-- 7. Liability -->
            <div class="bg-dark-primary rounded-lg p-6">
                <h3 class="text-lg font-bold text-white mb-4">7. Liability & Responsibilities</h3>
                <div class="space-y-4">
                    <div class="bg-dark-secondary rounded-lg p-4">
                        <p class="text-gray-300 text-sm">
                            Leadfinder provides search tools to assist with recruitment. We don't guarantee specific hiring outcomes, candidate response rates, or the accuracy of all candidate information. Our liability is limited to the amount you've paid in credits over the past 12 months.
                        </p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-dark-secondary rounded-lg p-4">
                            <h4 class="font-semibold text-accent-cyan mb-2">We're Responsible For</h4>
                            <ul class="text-gray-300 text-sm space-y-1">
                                <li>• Platform functionality and uptime</li>
                                <li>• Data security and privacy protection</li>
                                <li>• Customer support and assistance</li>
                                <li>• Transparent billing and credit management</li>
                            </ul>
                        </div>
                        
                        <div class="bg-dark-secondary rounded-lg p-4">
                            <h4 class="font-semibold text-yellow-400 mb-2">You're Responsible For</h4>
                            <ul class="text-gray-300 text-sm space-y-1">
                                <li>• Your hiring decisions and processes</li>
                                <li>• Compliance with employment laws</li>
                                <li>• Candidate relationship management</li>
                                <li>• Proper use of candidate data</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 8. Updates -->
            <div class="bg-dark-primary rounded-lg p-6">
                <h3 class="text-lg font-bold text-white mb-4">8. Terms Updates</h3>
                <div class="space-y-4">
                    <p class="text-gray-300">
                        We may update these terms occasionally to reflect service improvements or legal requirements. We'll notify you of significant changes via email with 30 days advance notice.
                    </p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-dark-secondary rounded-lg p-3 text-center">
                            <div class="text-2xl mb-2">📧</div>
                            <h4 class="font-semibold text-blue-400 mb-1">Email Notice</h4>
                            <p class="text-xs text-gray-300">30 days advance warning</p>
                        </div>
                        <div class="bg-dark-secondary rounded-lg p-3 text-center">
                            <div class="text-2xl mb-2">📋</div>
                            <h4 class="font-semibold text-green-400 mb-1">Version Tracking</h4>
                            <p class="text-xs text-gray-300">Clear change documentation</p>
                        </div>
                        <div class="bg-dark-secondary rounded-lg p-3 text-center">
                            <div class="text-2xl mb-2">✅</div>
                            <h4 class="font-semibold text-purple-400 mb-1">Your Choice</h4>
                            <p class="text-xs text-gray-300">Accept or cancel service</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact & Legal -->
            <div class="bg-gradient-to-r from-gray-500/10 to-slate-500/10 rounded-xl p-6 border border-gray-500/30">
                <h3 class="text-lg font-bold text-white mb-4 text-center">Questions About These Terms?</h3>
                
                <div class="text-center">
                    <div class="w-12 h-12 bg-accent-cyan/20 rounded-lg flex items-center justify-center mx-auto mb-3">
                        <svg class="w-6 h-6 text-accent-cyan" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                        </svg>
                    </div>
                    <h4 class="font-semibold text-white mb-2">Need Help?</h4>
                    <p class="text-gray-300 text-sm mb-3">
                        For any questions about these terms or our service
                    </p>
                    <a href="mailto:support@aapgrp.com" 
                       class="inline-flex items-center space-x-2 bg-accent-cyan hover:bg-accent-teal text-dark-primary font-medium py-2 px-4 rounded-lg transition-colors">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                        </svg>
                        <span>Contact Support</span>
                    </a>
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-600 text-center text-sm text-gray-400">
                    <p><strong class="text-white">Governing Law:</strong> These terms are governed by Indonesian law</p>
                    <p class="mt-2">Last updated: June 2025 • Leadfinder by MontPro</p>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>
